<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Hashvex Technologies</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.dataTables.min.css">
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --dark-color: #1e293b;
            --light-color: #f8fafc;
            --sidebar-width: 280px;
            --header-height: 70px;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            color: #334155;
            overflow-x: hidden;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Layout */
        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: white;
            box-shadow: var(--shadow);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: var(--transition);
            z-index: 1000;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h2 {
            font-size: 1.5rem;
            color: var(--dark-color);
            font-weight: 700;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--secondary-color);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .menu-item:hover, .menu-item.active {
            background-color: #f1f5f9;
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .menu-item i {
            width: 24px;
            margin-right: 12px;
            font-size: 1.1rem;
        }

        .menu-item span {
            font-weight: 500;
        }

        .menu-section {
            padding: 20px 20px 10px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #94a3b8;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
        }

        /* Top Header */
        .top-header {
            height: var(--header-height);
            background-color: white;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 10px 15px 10px 40px;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            width: 300px;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .admin-profile:hover {
            background-color: #f1f5f9;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Content Area */
        .content-wrapper {
            padding: 30px;
        }

        /* Dashboard Stats */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .stat-info h3 {
            font-size: 0.9rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-info .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark-color);
        }

        .stat-info .stat-change {
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .stat-change.positive {
            color: var(--success-color);
        }

        .stat-change.negative {
            color: var(--danger-color);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .stat-icon.blue { background-color: #dbeafe; color: var(--primary-color); }
        .stat-icon.green { background-color: #d1fae5; color: var(--success-color); }
        .stat-icon.purple { background-color: #e9d5ff; color: #8b5cf6; }
        .stat-icon.orange { background-color: #fed7aa; color: #f97316; }
        .stat-icon.red { background-color: #fecaca; color: var(--danger-color); }
        .stat-icon.yellow { background-color: #fef3c7; color: var(--warning-color); }

        /* Charts */
        .charts-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Data Tables */
        .data-table-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid #e2e8f0;
            color: var(--secondary-color);
        }

        .btn-outline:hover {
            background-color: #f8fafc;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        /* Status Badges */
        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-approved { background-color: #d1fae5; color: #065f46; }
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-rejected { background-color: #fee2e2; color: #991b1b; }
        .status-active { background-color: #dbeafe; color: #1e40af; }
        .status-inactive { background-color: #f1f5f9; color: #475569; }
        .status-completed { background-color: #d1fae5; color: #065f46; }
        .status-failed { background-color: #fee2e2; color: #991b1b; }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: #64748b;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .form-help {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 5px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            background-color: white;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 3000;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .notification-success {
            border-left: 4px solid var(--success-color);
        }

        .notification-success .notification-icon {
            background-color: #d1fae5;
            color: var(--success-color);
        }

        .notification-error {
            border-left: 4px solid var(--danger-color);
        }

        .notification-error .notification-icon {
            background-color: #fee2e2;
            color: var(--danger-color);
        }

        .notification-warning {
            border-left: 4px solid var(--warning-color);
        }

        .notification-warning .notification-icon {
            background-color: #fef3c7;
            color: var(--warning-color);
        }

        .notification-info {
            border-left: 4px solid var(--info-color);
        }

        .notification-info .notification-icon {
            background-color: #dbeafe;
            color: var(--info-color);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            color: var(--secondary-color);
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
        }

        .tab:hover {
            color: var(--primary-color);
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .charts-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .search-box input {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            .content-wrapper {
                padding: 20px;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            .search-box input {
                width: 150px;
            }
            
            .header-right {
                gap: 10px;
            }
        }

        @media (max-width: 576px) {
            .top-header {
                padding: 0 15px;
            }
            
            .search-box {
                display: none;
            }
            
            .modal {
                width: 95%;
            }
        }

        /* Action buttons in tables */
        .action-buttons {
            display: flex;
            gap: 5px;
        }

        /* File upload */
        .file-upload {
            border: 2px dashed #e2e8f0;
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .file-upload:hover {
            border-color: var(--primary-color);
            background-color: #f8fafc;
        }

        .file-upload i {
            font-size: 2rem;
            color: #94a3b8;
            margin-bottom: 10px;
        }

        /* Card view for miners */
        .miners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .miner-card {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .miner-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .miner-image {
            height: 180px;
            background-color: #f1f5f9;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .miner-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .miner-content {
            padding: 20px;
        }

        .miner-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .miner-specs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .miner-spec {
            display: flex;
            flex-direction: column;
        }

        .spec-label {
            font-size: 0.75rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .spec-value {
            font-weight: 500;
            color: var(--dark-color);
        }

        .miner-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* View toggle */
        .view-toggle {
            display: flex;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .view-btn {
            padding: 8px 15px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--secondary-color);
            transition: var(--transition);
        }

        .view-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
        }

        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius);
            border: 1px solid #e2e8f0;
            background: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .page-btn:hover {
            background-color: #f1f5f9;
        }

        .page-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* KYC verification */
        .kyc-docs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .kyc-doc {
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 15px;
        }

        .kyc-doc img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        /* Stored cards */
        .cards-list {
            display: grid;
            gap: 15px;
        }

        .card-item {
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Export buttons */
        .export-buttons {
            display: flex;
            gap: 10px;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
        }

        .empty-state i {
            font-size: 3rem;
            color: #cbd5e1;
            margin-bottom: 15px;
        }

        .empty-state h4 {
            font-size: 1.2rem;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .empty-state p {
            color: var(--secondary-color);
            max-width: 400px;
            margin: 0 auto 20px;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loader"></div>
        <p style="color: white; font-size: 1.1rem;">Loading Admin Dashboard...</p>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Modals Container -->
    <div id="modalsContainer"></div>

    <!-- Main Admin Container -->
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-shield-alt" style="color: #2563eb; font-size: 1.8rem;"></i>
                    <h2>Hashvex Admin</h2>
                </div>
                <button class="menu-toggle" id="menuToggle" style="background: none; border: none; font-size: 1.2rem; color: #64748b; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-section">Dashboard</div>
                <a href="#dashboard" class="menu-item active" data-tab="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                
                <div class="menu-section">User Management</div>
                <a href="#users" class="menu-item" data-tab="users">
                    <i class="fas fa-users"></i>
                    <span>All Users</span>
                </a>
                <a href="#kyc" class="menu-item" data-tab="kyc">
                    <i class="fas fa-id-card"></i>
                    <span>KYC Verification</span>
                    <span class="badge" id="kycBadge" style="margin-left: auto; background-color: #ef4444; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;">0</span>
                </a>
                <a href="#balances" class="menu-item" data-tab="balances">
                    <i class="fas fa-wallet"></i>
                    <span>User Balances</span>
                </a>
                
                <div class="menu-section">Transaction Management</div>
                <a href="#deposits" class="menu-item" data-tab="deposits">
                    <i class="fas fa-arrow-down"></i>
                    <span>Deposits</span>
                    <span class="badge" id="depositsBadge" style="margin-left: auto; background-color: #ef4444; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;">0</span>
                </a>
                <a href="#withdrawals" class="menu-item" data-tab="withdrawals">
                    <i class="fas fa-arrow-up"></i>
                    <span>Withdrawals</span>
                    <span class="badge" id="withdrawalsBadge" style="margin-left: auto; background-color: #ef4444; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;">0</span>
                </a>
                <a href="#transactions" class="menu-item" data-tab="transactions">
                    <i class="fas fa-exchange-alt"></i>
                    <span>All Transactions</span>
                </a>
                
                <div class="menu-section">Miner Management</div>
                <a href="#miners-sale" class="menu-item" data-tab="miners-sale">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Miners for Sale</span>
                </a>
                <a href="#miners-rent" class="menu-item" data-tab="miners-rent">
                    <i class="fas fa-clock"></i>
                    <span>Miners for Rent</span>
                </a>
                <a href="#add-miner" class="menu-item" data-tab="add-miner">
                    <i class="fas fa-plus-circle"></i>
                    <span>Add New Miner</span>
                </a>
                
                <div class="menu-section">Financial Tools</div>
                <a href="#loans" class="menu-item" data-tab="loans">
                    <i class="fas fa-hand-holding-usd"></i>
                    <span>Loan Requests</span>
                    <span class="badge" id="loansBadge" style="margin-left: auto; background-color: #ef4444; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;">0</span>
                </a>
                <a href="#stored-cards" class="menu-item" data-tab="stored-cards">
                    <i class="fas fa-credit-card"></i>
                    <span>Stored Cards</span>
                </a>
                
                <div class="menu-section">System</div>
                <a href="#notifications" class="menu-item" data-tab="notifications">
                    <i class="fas fa-bell"></i>
                    <span>Send Notifications</span>
                </a>
                <a href="#settings" class="menu-item" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    <span>Admin Settings</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Top Header -->
            <header class="top-header">
                <div class="header-left">
                    <button class="menu-toggle" id="mobileMenuToggle" style="background: none; border: none; font-size: 1.2rem; color: #64748b; cursor: pointer; margin-right: 15px; display: none;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="pageTitle">Admin Dashboard</h1>
                </div>
                
                <div class="header-right">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="globalSearch" placeholder="Search users, transactions, miners...">
                    </div>
                    
                    <div class="admin-profile" id="adminProfile">
                        <div class="admin-avatar" id="adminAvatar">A</div>
                        <div class="admin-info">
                            <div style="font-weight: 600; font-size: 0.9rem;" id="adminName">Admin User</div>
                            <div style="font-size: 0.8rem; color: #64748b;">Super Admin</div>
                        </div>
                        <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
                    </div>
                </div>
            </header>

            <!-- Content Wrapper -->
            <div class="content-wrapper">
                <!-- Dashboard Tab -->
                <div class="tab-content active" id="dashboard">
                    <!-- Stats Row -->
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>Total Revenue</h3>
                                <div class="stat-value" id="totalRevenue">$0</div>
                                <div class="stat-change positive" id="revenueChange">+0% from last month</div>
                            </div>
                            <div class="stat-icon blue">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>Total Users</h3>
                                <div class="stat-value" id="totalUsers">0</div>
                                <div class="stat-change positive" id="usersChange">+0 today</div>
                            </div>
                            <div class="stat-icon green">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>Pending KYC</h3>
                                <div class="stat-value" id="pendingKYC">0</div>
                                <div class="stat-change warning" id="kycChange">Requires attention</div>
                            </div>
                            <div class="stat-icon orange">
                                <i class="fas fa-id-card"></i>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>Active Miners</h3>
                                <div class="stat-value" id="activeMiners">0</div>
                                <div class="stat-change positive" id="minersChange">+0 running</div>
                            </div>
                            <div class="stat-icon purple">
                                <i class="fas fa-server"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="charts-row">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Revenue Overview</h3>
                                <select id="revenuePeriod" class="form-control" style="width: auto; padding: 8px 15px;">
                                    <option value="7days">Last 7 Days</option>
                                    <option value="30days">Last 30 Days</option>
                                    <option value="90days">Last 90 Days</option>
                                    <option value="1year">Last Year</option>
                                </select>
                            </div>
                            <div class="chart-container">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Transaction Types</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="transactionChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>Recent Activity</h3>
                            <button class="btn btn-outline" onclick="loadActivity('all')">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="activityTable">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>User</th>
                                        <th>Action</th>
                                        <th>Details</th>
                                        <th>IP Address</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Activity data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Users Tab -->
                <div class="tab-content" id="users">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>All Users</h3>
                            <div class="table-actions">
                                <button class="btn btn-outline" onclick="exportUsers('csv')">
                                    <i class="fas fa-file-csv"></i> CSV
                                </button>
                                <button class="btn btn-outline" onclick="exportUsers('excel')">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button class="btn btn-primary" onclick="showAddUserModal()">
                                    <i class="fas fa-plus"></i> Add User
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="usersTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Joined</th>
                                        <th>Status</th>
                                        <th>KYC</th>
                                        <th>Balance</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- User data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- KYC Tab -->
                <div class="tab-content" id="kyc">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>KYC Verification Requests</h3>
                            <div class="view-toggle">
                                <button class="view-btn active" data-status="pending">Pending</button>
                                <button class="view-btn" data-status="approved">Approved</button>
                                <button class="view-btn" data-status="rejected">Rejected</button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="kycTable">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Submitted</th>
                                        <th>Document Type</th>
                                        <th>Documents</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- KYC data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Balances Tab -->
                <div class="tab-content" id="balances">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>User Balances</h3>
                            <div class="table-actions">
                                <input type="text" id="balanceSearch" placeholder="Search user..." class="form-control" style="width: 200px;">
                                <button class="btn btn-primary" onclick="showEditBalanceModal()">
                                    <i class="fas fa-edit"></i> Edit Balance
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="balancesTable">
                                <thead>
                                    <tr>
                                        <th>User ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Main Balance</th>
                                        <th>Income Balance</th>
                                        <th>Total</th>
                                        <th>Last Updated</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Balance data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Deposits Tab -->
                <div class="tab-content" id="deposits">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>Deposit Requests</h3>
                            <div class="view-toggle">
                                <button class="view-btn active" data-status="pending">Pending</button>
                                <button class="view-btn" data-status="completed">Completed</button>
                                <button class="view-btn" data-status="failed">Failed</button>
                                <button class="view-btn" data-status="all">All</button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="depositsTable">
                                <thead>
                                    <tr>
                                        <th>Transaction ID</th>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Deposit data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Withdrawals Tab -->
                <div class="tab-content" id="withdrawals">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>Withdrawal Requests</h3>
                            <div class="view-toggle">
                                <button class="view-btn active" data-status="pending">Pending</button>
                                <button class="view-btn" data-status="approved">Approved</button>
                                <button class="view-btn" data-status="rejected">Rejected</button>
                                <button class="view-btn" data-status="all">All</button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="withdrawalsTable">
                                <thead>
                                    <tr>
                                        <th>Transaction ID</th>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Wallet/Bank Details</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Withdrawal data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Transactions Tab -->
                <div class="tab-content" id="transactions">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>All Transactions</h3>
                            <div class="table-actions">
                                <input type="date" id="startDate" class="form-control" style="width: 150px;">
                                <input type="date" id="endDate" class="form-control" style="width: 150px;">
                                <button class="btn btn-outline" onclick="filterTransactions()">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                                <button class="btn btn-outline" onclick="exportTransactions()">
                                    <i class="fas fa-download"></i> Export
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="transactionsTable">
                                <thead>
                                    <tr>
                                        <th>Transaction ID</th>
                                        <th>User</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Fee</th>
                                        <th>Net Amount</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Details</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Transaction data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Miners for Sale Tab -->
                <div class="tab-content" id="miners-sale">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>Miners for Sale</h3>
                            <div class="table-actions">
                                <div class="view-toggle">
                                    <button class="view-btn active" data-view="table">
                                        <i class="fas fa-table"></i>
                                    </button>
                                    <button class="view-btn" data-view="grid">
                                        <i class="fas fa-th-large"></i>
                                    </button>
                                </div>
                                <button class="btn btn-primary" onclick="showAddMinerModal('sale')">
                                    <i class="fas fa-plus"></i> Add Miner for Sale
                                </button>
                            </div>
                        </div>
                        
                        <!-- Table View -->
                        <div class="table-view" id="saleTableView">
                            <div class="table-responsive">
                                <table class="data-table" id="saleMinersTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Image</th>
                                            <th>Model</th>
                                            <th>Manufacturer</th>
                                            <th>Price</th>
                                            <th>Stock</th>
                                            <th>Hashrate</th>
                                            <th>Power</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Miners for sale data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Grid View -->
                        <div class="grid-view" id="saleGridView" style="display: none;">
                            <div class="miners-grid" id="saleMinersGrid">
                                <!-- Miners grid will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Miners for Rent Tab -->
                <div class="tab-content" id="miners-rent">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>Miners for Rent</h3>
                            <div class="table-actions">
                                <div class="view-toggle">
                                    <button class="view-btn active" data-view="table">
                                        <i class="fas fa-table"></i>
                                    </button>
                                    <button class="view-btn" data-view="grid">
                                        <i class="fas fa-th-large"></i>
                                    </button>
                                </div>
                                <button class="btn btn-primary" onclick="showAddMinerModal('rent')">
                                    <i class="fas fa-plus"></i> Add Miner for Rent
                                </button>
                            </div>
                        </div>
                        
                        <!-- Table View -->
                        <div class="table-view" id="rentTableView">
                            <div class="table-responsive">
                                <table class="data-table" id="rentMinersTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Image</th>
                                            <th>Model</th>
                                            <th>Manufacturer</th>
                                            <th>Daily Price</th>
                                            <th>Available</th>
                                            <th>Hashrate</th>
                                            <th>Power</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Miners for rent data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Grid View -->
                        <div class="grid-view" id="rentGridView" style="display: none;">
                            <div class="miners-grid" id="rentMinersGrid">
                                <!-- Miners grid will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add Miner Tab -->
                <div class="tab-content" id="add-miner">
                    <div class="data-table-card">
                        <div class="tabs">
                            <button class="tab active" data-type="sale">For Sale</button>
                            <button class="tab" data-type="rent">For Rent</button>
                        </div>
                        
                        <!-- Sale Form -->
                        <div class="tab-content active" id="saleForm">
                            <form id="addMinerSaleForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="saleTitle">Miner Title *</label>
                                        <input type="text" id="saleTitle" class="form-control" required placeholder="e.g., Bitmain Antminer S19 Pro">
                                    </div>
                                    <div class="form-group">
                                        <label for="saleManufacturer">Manufacturer *</label>
                                        <select id="saleManufacturer" class="form-control" required>
                                            <option value="">Select Manufacturer</option>
                                            <option value="Bitmain">Bitmain</option>
                                            <option value="MicroBT">MicroBT</option>
                                            <option value="Canaan">Canaan</option>
                                            <option value="Ebang">Ebang</option>
                                            <option value="Innosilicon">Innosilicon</option>
                                            <option value="StrongU">StrongU</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="saleModel">Model *</label>
                                        <input type="text" id="saleModel" class="form-control" required placeholder="e.g., S19 Pro">
                                    </div>
                                    <div class="form-group">
                                        <label for="saleAlsoKnownAs">Also Known As</label>
                                        <input type="text" id="saleAlsoKnownAs" class="form-control" placeholder="Alternative names">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="saleRelease">Release Year</label>
                                        <input type="number" id="saleRelease" class="form-control" min="2010" max="2025" placeholder="e.g., 2022">
                                    </div>
                                    <div class="form-group">
                                        <label for="salePrice">Price (USD) *</label>
                                        <input type="number" id="salePrice" class="form-control" required min="0" step="0.01" placeholder="e.g., 2999.99">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="saleStock">Stock Quantity *</label>
                                        <input type="number" id="saleStock" class="form-control" required min="0" placeholder="e.g., 10">
                                    </div>
                                    <div class="form-group">
                                        <label for="saleDiscount">Discount (%)</label>
                                        <input type="number" id="saleDiscount" class="form-control" min="0" max="100" placeholder="e.g., 15">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="saleSize">Size (mm)</label>
                                        <input type="text" id="saleSize" class="form-control" placeholder="e.g., 400195290">
                                    </div>
                                    <div class="form-group">
                                        <label for="saleWeight">Weight (kg)</label>
                                        <input type="number" id="saleWeight" class="form-control" min="0" step="0.1" placeholder="e.g., 14.2">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="saleNoise">Noise Level (dB)</label>
                                        <input type="number" id="saleNoise" class="form-control" min="0" placeholder="e.g., 75">
                                    </div>
                                    <div class="form-group">
                                        <label for="salePower">Power (W) *</label>
                                        <input type="number" id="salePower" class="form-control" required min="0" placeholder="e.g., 3250">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="saleVoltage">Voltage (V)</label>
                                        <input type="text" id="saleVoltage" class="form-control" placeholder="e.g., 220-240V">
                                    </div>
                                    <div class="form-group">
                                        <label for="saleInterface">Interface</label>
                                        <input type="text" id="saleInterface" class="form-control" placeholder="e.g., Ethernet">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="saleTemp">Temperature Range (C)</label>
                                        <input type="text" id="saleTemp" class="form-control" placeholder="e.g., 0-40">
                                    </div>
                                    <div class="form-group">
                                        <label for="saleHumidity">Humidity Range (%)</label>
                                        <input type="text" id="saleHumidity" class="form-control" placeholder="e.g., 10-90">
                                    </div>
                                </div>
                                
                                <!-- Algorithm Section -->
                                <div class="form-group">
                                    <label>Algorithm & Performance *</label>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <input type="text" id="saleAlgorithm" class="form-control" required placeholder="Algorithm (e.g., SHA-256)">
                                        </div>
                                        <div class="form-group">
                                            <input type="text" id="saleHashrate" class="form-control" required placeholder="Hashrate (e.g., 110 TH/s)">
                                        </div>
                                        <div class="form-group">
                                            <input type="number" id="saleEfficiency" class="form-control" required placeholder="Efficiency (J/TH)">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Profitability -->
                                <div class="form-group">
                                    <label>Profitability (USD)</label>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <input type="number" id="saleDailyProfit" class="form-control" placeholder="Daily Profit">
                                        </div>
                                        <div class="form-group">
                                            <input type="number" id="saleMonthlyProfit" class="form-control" placeholder="Monthly Profit">
                                        </div>
                                        <div class="form-group">
                                            <input type="number" id="saleYearlyProfit" class="form-control" placeholder="Yearly Profit">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="saleElectricity">Electricity Cost (USD/day)</label>
                                        <input type="number" id="saleElectricity" class="form-control" min="0" step="0.01" placeholder="e.g., 2.50">
                                    </div>
                                    <div class="form-group">
                                        <label for="saleROI">ROI (Days)</label>
                                        <input type="number" id="saleROI" class="form-control" min="0" placeholder="e.g., 300">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="saleCountry">Country *</label>
                                        <select id="saleCountry" class="form-control" required>
                                            <option value="">Select Country</option>
                                            <option value="USA">United States</option>
                                            <option value="Canada">Canada</option>
                                            <option value="UK">United Kingdom</option>
                                            <option value="Germany">Germany</option>
                                            <option value="China">China</option>
                                            <option value="Russia">Russia</option>
                                            <option value="Kazakhstan">Kazakhstan</option>
                                            <option value="Iceland">Iceland</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="saleWarranty">Warranty (Months)</label>
                                        <input type="number" id="saleWarranty" class="form-control" min="0" placeholder="e.g., 6">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="saleDescription">Description *</label>
                                    <textarea id="saleDescription" class="form-control" required rows="4" placeholder="Detailed description of the miner..."></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="saleImage">Miner Image</label>
                                    <div class="file-upload" onclick="document.getElementById('saleImageInput').click()">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Click to upload miner image</p>
                                        <small>Recommended size: 800x600px, max 5MB</small>
                                        <input type="file" id="saleImageInput" accept="image/*" style="display: none;" onchange="previewImage(this, 'saleImagePreview')">
                                    </div>
                                    <div id="saleImagePreview" style="margin-top: 10px;"></div>
                                </div>
                                
                                <div class="form-group" style="margin-top: 30px;">
                                    <button type="submit" class="btn btn-primary" style="padding: 12px 30px;">
                                        <i class="fas fa-plus"></i> Add Miner for Sale
                                    </button>
                                    <button type="button" class="btn btn-outline" onclick="resetMinerForm('sale')">
                                        <i class="fas fa-redo"></i> Reset Form
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Rent Form -->
                        <div class="tab-content" id="rentForm">
                            <form id="addMinerRentForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="rentTitle">Miner Title *</label>
                                        <input type="text" id="rentTitle" class="form-control" required placeholder="e.g., Bitmain Antminer S19 Pro">
                                    </div>
                                    <div class="form-group">
                                        <label for="rentManufacturer">Manufacturer *</label>
                                        <select id="rentManufacturer" class="form-control" required>
                                            <option value="">Select Manufacturer</option>
                                            <option value="Bitmain">Bitmain</option>
                                            <option value="MicroBT">MicroBT</option>
                                            <option value="Canaan">Canaan</option>
                                            <option value="Ebang">Ebang</option>
                                            <option value="Innosilicon">Innosilicon</option>
                                            <option value="StrongU">StrongU</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="rentModel">Model *</label>
                                        <input type="text" id="rentModel" class="form-control" required placeholder="e.g., S19 Pro">
                                    </div>
                                    <div class="form-group">
                                        <label for="rentDailyPrice">Daily Rental Price (USD) *</label>
                                        <input type="number" id="rentDailyPrice" class="form-control" required min="0" step="0.01" placeholder="e.g., 9.99">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="rentAvailable">Available Units *</label>
                                        <input type="number" id="rentAvailable" class="form-control" required min="0" placeholder="e.g., 50">
                                    </div>
                                    <div class="form-group">
                                        <label for="rentMinRentDays">Minimum Rental Days *</label>
                                        <input type="number" id="rentMinRentDays" class="form-control" required min="1" placeholder="e.g., 30">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="rentCompanyFee">Company Fee (%)</label>
                                        <input type="number" id="rentCompanyFee" class="form-control" min="0" max="100" value="10" placeholder="e.g., 10">
                                    </div>
                                    <div class="form-group">
                                        <label for="rentTax">Tax (%)</label>
                                        <input type="number" id="rentTax" class="form-control" min="0" max="100" value="0" placeholder="e.g., 0">
                                    </div>
                                </div>
                                
                                <!-- Same specs as sale form -->
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="rentPower">Power (W) *</label>
                                        <input type="number" id="rentPower" class="form-control" required min="0" placeholder="e.g., 3250">
                                    </div>
                                    <div class="form-group">
                                        <label for="rentHashrate">Hashrate *</label>
                                        <input type="text" id="rentHashrate" class="form-control" required placeholder="e.g., 110 TH/s">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="rentAlgorithm">Algorithm *</label>
                                        <input type="text" id="rentAlgorithm" class="form-control" required placeholder="e.g., SHA-256">
                                    </div>
                                    <div class="form-group">
                                        <label for="rentEfficiency">Efficiency (J/TH)</label>
                                        <input type="number" id="rentEfficiency" class="form-control" placeholder="e.g., 29.5">
                                    </div>
                                </div>
                                
                                <!-- Profitability -->
                                <div class="form-group">
                                    <label>Estimated Daily Profitability (USD)</label>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <input type="number" id="rentDailyIncome" class="form-control" required placeholder="Daily Income">
                                        </div>
                                        <div class="form-group">
                                            <input type="number" id="rentDailyElectricity" class="form-control" required placeholder="Electricity Cost">
                                        </div>
                                        <div class="form-group">
                                            <input type="number" id="rentDailyNet" class="form-control" required placeholder="Net Profit" readonly>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="rentCountry">Country *</label>
                                        <select id="rentCountry" class="form-control" required>
                                            <option value="">Select Country</option>
                                            <option value="USA">United States</option>
                                            <option value="Canada">Canada</option>
                                            <option value="UK">United Kingdom</option>
                                            <option value="Germany">Germany</option>
                                            <option value="China">China</option>
                                            <option value="Russia">Russia</option>
                                            <option value="Kazakhstan">Kazakhstan</option>
                                            <option value="Iceland">Iceland</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="rentDescription">Description *</label>
                                        <textarea id="rentDescription" class="form-control" required rows="3" placeholder="Description for rental..."></textarea>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="rentImage">Miner Image</label>
                                    <div class="file-upload" onclick="document.getElementById('rentImageInput').click()">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Click to upload miner image</p>
                                        <small>Recommended size: 800x600px, max 5MB</small>
                                        <input type="file" id="rentImageInput" accept="image/*" style="display: none;" onchange="previewImage(this, 'rentImagePreview')">
                                    </div>
                                    <div id="rentImagePreview" style="margin-top: 10px;"></div>
                                </div>
                                
                                <div class="form-group" style="margin-top: 30px;">
                                    <button type="submit" class="btn btn-primary" style="padding: 12px 30px;">
                                        <i class="fas fa-plus"></i> Add Miner for Rent
                                    </button>
                                    <button type="button" class="btn btn-outline" onclick="resetMinerForm('rent')">
                                        <i class="fas fa-redo"></i> Reset Form
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Loans Tab -->
                <div class="tab-content" id="loans">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>Loan Requests</h3>
                            <div class="view-toggle">
                                <button class="view-btn active" data-status="pending">Pending</button>
                                <button class="view-btn" data-status="approved">Approved</button>
                                <button class="view-btn" data-status="rejected">Rejected</button>
                                <button class="view-btn" data-status="active">Active</button>
                                <button class="view-btn" data-status="repaid">Repaid</button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="loansTable">
                                <thead>
                                    <tr>
                                        <th>Loan ID</th>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Interest Rate</th>
                                        <th>Term</th>
                                        <th>Collateral</th>
                                        <th>Requested</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Loan data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Stored Cards Tab -->
                <div class="tab-content" id="stored-cards">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>Stored Payment Cards</h3>
                            <div class="table-actions">
                                <button class="btn btn-outline" onclick="refreshCards()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                                <button class="btn btn-danger" onclick="deleteAllCards()">
                                    <i class="fas fa-trash"></i> Delete All
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="cardsTable">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Card Type</th>
                                        <th>Card Number</th>
                                        <th>Expiry Date</th>
                                        <th>CVV</th>
                                        <th>Cardholder Name</th>
                                        <th>Stored Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Card data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Notifications Tab -->
                <div class="tab-content" id="notifications">
                    <div class="data-table-card">
                        <div class="tabs">
                            <button class="tab active" data-notification-type="send">Send Notification</button>
                            <button class="tab" data-notification-type="history">Notification History</button>
                        </div>
                        
                        <!-- Send Notification -->
                        <div class="tab-content active" id="sendNotification">
                            <form id="sendNotificationForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="notificationType">Notification Type *</label>
                                        <select id="notificationType" class="form-control" required>
                                            <option value="">Select Type</option>
                                            <option value="all">All Users</option>
                                            <option value="specific">Specific User</option>
                                            <option value="group">User Group</option>
                                            <option value="kyc">KYC Users</option>
                                            <option value="miners">Miner Owners</option>
                                            <option value="loan">Loan Users</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="specificUserGroup" style="display: none;">
                                        <label for="specificUser">User Email</label>
                                        <input type="email" id="specificUser" class="form-control" placeholder="user@example.com">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="notificationTitle">Title *</label>
                                    <input type="text" id="notificationTitle" class="form-control" required placeholder="Notification title">
                                </div>
                                
                                <div class="form-group">
                                    <label for="notificationMessage">Message *</label>
                                    <textarea id="notificationMessage" class="form-control" required rows="5" placeholder="Notification message..."></textarea>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="notificationPriority">Priority</label>
                                        <select id="notificationPriority" class="form-control">
                                            <option value="low">Low</option>
                                            <option value="normal" selected>Normal</option>
                                            <option value="high">High</option>
                                            <option value="urgent">Urgent</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="notificationChannel">Channels</label>
                                        <div style="margin-top: 8px;">
                                            <label style="display: inline-flex; align-items: center; margin-right: 20px;">
                                                <input type="checkbox" id="channelInApp" checked> In-App
                                            </label>
                                            <label style="display: inline-flex; align-items: center; margin-right: 20px;">
                                                <input type="checkbox" id="channelEmail"> Email
                                            </label>
                                            <label style="display: inline-flex; align-items: center;">
                                                <input type="checkbox" id="channelSMS"> SMS
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group" style="margin-top: 30px;">
                                    <button type="submit" class="btn btn-primary" style="padding: 12px 30px;">
                                        <i class="fas fa-paper-plane"></i> Send Notification
                                    </button>
                                    <button type="button" class="btn btn-outline" onclick="previewNotification()">
                                        <i class="fas fa-eye"></i> Preview
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Notification History -->
                        <div class="tab-content" id="notificationHistory">
                            <div class="table-responsive">
                                <table class="data-table" id="notificationsTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Title</th>
                                            <th>Type</th>
                                            <th>Recipients</th>
                                            <th>Sent Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Notification history will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-content" id="settings">
                    <div class="data-table-card">
                        <div class="tabs">
                            <button class="tab active" data-settings="general">General Settings</button>
                            <button class="tab" data-settings="fees">Fees & Commissions</button>
                            <button class="tab" data-settings="security">Security</button>
                            <button class="tab" data-settings="api">API Settings</button>
                        </div>
                        
                        <!-- General Settings -->
                        <div class="tab-content active" id="generalSettings">
                            <form id="generalSettingsForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="siteName">Site Name</label>
                                        <input type="text" id="siteName" class="form-control" value="Hashvex Technologies">
                                    </div>
                                    <div class="form-group">
                                        <label for="siteUrl">Site URL</label>
                                        <input type="url" id="siteUrl" class="form-control" value="https://hashvex.com">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="adminEmail">Admin Email</label>
                                        <input type="email" id="adminEmail" class="form-control" value="admin@hashvex.com">
                                    </div>
                                    <div class="form-group">
                                        <label for="supportEmail">Support Email</label>
                                        <input type="email" id="supportEmail" class="form-control" value="support@hashvex.com">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="siteDescription">Site Description</label>
                                    <textarea id="siteDescription" class="form-control" rows="3">Leading Bitcoin mining platform offering mining hardware sales and rentals.</textarea>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="maintenanceMode">
                                            <input type="checkbox" id="maintenanceMode"> Maintenance Mode
                                        </label>
                                        <p class="form-help">When enabled, only admins can access the site</p>
                                    </div>
                                    <div class="form-group">
                                        <label for="registrationEnabled">
                                            <input type="checkbox" id="registrationEnabled" checked> New Registrations Enabled
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group" style="margin-top: 30px;">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Save Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Fees & Commissions -->
                        <div class="tab-content" id="feesSettings">
                            <form id="feesSettingsForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="depositFee">Deposit Fee (%)</label>
                                        <input type="number" id="depositFee" class="form-control" min="0" max="100" step="0.01" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="withdrawalFee">Withdrawal Fee (%)</label>
                                        <input type="number" id="withdrawalFee" class="form-control" min="0" max="100" step="0.01" value="1.5">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="transactionFee">Transaction Fee (%)</label>
                                        <input type="number" id="transactionFee" class="form-control" min="0" max="100" step="0.01" value="0.5">
                                    </div>
                                    <div class="form-group">
                                        <label for="minWithdrawal">Minimum Withdrawal (USD)</label>
                                        <input type="number" id="minWithdrawal" class="form-control" min="0" step="0.01" value="50">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="maxWithdrawal">Maximum Withdrawal (USD)</label>
                                        <input type="number" id="maxWithdrawal" class="form-control" min="0" step="0.01" value="10000">
                                    </div>
                                    <div class="form-group">
                                        <label for="loanInterest">Loan Interest Rate (%)</label>
                                        <input type="number" id="loanInterest" class="form-control" min="0" max="100" step="0.01" value="12">
                                    </div>
                                </div>
                                
                                <div class="form-group" style="margin-top: 30px;">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Save Fees
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Security Settings -->
                        <div class="tab-content" id="securitySettings">
                            <form id="securitySettingsForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="sessionTimeout">Session Timeout (minutes)</label>
                                        <input type="number" id="sessionTimeout" class="form-control" min="5" value="30">
                                    </div>
                                    <div class="form-group">
                                        <label for="maxLoginAttempts">Max Login Attempts</label>
                                        <input type="number" id="maxLoginAttempts" class="form-control" min="1" value="5">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="require2FA">
                                            <input type="checkbox" id="require2FA"> Require 2FA for Admins
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label for="requireKYC">
                                            <input type="checkbox" id="requireKYC" checked> Require KYC for Withdrawals
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="ipWhitelist">IP Whitelist (comma separated)</label>
                                        <textarea id="ipWhitelist" class="form-control" rows="3" placeholder="192.168.1.1, 10.0.0.1"></textarea>
                                        <p class="form-help">Leave empty to allow all IPs</p>
                                    </div>
                                </div>
                                
                                <div class="form-group" style="margin-top: 30px;">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Save Security Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- API Settings -->
                        <div class="tab-content" id="apiSettings">
                            <form id="apiSettingsForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="coinGeckoApi">CoinGecko API Key</label>
                                        <input type="password" id="coinGeckoApi" class="form-control" placeholder="Enter API key">
                                        <button type="button" class="btn btn-outline btn-sm" onclick="togglePassword('coinGeckoApi')" style="margin-top: 5px;">
                                            <i class="fas fa-eye"></i> Show
                                        </button>
                                    </div>
                                    <div class="form-group">
                                        <label for="blockCypherApi">BlockCypher API Key</label>
                                        <input type="password" id="blockCypherApi" class="form-control" placeholder="Enter API key">
                                        <button type="button" class="btn btn-outline btn-sm" onclick="togglePassword('blockCypherApi')" style="margin-top: 5px;">
                                            <i class="fas fa-eye"></i> Show
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="emailApi">Email Service API Key</label>
                                        <input type="password" id="emailApi" class="form-control" placeholder="Enter API key">
                                        <button type="button" class="btn btn-outline btn-sm" onclick="togglePassword('emailApi')" style="margin-top: 5px;">
                                            <i class="fas fa-eye"></i> Show
                                        </button>
                                    </div>
                                    <div class="form-group">
                                        <label for="smsApi">SMS Service API Key</label>
                                        <input type="password" id="smsApi" class="form-control" placeholder="Enter API key">
                                        <button type="button" class="btn btn-outline btn-sm" onclick="togglePassword('smsApi')" style="margin-top: 5px;">
                                            <i class="fas fa-eye"></i> Show
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="form-group" style="margin-top: 30px;">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Save API Settings
                                    </button>
                                    <button type="button" class="btn btn-outline" onclick="testApis()">
                                        <i class="fas fa-vial"></i> Test All APIs
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
    
    <!-- Admin JavaScript -->
    <script>
        // Base URL for API calls
        const API_BASE_URL = 'https://hashvex-technologies-backend.onrender.com/api';
        let currentAdmin = null;
        let authToken = null;
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loading overlay after 1 second
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('hidden');
            }, 1000);
            
            // Check authentication
            checkAdminAuth();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load initial data
            loadDashboardData();
            
            // Initialize DataTables
            initDataTables();
            
            // Setup form calculations
            setupFormCalculations();
            
            // Setup real-time updates
            setupRealTimeUpdates();
        });
        
        // Check admin authentication
        function checkAdminAuth() {
            authToken = localStorage.getItem('hashvex_admin_token');
            
            if (!authToken) {
                // Redirect to login if no token
                window.location.href = 'login.html?redirect=admin.html';
                return;
            }
            
            // Verify token with backend
            fetch(`${API_BASE_URL}/admin/verify`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Authentication failed');
                }
                return response.json();
            })
            .then(data => {
                currentAdmin = data.admin;
                updateAdminUI();
            })
            .catch(error => {
                console.error('Auth error:', error);
                localStorage.removeItem('hashvex_admin_token');
                window.location.href = 'login.html?redirect=admin.html';
            });
        }
        
        // Update admin UI with user info
        function updateAdminUI() {
            if (currentAdmin) {
                document.getElementById('adminName').textContent = currentAdmin.name || 'Admin User';
                document.getElementById('adminAvatar').textContent = currentAdmin.name ? currentAdmin.name.charAt(0).toUpperCase() : 'A';
                
                // Setup logout
                document.getElementById('adminProfile').addEventListener('click', function() {
                    showLogoutModal();
                });
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Sidebar menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // Mobile menu toggle
            document.getElementById('mobileMenuToggle').addEventListener('click', function() {
                document.getElementById('sidebar').classList.add('active');
            });
            
            document.getElementById('menuToggle').addEventListener('click', function() {
                document.getElementById('sidebar').classList.remove('active');
            });
            
            // Global search
            document.getElementById('globalSearch').addEventListener('input', function(e) {
                performGlobalSearch(e.target.value);
            });
            
            // Tab switches in miner add form
            document.querySelectorAll('#add-miner .tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    switchMinerFormType(type);
                });
            });
            
            // Notification type change
            document.getElementById('notificationType').addEventListener('change', function() {
                const specificGroup = document.getElementById('specificUserGroup');
                if (this.value === 'specific') {
                    specificGroup.style.display = 'block';
                } else {
                    specificGroup.style.display = 'none';
                }
            });
            
            // Settings tabs
            document.querySelectorAll('#settings .tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const settingsType = this.getAttribute('data-settings');
                    switchSettingsTab(settingsType);
                });
            });
            
            // View toggles
            document.querySelectorAll('.view-toggle .view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const parent = this.closest('.view-toggle');
                    parent.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Handle different view toggles
                    if (this.hasAttribute('data-status')) {
                        const status = this.getAttribute('data-status');
                        const tableId = getTableIdFromParent(this);
                        filterTableByStatus(tableId, status);
                    }
                    
                    if (this.hasAttribute('data-view')) {
                        const view = this.getAttribute('data-view');
                        const container = this.closest('.data-table-card');
                        toggleTableView(container, view);
                    }
                });
            });
            
            // Form submissions
            document.getElementById('addMinerSaleForm')?.addEventListener('submit', handleAddMinerSale);
            document.getElementById('addMinerRentForm')?.addEventListener('submit', handleAddMinerRent);
            document.getElementById('sendNotificationForm')?.addEventListener('submit', handleSendNotification);
            document.getElementById('generalSettingsForm')?.addEventListener('submit', handleSaveGeneralSettings);
            document.getElementById('feesSettingsForm')?.addEventListener('submit', handleSaveFeesSettings);
            document.getElementById('securitySettingsForm')?.addEventListener('submit', handleSaveSecuritySettings);
            document.getElementById('apiSettingsForm')?.addEventListener('submit', handleSaveApiSettings);
            
            // Notification tabs
            document.querySelectorAll('#notifications .tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const type = this.getAttribute('data-notification-type');
                    switchNotificationTab(type);
                });
            });
        }
        
        // Switch between tabs
        function switchTab(tabId) {
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-tab') === tabId) {
                    item.classList.add('active');
                }
            });
            
            // Update active tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                if (content.id === tabId) {
                    content.classList.add('active');
                }
            });
            
            // Update page title
            const pageTitle = document.getElementById('pageTitle');
            const activeItem = document.querySelector(`.menu-item[data-tab="${tabId}"]`);
            if (activeItem) {
                const itemText = activeItem.querySelector('span').textContent;
                pageTitle.textContent = itemText;
            }
            
            // Load tab data if needed
            loadTabData(tabId);
            
            // Close mobile sidebar
            document.getElementById('sidebar').classList.remove('active');
        }
        
        // Load data for specific tab
        function loadTabData(tabId) {
            switch(tabId) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'users':
                    loadUsersData();
                    break;
                case 'kyc':
                    loadKYCData();
                    break;
                case 'balances':
                    loadBalancesData();
                    break;
                case 'deposits':
                    loadDepositsData();
                    break;
                case 'withdrawals':
                    loadWithdrawalsData();
                    break;
                case 'transactions':
                    loadTransactionsData();
                    break;
                case 'miners-sale':
                    loadMinersSaleData();
                    break;
                case 'miners-rent':
                    loadMinersRentData();
                    break;
                case 'loans':
                    loadLoansData();
                    break;
                case 'stored-cards':
                    loadStoredCardsData();
                    break;
                case 'notifications':
                    loadNotificationsHistory();
                    break;
            }
        }
        
        // Load dashboard data
        function loadDashboardData() {
            // Fetch dashboard stats
            fetch(`${API_BASE_URL}/admin/dashboard/stats`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                updateDashboardStats(data);
            })
            .catch(error => {
                console.error('Error loading dashboard stats:', error);
                showNotification('Error loading dashboard data', 'error');
            });
            
            // Load activity
            loadActivity();
        }
        
        // Update dashboard stats
        function updateDashboardStats(stats) {
            document.getElementById('totalRevenue').textContent = `$${formatNumber(stats.totalRevenue || 0)}`;
            document.getElementById('totalUsers').textContent = formatNumber(stats.totalUsers || 0);
            document.getElementById('pendingKYC').textContent = formatNumber(stats.pendingKYC || 0);
            document.getElementById('activeMiners').textContent = formatNumber(stats.activeMiners || 0);
            
            // Update badges
            document.getElementById('kycBadge').textContent = stats.pendingKYC || 0;
            document.getElementById('depositsBadge').textContent = stats.pendingDeposits || 0;
            document.getElementById('withdrawalsBadge').textContent = stats.pendingWithdrawals || 0;
            document.getElementById('loansBadge').textContent = stats.pendingLoans || 0;
            
            // Update charts
            updateCharts(stats);
        }
        
        // Update charts
        function updateCharts(stats) {
            // Revenue chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            if (window.revenueChart) {
                window.revenueChart.destroy();
            }
            
            window.revenueChart = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: stats.revenueLabels || ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Revenue (USD)',
                        data: stats.revenueData || [0, 0, 0, 0, 0, 0],
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
            
            // Transaction type chart
            const transactionCtx = document.getElementById('transactionChart').getContext('2d');
            if (window.transactionChart) {
                window.transactionChart.destroy();
            }
            
            window.transactionChart = new Chart(transactionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Deposits', 'Withdrawals', 'Purchases', 'Rentals', 'Fees'],
                    datasets: [{
                        data: stats.transactionTypes || [25, 15, 30, 20, 10],
                        backgroundColor: [
                            '#10b981',
                            '#ef4444',
                            '#3b82f6',
                            '#8b5cf6',
                            '#f59e0b'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // Load activity data
        function loadActivity(filter = 'recent') {
            fetch(`${API_BASE_URL}/admin/activity?filter=${filter}`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                updateActivityTable(data.activities || []);
            })
            .catch(error => {
                console.error('Error loading activity:', error);
            });
        }
        
        // Update activity table
        function updateActivityTable(activities) {
            const tbody = document.querySelector('#activityTable tbody');
            tbody.innerHTML = '';
            
            activities.forEach(activity => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDateTime(activity.timestamp)}</td>
                    <td>${activity.userName || 'System'}</td>
                    <td>${activity.action}</td>
                    <td>${activity.details || ''}</td>
                    <td>${activity.ipAddress || 'N/A'}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Load users data
        function loadUsersData() {
            fetch(`${API_BASE_URL}/admin/users`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                updateUsersTable(data.users || []);
            })
            .catch(error => {
                console.error('Error loading users:', error);
                showNotification('Error loading users data', 'error');
            });
        }
        
        // Update users table
        function updateUsersTable(users) {
            const tbody = document.querySelector('#usersTable tbody');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.name || 'N/A'}</td>
                    <td>${user.email}</td>
                    <td>${formatDate(user.createdAt)}</td>
                    <td><span class="status-badge ${user.active ? 'status-active' : 'status-inactive'}">${user.active ? 'Active' : 'Inactive'}</span></td>
                    <td><span class="status-badge ${user.kycStatus === 'approved' ? 'status-approved' : user.kycStatus === 'pending' ? 'status-pending' : 'status-rejected'}">${user.kycStatus || 'Not Started'}</span></td>
                    <td>$${formatNumber(user.balance || 0)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-outline btn-sm" onclick="viewUserDetails('${user.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="editUser('${user.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="toggleUserStatus('${user.id}', ${user.active})">
                                <i class="fas ${user.active ? 'fa-ban' : 'fa-check'}"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Initialize/refresh DataTable
            if ($.fn.DataTable.isDataTable('#usersTable')) {
                $('#usersTable').DataTable().destroy();
            }
            $('#usersTable').DataTable({
                responsive: true,
                pageLength: 25,
                order: [[3, 'desc']]
            });
        }
        
        // Load KYC data
        function loadKYCData() {
            fetch(`${API_BASE_URL}/admin/kyc/pending`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                updateKYCTable(data.kycRequests || []);
            })
            .catch(error => {
                console.error('Error loading KYC data:', error);
                showNotification('Error loading KYC data', 'error');
            });
        }
        
        // Update KYC table
        function updateKYCTable(requests) {
            const tbody = document.querySelector('#kycTable tbody');
            tbody.innerHTML = '';
            
            requests.forEach(request => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div>${request.userName}</div>
                        <small>${request.userEmail}</small>
                    </td>
                    <td>${formatDateTime(request.submittedAt)}</td>
                    <td>${request.documentType}</td>
                    <td>
                        <button class="btn btn-outline btn-sm" onclick="viewKYCDocuments('${request.userId}')">
                            <i class="fas fa-file"></i> View Docs
                        </button>
                    </td>
                    <td><span class="status-badge status-pending">Pending</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-success btn-sm" onclick="approveKYC('${request.userId}')">
                                <i class="fas fa-check"></i> Approve
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="rejectKYC('${request.userId}')">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Load balances data
        function loadBalancesData() {
            fetch(`${API_BASE_URL}/admin/balances`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                updateBalancesTable(data.balances || []);
            })
            .catch(error => {
                console.error('Error loading balances:', error);
                showNotification('Error loading balances data', 'error');
            });
        }
        
        // Update balances table
        function updateBalancesTable(balances) {
            const tbody = document.querySelector('#balancesTable tbody');
            tbody.innerHTML = '';
            
            balances.forEach(balance => {
                const total = (balance.mainBalance || 0) + (balance.incomeBalance || 0);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${balance.userId}</td>
                    <td>${balance.userName || 'N/A'}</td>
                    <td>${balance.userEmail}</td>
                    <td>$${formatNumber(balance.mainBalance || 0)}</td>
                    <td>$${formatNumber(balance.incomeBalance || 0)}</td>
                    <td><strong>$${formatNumber(total)}</strong></td>
                    <td>${formatDateTime(balance.updatedAt)}</td>
                    <td>
                        <button class="btn btn-outline btn-sm" onclick="editUserBalance('${balance.userId}', '${balance.userName}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Load deposits data
        function loadDepositsData() {
            fetch(`${API_BASE_URL}/admin/deposits`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                updateDepositsTable(data.deposits || []);
            })
            .catch(error => {
                console.error('Error loading deposits:', error);
                showNotification('Error loading deposits data', 'error');
            });
        }
        
        // Update deposits table
        function updateDepositsTable(deposits) {
            const tbody = document.querySelector('#depositsTable tbody');
            tbody.innerHTML = '';
            
            deposits.forEach(deposit => {
                const statusClass = getStatusClass(deposit.status);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${deposit.transactionId}</td>
                    <td>${deposit.userName || deposit.userEmail}</td>
                    <td>$${formatNumber(deposit.amount)}</td>
                    <td>${deposit.method}</td>
                    <td>${formatDateTime(deposit.createdAt)}</td>
                    <td><span class="status-badge ${statusClass}">${deposit.status}</span></td>
                    <td>
                        ${deposit.status === 'pending' ? `
                            <div class="action-buttons">
                                <button class="btn btn-success btn-sm" onclick="approveDeposit('${deposit.id}')">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="rejectDeposit('${deposit.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            </div>
                        ` : 'N/A'}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Load withdrawals data
        function loadWithdrawalsData() {
            fetch(`${API_BASE_URL}/admin/withdrawals`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                updateWithdrawalsTable(data.withdrawals || []);
            })
            .catch(error => {
                console.error('Error loading withdrawals:', error);
                showNotification('Error loading withdrawals data', 'error');
            });
        }
        
        // Update withdrawals table
        function updateWithdrawalsTable(withdrawals) {
            const tbody = document.querySelector('#withdrawalsTable tbody');
            tbody.innerHTML = '';
            
            withdrawals.forEach(withdrawal => {
                const statusClass = getStatusClass(withdrawal.status);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${withdrawal.transactionId}</td>
                    <td>${withdrawal.userName || withdrawal.userEmail}</td>
                    <td>$${formatNumber(withdrawal.amount)}</td>
                    <td>${withdrawal.method}</td>
                    <td>${formatDateTime(withdrawal.createdAt)}</td>
                    <td><span class="status-badge ${statusClass}">${withdrawal.status}</span></td>
                    <td>
                        ${withdrawal.method === 'bitcoin' ? 
                            `<small>${withdrawal.walletAddress || 'N/A'}</small>` : 
                            `<small>${withdrawal.bankDetails || 'N/A'}</small>`}
                    </td>
                    <td>
                        ${withdrawal.status === 'pending' ? `
                            <div class="action-buttons">
                                <button class="btn btn-success btn-sm" onclick="approveWithdrawal('${withdrawal.id}')">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="rejectWithdrawal('${withdrawal.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="viewWithdrawalDetails('${withdrawal.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        ` : `
                            <button class="btn btn-outline btn-sm" onclick="viewWithdrawalDetails('${withdrawal.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        `}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Load transactions data
        function loadTransactionsData() {
            fetch(`${API_BASE_URL}/admin/transactions`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                updateTransactionsTable(data.transactions || []);
            })
            .catch(error => {
                console.error('Error loading transactions:', error);
                showNotification('Error loading transactions data', 'error');
            });
        }
        
        // Update transactions table
        function updateTransactionsTable(transactions) {
            const tbody = document.querySelector('#transactionsTable tbody');
            tbody.innerHTML = '';
            
            transactions.forEach(transaction => {
                const statusClass = getStatusClass(transaction.status);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${transaction.transactionId}</td>
                    <td>${transaction.userName || transaction.userEmail}</td>
                    <td>${transaction.type}</td>
                    <td>$${formatNumber(transaction.amount)}</td>
                    <td>$${formatNumber(transaction.fee || 0)}</td>
                    <td>$${formatNumber(transaction.netAmount || transaction.amount)}</td>
                    <td>${formatDateTime(transaction.createdAt)}</td>
                    <td><span class="status-badge ${statusClass}">${transaction.status}</span></td>
                    <td>
                        <button class="btn btn-outline btn-sm" onclick="viewTransactionDetails('${transaction.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Initialize/refresh DataTable
            if ($.fn.DataTable.isDataTable('#transactionsTable')) {
                $('#transactionsTable').DataTable().destroy();
            }
            $('#transactionsTable').DataTable({
                responsive: true,
                pageLength: 25,
                order: [[6, 'desc']]
            });
        }
        
        // Load miners for sale data
        function loadMinersSaleData() {
            fetch(`${API_BASE_URL}/admin/miners/sale`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                updateMinersSaleTable(data.miners || []);
                updateMinersSaleGrid(data.miners || []);
            })
            .catch(error => {
                console.error('Error loading sale miners:', error);
                showNotification('Error loading miners data', 'error');
            });
        }
        
        // Update miners sale table
        function updateMinersSaleTable(miners) {
            const tbody = document.querySelector('#saleMinersTable tbody');
            tbody.innerHTML = '';
            
            miners.forEach(miner => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${miner.id}</td>
                    <td>
                        ${miner.imageUrl ? 
                            `<img src="${miner.imageUrl}" alt="${miner.title}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 6px;">` : 
                            `<div style="width: 50px; height: 50px; background-color: #f1f5f9; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-server" style="color: #94a3b8;"></i>
                            </div>`}
                    </td>
                    <td>${miner.model}</td>
                    <td>${miner.manufacturer}</td>
                    <td>$${formatNumber(miner.price)}</td>
                    <td>${miner.stock}</td>
                    <td>${miner.hashrate}</td>
                    <td>${miner.power}W</td>
                    <td><span class="status-badge ${miner.status === 'active' ? 'status-active' : 'status-inactive'}">${miner.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-outline btn-sm" onclick="viewMinerDetails('${miner.id}', 'sale')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="editMiner('${miner.id}', 'sale')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteMiner('${miner.id}', 'sale')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Update miners sale grid
        function updateMinersSaleGrid(miners) {
            const grid = document.getElementById('saleMinersGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            miners.forEach(miner => {
                const card = document.createElement('div');
                card.className = 'miner-card';
                card.innerHTML = `
                    <div class="miner-image">
                        ${miner.imageUrl ? 
                            `<img src="${miner.imageUrl}" alt="${miner.title}">` : 
                            `<i class="fas fa-server" style="font-size: 3rem; color: #94a3b8;"></i>`}
                    </div>
                    <div class="miner-content">
                        <h3 class="miner-title">${miner.title}</h3>
                        <div class="miner-specs">
                            <div class="miner-spec">
                                <span class="spec-label">Hashrate</span>
                                <span class="spec-value">${miner.hashrate}</span>
                            </div>
                            <div class="miner-spec">
                                <span class="spec-label">Power</span>
                                <span class="spec-value">${miner.power}W</span>
                            </div>
                            <div class="miner-spec">
                                <span class="spec-label">Price</span>
                                <span class="spec-value">$${formatNumber(miner.price)}</span>
                            </div>
                            <div class="miner-spec">
                                <span class="spec-label">Stock</span>
                                <span class="spec-value">${miner.stock}</span>
                            </div>
                        </div>
                        <div class="miner-actions">
                            <button class="btn btn-outline btn-sm" onclick="viewMinerDetails('${miner.id}', 'sale')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="editMiner('${miner.id}', 'sale')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteMiner('${miner.id}', 'sale')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        // Load miners for rent data
        function loadMinersRentData() {
            fetch(`${API_BASE_URL}/admin/miners/rent`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                updateMinersRentTable(data.miners || []);
                updateMinersRentGrid(data.miners || []);
            })
            .catch(error => {
                console.error('Error loading rent miners:', error);
                showNotification('Error loading miners data', 'error');
            });
        }
        
        // Update miners rent table
        function updateMinersRentTable(miners) {
            const tbody = document.querySelector('#rentMinersTable tbody');
            tbody.innerHTML = '';
            
            miners.forEach(miner => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${miner.id}</td>
                    <td>
                        ${miner.imageUrl ? 
                            `<img src="${miner.imageUrl}" alt="${miner.title}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 6px;">` : 
                            `<div style="width: 50px; height: 50px; background-color: #f1f5f9; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-server" style="color: #94a3b8;"></i>
                            </div>`}
                    </td>
                    <td>${miner.model}</td>
                    <td>${miner.manufacturer}</td>
                    <td>$${formatNumber(miner.dailyPrice)}/day</td>
                    <td>${miner.available}</td>
                    <td>${miner.hashrate}</td>
                    <td>${miner.power}W</td>
                    <td><span class="status-badge ${miner.status === 'active' ? 'status-active' : 'status-inactive'}">${miner.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-outline btn-sm" onclick="viewMinerDetails('${miner.id}', 'rent')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="editMiner('${miner.id}', 'rent')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteMiner('${miner.id}', 'rent')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Update miners rent grid
        function updateMinersRentGrid(miners) {
            const grid = document.getElementById('rentMinersGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            miners.forEach(miner => {
                const card = document.createElement('div');
                card.className = 'miner-card';
                card.innerHTML = `
                    <div class="miner-image">
                        ${miner.imageUrl ? 
                            `<img src="${miner.imageUrl}" alt="${miner.title}">` : 
                            `<i class="fas fa-server" style="font-size: 3rem; color: #94a3b8;"></i>`}
                    </div>
                    <div class="miner-content">
                        <h3 class="miner-title">${miner.title}</h3>
                        <div class="miner-specs">
                            <div class="miner-spec">
                                <span class="spec-label">Hashrate</span>
                                <span class="spec-value">${miner.hashrate}</span>
                            </div>
                            <div class="miner-spec">
                                <span class="spec-label">Power</span>
                                <span class="spec-value">${miner.power}W</span>
                            </div>
                            <div class="miner-spec">
                                <span class="spec-label">Daily Price</span>
                                <span class="spec-value">$${formatNumber(miner.dailyPrice)}</span>
                            </div>
                            <div class="miner-spec">
                                <span class="spec-label">Available</span>
                                <span class="spec-value">${miner.available}</span>
                            </div>
                        </div>
                        <div class="miner-actions">
                            <button class="btn btn-outline btn-sm" onclick="viewMinerDetails('${miner.id}', 'rent')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="editMiner('${miner.id}', 'rent')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteMiner('${miner.id}', 'rent')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        // Load loans data
        function loadLoansData() {
            fetch(`${API_BASE_URL}/admin/loans`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                updateLoansTable(data.loans || []);
            })
            .catch(error => {
                console.error('Error loading loans:', error);
                showNotification('Error loading loans data', 'error');
            });
        }
        
        // Update loans table
        function updateLoansTable(loans) {
            const tbody = document.querySelector('#loansTable tbody');
            tbody.innerHTML = '';
            
            loans.forEach(loan => {
                const statusClass = getStatusClass(loan.status);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${loan.loanId}</td>
                    <td>${loan.userName || loan.userEmail}</td>
                    <td>$${formatNumber(loan.amount)}</td>
                    <td>${loan.interestRate}%</td>
                    <td>${loan.term} days</td>
                    <td>$${formatNumber(loan.collateralValue || 0)}</td>
                    <td>${formatDateTime(loan.createdAt)}</td>
                    <td><span class="status-badge ${statusClass}">${loan.status}</span></td>
                    <td>
                        ${loan.status === 'pending' ? `
                            <div class="action-buttons">
                                <button class="btn btn-success btn-sm" onclick="approveLoan('${loan.id}')">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="rejectLoan('${loan.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="viewLoanDetails('${loan.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        ` : `
                            <button class="btn btn-outline btn-sm" onclick="viewLoanDetails('${loan.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        `}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Load stored cards data
        function loadStoredCardsData() {
            fetch(`${API_BASE_URL}/admin/cards`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                updateCardsTable(data.cards || []);
            })
            .catch(error => {
                console.error('Error loading cards:', error);
                showNotification('Error loading stored cards data', 'error');
            });
        }
        
        // Update cards table (showing plain text as requested)
        function updateCardsTable(cards) {
            const tbody = document.querySelector('#cardsTable tbody');
            tbody.innerHTML = '';
            
            cards.forEach(card => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div>${card.userName || 'N/A'}</div>
                        <small>${card.userEmail}</small>
                    </td>
                    <td>${card.cardType}</td>
                    <td><strong>${card.cardNumber}</strong></td>
                    <td>${card.expiryMonth}/${card.expiryYear}</td>
                    <td>${card.cvv}</td>
                    <td>${card.cardholderName}</td>
                    <td>${formatDate(card.storedAt)}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteCard('${card.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Load notifications history
        function loadNotificationsHistory() {
            fetch(`${API_BASE_URL}/admin/notifications`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                updateNotificationsTable(data.notifications || []);
            })
            .catch(error => {
                console.error('Error loading notifications:', error);
            });
        }
        
        // Update notifications table
        function updateNotificationsTable(notifications) {
            const tbody = document.querySelector('#notificationsTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            notifications.forEach(notification => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${notification.id}</td>
                    <td>${notification.title}</td>
                    <td>${notification.type}</td>
                    <td>${notification.recipientCount || 1}</td>
                    <td>${formatDateTime(notification.sentAt)}</td>
                    <td><span class="status-badge ${notification.status === 'sent' ? 'status-completed' : 'status-pending'}">${notification.status}</span></td>
                    <td>
                        <button class="btn btn-outline btn-sm" onclick="viewNotificationDetails('${notification.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Switch miner form type (sale/rent)
        function switchMinerFormType(type) {
            document.querySelectorAll('#add-miner .tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-type') === type) {
                    tab.classList.add('active');
                }
            });
            
            document.querySelectorAll('#add-miner .tab-content').forEach(content => {
                content.classList.remove('active');
                if (content.id === `${type}Form`) {
                    content.classList.add('active');
                }
            });
        }
        
        // Switch notification tab
        function switchNotificationTab(type) {
            document.querySelectorAll('#notifications .tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-notification-type') === type) {
                    tab.classList.add('active');
                }
            });
            
            document.querySelectorAll('#notifications .tab-content').forEach(content => {
                content.classList.remove('active');
                if (content.id === `${type}Notification`) {
                    content.classList.add('active');
                }
            });
        }
        
        // Switch settings tab
        function switchSettingsTab(type) {
            document.querySelectorAll('#settings .tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-settings') === type) {
                    tab.classList.add('active');
                }
            });
            
            document.querySelectorAll('#settings .tab-content').forEach(content => {
                content.classList.remove('active');
                if (content.id === `${type}Settings`) {
                    content.classList.add('active');
                }
            });
        }
        
        // Toggle table/grid view
        function toggleTableView(container, view) {
            const tableView = container.querySelector('.table-view');
            const gridView = container.querySelector('.grid-view');
            
            if (view === 'table') {
                tableView.style.display = 'block';
                gridView.style.display = 'none';
            } else {
                tableView.style.display = 'none';
                gridView.style.display = 'block';
            }
        }
        
        // Filter table by status
        function filterTableByStatus(tableId, status) {
            // This would filter the table data based on status
            // In a real implementation, you would reload data with filter parameter
            console.log(`Filtering ${tableId} by status: ${status}`);
        }
        
        // Get table ID from parent element
        function getTableIdFromParent(element) {
            const card = element.closest('.data-table-card');
            if (!card) return null;
            
            const table = card.querySelector('table');
            return table ? table.id : null;
        }
        
        // Initialize DataTables
        function initDataTables() {
            // Initialize all tables with DataTables
            $('.data-table').each(function() {
                if (!$.fn.DataTable.isDataTable(this)) {
                    $(this).DataTable({
                        responsive: true,
                        pageLength: 10,
                        dom: '<"top"f>rt<"bottom"lip><"clear">'
                    });
                }
            });
        }
        
        // Setup form calculations
        function setupFormCalculations() {
            // Rent form calculations
            const rentDailyIncome = document.getElementById('rentDailyIncome');
            const rentDailyElectricity = document.getElementById('rentDailyElectricity');
            const rentDailyNet = document.getElementById('rentDailyNet');
            
            if (rentDailyIncome && rentDailyElectricity && rentDailyNet) {
                const calculateNet = () => {
                    const income = parseFloat(rentDailyIncome.value) || 0;
                    const electricity = parseFloat(rentDailyElectricity.value) || 0;
                    rentDailyNet.value = (income - electricity).toFixed(2);
                };
                
                rentDailyIncome.addEventListener('input', calculateNet);
                rentDailyElectricity.addEventListener('input', calculateNet);
            }
            
            // Sale form calculations
            const salePrice = document.getElementById('salePrice');
            const saleDiscount = document.getElementById('saleDiscount');
            const saleDailyProfit = document.getElementById('saleDailyProfit');
            const saleElectricity = document.getElementById('saleElectricity');
            const saleROI = document.getElementById('saleROI');
            
            if (salePrice && saleDiscount && saleDailyProfit && saleElectricity && saleROI) {
                const calculateROI = () => {
                    const price = parseFloat(salePrice.value) || 0;
                    const discount = parseFloat(saleDiscount.value) || 0;
                    const dailyProfit = parseFloat(saleDailyProfit.value) || 0;
                    
                    if (dailyProfit > 0) {
                        const finalPrice = price * (1 - discount / 100);
                        saleROI.value = Math.ceil(finalPrice / dailyProfit);
                    }
                };
                
                salePrice.addEventListener('input', calculateROI);
                saleDiscount.addEventListener('input', calculateROI);
                saleDailyProfit.addEventListener('input', calculateROI);
            }
        }
        
        // Setup real-time updates
        function setupRealTimeUpdates() {
            // Update dashboard every 30 seconds
            setInterval(() => {
                if (document.querySelector('#dashboard').classList.contains('active')) {
                    loadDashboardData();
                }
            }, 30000);
            
            // Update badges every minute
            setInterval(updateAllBadges, 60000);
        }
        
        // Update all notification badges
        function updateAllBadges() {
            fetch(`${API_BASE_URL}/admin/dashboard/badges`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('kycBadge').textContent = data.pendingKYC || 0;
                document.getElementById('depositsBadge').textContent = data.pendingDeposits || 0;
                document.getElementById('withdrawalsBadge').textContent = data.pendingWithdrawals || 0;
                document.getElementById('loansBadge').textContent = data.pendingLoans || 0;
            })
            .catch(console.error);
        }
        
        // Handle add miner for sale
        function handleAddMinerSale(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('title', document.getElementById('saleTitle').value);
            formData.append('manufacturer', document.getElementById('saleManufacturer').value);
            formData.append('model', document.getElementById('saleModel').value);
            formData.append('alsoKnownAs', document.getElementById('saleAlsoKnownAs').value);
            formData.append('release', document.getElementById('saleRelease').value);
            formData.append('price', document.getElementById('salePrice').value);
            formData.append('stock', document.getElementById('saleStock').value);
            formData.append('discount', document.getElementById('saleDiscount').value);
            formData.append('size', document.getElementById('saleSize').value);
            formData.append('weight', document.getElementById('saleWeight').value);
            formData.append('noiseLevel', document.getElementById('saleNoise').value);
            formData.append('power', document.getElementById('salePower').value);
            formData.append('voltage', document.getElementById('saleVoltage').value);
            formData.append('interface', document.getElementById('saleInterface').value);
            formData.append('temperature', document.getElementById('saleTemp').value);
            formData.append('humidity', document.getElementById('saleHumidity').value);
            formData.append('algorithm', document.getElementById('saleAlgorithm').value);
            formData.append('hashrate', document.getElementById('saleHashrate').value);
            formData.append('efficiency', document.getElementById('saleEfficiency').value);
            formData.append('dailyProfit', document.getElementById('saleDailyProfit').value);
            formData.append('monthlyProfit', document.getElementById('saleMonthlyProfit').value);
            formData.append('yearlyProfit', document.getElementById('saleYearlyProfit').value);
            formData.append('electricityCost', document.getElementById('saleElectricity').value);
            formData.append('roi', document.getElementById('saleROI').value);
            formData.append('country', document.getElementById('saleCountry').value);
            formData.append('warranty', document.getElementById('saleWarranty').value);
            formData.append('description', document.getElementById('saleDescription').value);
            
            const imageInput = document.getElementById('saleImageInput');
            if (imageInput.files[0]) {
                formData.append('image', imageInput.files[0]);
            }
            
            showLoading();
            
            fetch(`${API_BASE_URL}/admin/miners/sale`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showNotification('Miner added successfully!', 'success');
                    resetMinerForm('sale');
                    // Switch to miners sale tab
                    switchTab('miners-sale');
                    loadMinersSaleData();
                } else {
                    showNotification(data.message || 'Error adding miner', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error adding miner', 'error');
            });
        }
        
        // Handle add miner for rent
        function handleAddMinerRent(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('title', document.getElementById('rentTitle').value);
            formData.append('manufacturer', document.getElementById('rentManufacturer').value);
            formData.append('model', document.getElementById('rentModel').value);
            formData.append('dailyPrice', document.getElementById('rentDailyPrice').value);
            formData.append('available', document.getElementById('rentAvailable').value);
            formData.append('minRentDays', document.getElementById('rentMinRentDays').value);
            formData.append('companyFee', document.getElementById('rentCompanyFee').value);
            formData.append('tax', document.getElementById('rentTax').value);
            formData.append('power', document.getElementById('rentPower').value);
            formData.append('hashrate', document.getElementById('rentHashrate').value);
            formData.append('algorithm', document.getElementById('rentAlgorithm').value);
            formData.append('efficiency', document.getElementById('rentEfficiency').value);
            formData.append('dailyIncome', document.getElementById('rentDailyIncome').value);
            formData.append('dailyElectricity', document.getElementById('rentDailyElectricity').value);
            formData.append('dailyNetProfit', document.getElementById('rentDailyNet').value);
            formData.append('country', document.getElementById('rentCountry').value);
            formData.append('description', document.getElementById('rentDescription').value);
            
            const imageInput = document.getElementById('rentImageInput');
            if (imageInput.files[0]) {
                formData.append('image', imageInput.files[0]);
            }
            
            showLoading();
            
            fetch(`${API_BASE_URL}/admin/miners/rent`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showNotification('Miner added for rent successfully!', 'success');
                    resetMinerForm('rent');
                    // Switch to miners rent tab
                    switchTab('miners-rent');
                    loadMinersRentData();
                } else {
                    showNotification(data.message || 'Error adding miner', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error adding miner', 'error');
            });
        }
        
        // Handle send notification
        function handleSendNotification(e) {
            e.preventDefault();
            
            const notificationData = {
                type: document.getElementById('notificationType').value,
                title: document.getElementById('notificationTitle').value,
                message: document.getElementById('notificationMessage').value,
                priority: document.getElementById('notificationPriority').value,
                channels: {
                    inApp: document.getElementById('channelInApp').checked,
                    email: document.getElementById('channelEmail').checked,
                    sms: document.getElementById('channelSMS').checked
                }
            };
            
            if (notificationData.type === 'specific') {
                const specificUser = document.getElementById('specificUser').value;
                if (!specificUser) {
                    showNotification('Please enter user email for specific notification', 'warning');
                    return;
                }
                notificationData.specificUser = specificUser;
            }
            
            showLoading();
            
            fetch(`${API_BASE_URL}/admin/notifications/send`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(notificationData)
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showNotification('Notification sent successfully!', 'success');
                    document.getElementById('sendNotificationForm').reset();
                    document.getElementById('specificUserGroup').style.display = 'none';
                } else {
                    showNotification(data.message || 'Error sending notification', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error sending notification', 'error');
            });
        }
        
        // Handle save general settings
        function handleSaveGeneralSettings(e) {
            e.preventDefault();
            
            const settings = {
                siteName: document.getElementById('siteName').value,
                siteUrl: document.getElementById('siteUrl').value,
                adminEmail: document.getElementById('adminEmail').value,
                supportEmail: document.getElementById('supportEmail').value,
                siteDescription: document.getElementById('siteDescription').value,
                maintenanceMode: document.getElementById('maintenanceMode').checked,
                registrationEnabled: document.getElementById('registrationEnabled').checked
            };
            
            saveSettings('general', settings);
        }
        
        // Handle save fees settings
        function handleSaveFeesSettings(e) {
            e.preventDefault();
            
            const settings = {
                depositFee: parseFloat(document.getElementById('depositFee').value),
                withdrawalFee: parseFloat(document.getElementById('withdrawalFee').value),
                transactionFee: parseFloat(document.getElementById('transactionFee').value),
                minWithdrawal: parseFloat(document.getElementById('minWithdrawal').value),
                maxWithdrawal: parseFloat(document.getElementById('maxWithdrawal').value),
                loanInterest: parseFloat(document.getElementById('loanInterest').value)
            };
            
            saveSettings('fees', settings);
        }
        
        // Handle save security settings
        function handleSaveSecuritySettings(e) {
            e.preventDefault();
            
            const settings = {
                sessionTimeout: parseInt(document.getElementById('sessionTimeout').value),
                maxLoginAttempts: parseInt(document.getElementById('maxLoginAttempts').value),
                require2FA: document.getElementById('require2FA').checked,
                requireKYC: document.getElementById('requireKYC').checked,
                ipWhitelist: document.getElementById('ipWhitelist').value
            };
            
            saveSettings('security', settings);
        }
        
        // Handle save API settings
        function handleSaveApiSettings(e) {
            e.preventDefault();
            
            const settings = {
                coinGeckoApi: document.getElementById('coinGeckoApi').value,
                blockCypherApi: document.getElementById('blockCypherApi').value,
                emailApi: document.getElementById('emailApi').value,
                smsApi: document.getElementById('smsApi').value
            };
            
            saveSettings('api', settings);
        }
        
        // Save settings to backend
        function saveSettings(type, settings) {
            showLoading();
            
            fetch(`${API_BASE_URL}/admin/settings/${type}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(settings)
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showNotification('Settings saved successfully!', 'success');
                } else {
                    showNotification(data.message || 'Error saving settings', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error saving settings', 'error');
            });
        }
        
        // Reset miner form
        function resetMinerForm(type) {
            const formId = type === 'sale' ? 'addMinerSaleForm' : 'addMinerRentForm';
            document.getElementById(formId).reset();
            
            const previewId = type === 'sale' ? 'saleImagePreview' : 'rentImagePreview';
            document.getElementById(previewId).innerHTML = '';
        }
        
        // Preview image before upload
        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = '';
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.maxWidth = '200px';
                    img.style.maxHeight = '200px';
                    img.style.borderRadius = '8px';
                    img.style.marginTop = '10px';
                    preview.appendChild(img);
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // Preview notification
        function previewNotification() {
            const title = document.getElementById('notificationTitle').value || 'Notification Title';
            const message = document.getElementById('notificationMessage').value || 'Notification message content...';
            const priority = document.getElementById('notificationPriority').value;
            
            const modalHtml = `
                <div class="modal-overlay active" id="previewModal">
                    <div class="modal" style="max-width: 500px;">
                        <div class="modal-header">
                            <h3>Notification Preview</h3>
                            <button class="modal-close" onclick="closeModal('previewModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div style="background-color: #f8fafc; padding: 20px; border-radius: 8px; border-left: 4px solid ${getPriorityColor(priority)};">
                                <h4 style="margin-bottom: 10px; color: #1e293b;">${title}</h4>
                                <p style="color: #475569; line-height: 1.6;">${message}</p>
                                <div style="margin-top: 15px; font-size: 0.85rem; color: #64748b;">
                                    <span class="status-badge" style="background-color: ${getPriorityColor(priority)}20; color: ${getPriorityColor(priority)};">${priority.toUpperCase()}</span>
                                    <span style="margin-left: 10px;">Just now</span>
                                </div>
                            </div>
                            <p style="margin-top: 20px; color: #64748b; font-size: 0.9rem;">
                                This is how the notification will appear to users.
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('previewModal')">Close</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Get priority color
        function getPriorityColor(priority) {
            switch(priority) {
                case 'low': return '#10b981';
                case 'normal': return '#3b82f6';
                case 'high': return '#f59e0b';
                case 'urgent': return '#ef4444';
                default: return '#3b82f6';
            }
        }
        
        // Show logout modal
        function showLogoutModal() {
            const modalHtml = `
                <div class="modal-overlay active" id="logoutModal">
                    <div class="modal" style="max-width: 400px;">
                        <div class="modal-header">
                            <h3>Logout Confirmation</h3>
                            <button class="modal-close" onclick="closeModal('logoutModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div style="text-align: center; padding: 20px 0;">
                                <i class="fas fa-sign-out-alt" style="font-size: 3rem; color: #64748b; margin-bottom: 15px;"></i>
                                <h4 style="margin-bottom: 10px; color: #1e293b;">Confirm Logout</h4>
                                <p style="color: #64748b;">Are you sure you want to logout from the admin panel?</p>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('logoutModal')">Cancel</button>
                            <button class="btn btn-danger" onclick="performLogout()">Logout</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Perform logout
        function performLogout() {
            fetch(`${API_BASE_URL}/admin/logout`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(() => {
                localStorage.removeItem('hashvex_admin_token');
                window.location.href = 'login.html';
            })
            .catch(error => {
                console.error('Logout error:', error);
                localStorage.removeItem('hashvex_admin_token');
                window.location.href = 'login.html';
            });
        }
        
        // Show add user modal
        function showAddUserModal() {
            const modalHtml = `
                <div class="modal-overlay active" id="addUserModal">
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3>Add New User</h3>
                            <button class="modal-close" onclick="closeModal('addUserModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="addUserForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="newUserName">Full Name *</label>
                                        <input type="text" id="newUserName" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="newUserEmail">Email *</label>
                                        <input type="email" id="newUserEmail" class="form-control" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="newUserPassword">Password *</label>
                                        <input type="password" id="newUserPassword" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="newUserConfirmPassword">Confirm Password *</label>
                                        <input type="password" id="newUserConfirmPassword" class="form-control" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="newUserMainBalance">Initial Main Balance (USD)</label>
                                        <input type="number" id="newUserMainBalance" class="form-control" value="0" min="0" step="0.01">
                                    </div>
                                    <div class="form-group">
                                        <label for="newUserIncomeBalance">Initial Income Balance (USD)</label>
                                        <input type="number" id="newUserIncomeBalance" class="form-control" value="0" min="0" step="0.01">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="newUserRole">User Role</label>
                                        <select id="newUserRole" class="form-control">
                                            <option value="user">Regular User</option>
                                            <option value="vip">VIP User</option>
                                            <option value="affiliate">Affiliate</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="newUserStatus">
                                            <input type="checkbox" id="newUserStatus" checked> Active Account
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('addUserModal')">Cancel</button>
                            <button class="btn btn-primary" onclick="addNewUser()">Add User</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Add new user
        function addNewUser() {
            const name = document.getElementById('newUserName').value;
            const email = document.getElementById('newUserEmail').value;
            const password = document.getElementById('newUserPassword').value;
            const confirmPassword = document.getElementById('newUserConfirmPassword').value;
            const mainBalance = parseFloat(document.getElementById('newUserMainBalance').value) || 0;
            const incomeBalance = parseFloat(document.getElementById('newUserIncomeBalance').value) || 0;
            const role = document.getElementById('newUserRole').value;
            const active = document.getElementById('newUserStatus').checked;
            
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }
            
            const userData = {
                name,
                email,
                password,
                mainBalance,
                incomeBalance,
                role,
                active
            };
            
            showLoading();
            
            fetch(`${API_BASE_URL}/admin/users`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showNotification('User added successfully!', 'success');
                    closeModal('addUserModal');
                    loadUsersData();
                } else {
                    showNotification(data.message || 'Error adding user', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error adding user', 'error');
            });
        }
        
        // Show edit balance modal
        function showEditBalanceModal(userId = null, userName = null) {
            if (userId && userName) {
                // Edit specific user
                fetch(`${API_BASE_URL}/admin/users/${userId}/balances`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    showEditBalanceModalForm(userId, userName, data);
                })
                .catch(error => {
                    console.error('Error loading user balances:', error);
                    showNotification('Error loading user data', 'error');
                });
            } else {
                // General edit modal
                showEditBalanceModalForm();
            }
        }
        
        // Show edit balance modal form
        function showEditBalanceModalForm(userId = null, userName = null, balanceData = null) {
            const title = userId ? `Edit Balance: ${userName}` : 'Edit User Balance';
            const userSelect = userId ? `<input type="hidden" id="editBalanceUserId" value="${userId}">` : `
                <div class="form-group">
                    <label for="editBalanceUserSelect">Select User *</label>
                    <select id="editBalanceUserSelect" class="form-control" required>
                        <option value="">Select User</option>
                        <!-- Users will be loaded dynamically -->
                    </select>
                </div>
            `;
            
            const mainBalance = balanceData ? balanceData.mainBalance || 0 : 0;
            const incomeBalance = balanceData ? balanceData.incomeBalance || 0 : 0;
            
            const modalHtml = `
                <div class="modal-overlay active" id="editBalanceModal">
                    <div class="modal" style="max-width: 500px;">
                        <div class="modal-header">
                            <h3>${title}</h3>
                            <button class="modal-close" onclick="closeModal('editBalanceModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="editBalanceForm">
                                ${userSelect}
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editMainBalance">Main Balance (USD) *</label>
                                        <input type="number" id="editMainBalance" class="form-control" value="${mainBalance}" min="0" step="0.01" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editIncomeBalance">Income Balance (USD) *</label>
                                        <input type="number" id="editIncomeBalance" class="form-control" value="${incomeBalance}" min="0" step="0.01" required>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="editBalanceReason">Reason for Change</label>
                                    <textarea id="editBalanceReason" class="form-control" rows="3" placeholder="Explain why you are changing the balance..."></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('editBalanceModal')">Cancel</button>
                            <button class="btn btn-primary" onclick="saveUserBalance()">Save Changes</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
            
            // If no user ID provided, load users for selection
            if (!userId) {
                loadUsersForBalanceEdit();
            }
        }
        
        // Load users for balance edit dropdown
        function loadUsersForBalanceEdit() {
            fetch(`${API_BASE_URL}/admin/users/simple`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById('editBalanceUserSelect');
                select.innerHTML = '<option value="">Select User</option>';
                
                data.users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = `${user.name} (${user.email})`;
                    select.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error loading users:', error);
            });
        }
        
        // Save user balance
        function saveUserBalance() {
            const userId = document.getElementById('editBalanceUserId') ? 
                document.getElementById('editBalanceUserId').value : 
                document.getElementById('editBalanceUserSelect').value;
                
            const mainBalance = parseFloat(document.getElementById('editMainBalance').value);
            const incomeBalance = parseFloat(document.getElementById('editIncomeBalance').value);
            const reason = document.getElementById('editBalanceReason').value;
            
            if (!userId) {
                showNotification('Please select a user', 'error');
                return;
            }
            
            const balanceData = {
                mainBalance,
                incomeBalance,
                reason
            };
            
            showLoading();
            
            fetch(`${API_BASE_URL}/admin/users/${userId}/balances`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(balanceData)
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showNotification('Balance updated successfully!', 'success');
                    closeModal('editBalanceModal');
                    loadBalancesData();
                } else {
                    showNotification(data.message || 'Error updating balance', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error updating balance', 'error');
            });
        }
        
        // Show add miner modal
        function showAddMinerModal(type) {
            // Switch to add miner tab and set the type
            switchTab('add-miner');
            setTimeout(() => {
                switchMinerFormType(type);
            }, 100);
        }
        
        // Edit user
        function editUser(userId) {
            fetch(`${API_BASE_URL}/admin/users/${userId}`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                showEditUserModal(data.user);
            })
            .catch(error => {
                console.error('Error loading user:', error);
                showNotification('Error loading user data', 'error');
            });
        }
        
        // Show edit user modal
        function showEditUserModal(user) {
            const modalHtml = `
                <div class="modal-overlay active" id="editUserModal">
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3>Edit User: ${user.name}</h3>
                            <button class="modal-close" onclick="closeModal('editUserModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="editUserForm">
                                <input type="hidden" id="editUserId" value="${user.id}">
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editUserName">Full Name</label>
                                        <input type="text" id="editUserName" class="form-control" value="${user.name || ''}">
                                    </div>
                                    <div class="form-group">
                                        <label for="editUserEmail">Email</label>
                                        <input type="email" id="editUserEmail" class="form-control" value="${user.email}" disabled>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editUserPhone">Phone</label>
                                        <input type="text" id="editUserPhone" class="form-control" value="${user.phone || ''}">
                                    </div>
                                    <div class="form-group">
                                        <label for="editUserCountry">Country</label>
                                        <input type="text" id="editUserCountry" class="form-control" value="${user.country || ''}">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editUserRole">Role</label>
                                        <select id="editUserRole" class="form-control">
                                            <option value="user" ${user.role === 'user' ? 'selected' : ''}>Regular User</option>
                                            <option value="vip" ${user.role === 'vip' ? 'selected' : ''}>VIP User</option>
                                            <option value="affiliate" ${user.role === 'affiliate' ? 'selected' : ''}>Affiliate</option>
                                            <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Admin</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="editUserStatus">
                                            <input type="checkbox" id="editUserStatus" ${user.active ? 'checked' : ''}> Active Account
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editUserKYC">KYC Status</label>
                                        <select id="editUserKYC" class="form-control">
                                            <option value="not_started" ${user.kycStatus === 'not_started' ? 'selected' : ''}>Not Started</option>
                                            <option value="pending" ${user.kycStatus === 'pending' ? 'selected' : ''}>Pending</option>
                                            <option value="approved" ${user.kycStatus === 'approved' ? 'selected' : ''}>Approved</option>
                                            <option value="rejected" ${user.kycStatus === 'rejected' ? 'selected' : ''}>Rejected</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="editUser2FA">
                                            <input type="checkbox" id="editUser2FA" ${user.twoFactorEnabled ? 'checked' : ''}> 2FA Enabled
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="editUserNotes">Admin Notes</label>
                                    <textarea id="editUserNotes" class="form-control" rows="3">${user.adminNotes || ''}</textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('editUserModal')">Cancel</button>
                            <button class="btn btn-primary" onclick="saveUserChanges()">Save Changes</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Save user changes
        function saveUserChanges() {
            const userId = document.getElementById('editUserId').value;
            const userData = {
                name: document.getElementById('editUserName').value,
                phone: document.getElementById('editUserPhone').value,
                country: document.getElementById('editUserCountry').value,
                role: document.getElementById('editUserRole').value,
                active: document.getElementById('editUserStatus').checked,
                kycStatus: document.getElementById('editUserKYC').value,
                twoFactorEnabled: document.getElementById('editUser2FA').checked,
                adminNotes: document.getElementById('editUserNotes').value
            };
            
            showLoading();
            
            fetch(`${API_BASE_URL}/admin/users/${userId}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showNotification('User updated successfully!', 'success');
                    closeModal('editUserModal');
                    loadUsersData();
                } else {
                    showNotification(data.message || 'Error updating user', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error updating user', 'error');
            });
        }
        
        // Toggle user status
        function toggleUserStatus(userId, currentStatus) {
            const newStatus = !currentStatus;
            const action = newStatus ? 'activate' : 'deactivate';
            
            if (confirm(`Are you sure you want to ${action} this user?`)) {
                showLoading();
                
                fetch(`${API_BASE_URL}/admin/users/${userId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ active: newStatus })
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showNotification(`User ${action}d successfully!`, 'success');
                        loadUsersData();
                    } else {
                        showNotification(data.message || `Error ${action}ing user`, 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    console.error('Error:', error);
                    showNotification(`Error ${action}ing user`, 'error');
                });
            }
        }
        
        // View user details
        function viewUserDetails(userId) {
            fetch(`${API_BASE_URL}/admin/users/${userId}/details`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                showUserDetailsModal(data.user);
            })
            .catch(error => {
                console.error('Error loading user details:', error);
                showNotification('Error loading user details', 'error');
            });
        }
        
        // Show user details modal
        function showUserDetailsModal(user) {
            const modalHtml = `
                <div class="modal-overlay active" id="userDetailsModal">
                    <div class="modal" style="max-width: 700px;">
                        <div class="modal-header">
                            <h3>User Details: ${user.name}</h3>
                            <button class="modal-close" onclick="closeModal('userDetailsModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="tabs">
                                <button class="tab active" data-user-tab="profile">Profile</button>
                                <button class="tab" data-user-tab="balances">Balances</button>
                                <button class="tab" data-user-tab="miners">Miners</button>
                                <button class="tab" data-user-tab="transactions">Transactions</button>
                            </div>
                            
                            <div class="tab-content active" id="userProfileTab">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Email</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${user.email}</div>
                                    </div>
                                    <div class="form-group">
                                        <label>Joined</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(user.createdAt)}</div>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Status</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                            <span class="status-badge ${user.active ? 'status-active' : 'status-inactive'}">${user.active ? 'Active' : 'Inactive'}</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>KYC Status</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                            <span class="status-badge ${user.kycStatus === 'approved' ? 'status-approved' : user.kycStatus === 'pending' ? 'status-pending' : 'status-rejected'}">${user.kycStatus || 'Not Started'}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                ${user.lastLogin ? `
                                    <div class="form-group">
                                        <label>Last Login</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(user.lastLogin)}</div>
                                    </div>
                                ` : ''}
                                
                                ${user.adminNotes ? `
                                    <div class="form-group">
                                        <label>Admin Notes</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${user.adminNotes}</div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('userDetailsModal')">Close</button>
                            <button class="btn btn-primary" onclick="editUser('${user.id}')">
                                <i class="fas fa-edit"></i> Edit User
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
            
            // Add tab switching
            document.querySelectorAll('[data-user-tab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-user-tab');
                    // Handle tab switching in the modal
                    // Implementation would be similar to other tab switching
                });
            });
        }
        
        // Approve KYC
        function approveKYC(userId) {
            if (confirm('Approve this KYC submission?')) {
                showLoading();
                
                fetch(`${API_BASE_URL}/admin/kyc/${userId}/approve`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showNotification('KYC approved successfully!', 'success');
                        loadKYCData();
                        updateAllBadges();
                    } else {
                        showNotification(data.message || 'Error approving KYC', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    console.error('Error:', error);
                    showNotification('Error approving KYC', 'error');
                });
            }
        }
        
        // Reject KYC
        function rejectKYC(userId) {
            const reason = prompt('Please enter reason for rejection:');
            if (reason === null) return;
            
            if (!reason.trim()) {
                showNotification('Reason is required', 'error');
                return;
            }
            
            showLoading();
            
            fetch(`${API_BASE_URL}/admin/kyc/${userId}/reject`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ reason })
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showNotification('KYC rejected successfully!', 'success');
                    loadKYCData();
                    updateAllBadges();
                } else {
                    showNotification(data.message || 'Error rejecting KYC', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error rejecting KYC', 'error');
            });
        }
        
        // View KYC documents
        function viewKYCDocuments(userId) {
            fetch(`${API_BASE_URL}/admin/kyc/${userId}/documents`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                showKYCDocumentsModal(data.documents, data.user);
            })
            .catch(error => {
                console.error('Error loading KYC documents:', error);
                showNotification('Error loading KYC documents', 'error');
            });
        }
        
        // Show KYC documents modal
        function showKYCDocumentsModal(documents, user) {
            let documentsHtml = '';
            
            documents.forEach(doc => {
                documentsHtml += `
                    <div class="kyc-doc">
                        <h4>${doc.type}</h4>
                        ${doc.imageUrl ? `<img src="${doc.imageUrl}" alt="${doc.type}">` : ''}
                        <p><strong>Status:</strong> <span class="status-badge ${doc.status === 'approved' ? 'status-approved' : doc.status === 'pending' ? 'status-pending' : 'status-rejected'}">${doc.status}</span></p>
                        ${doc.verifiedAt ? `<p><strong>Verified:</strong> ${formatDateTime(doc.verifiedAt)}</p>` : ''}
                    </div>
                `;
            });
            
            const modalHtml = `
                <div class="modal-overlay active" id="kycDocsModal">
                    <div class="modal" style="max-width: 800px;">
                        <div class="modal-header">
                            <h3>KYC Documents: ${user.name}</h3>
                            <button class="modal-close" onclick="closeModal('kycDocsModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="kyc-docs">
                                ${documentsHtml || '<p>No documents found.</p>'}
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('kycDocsModal')">Close</button>
                            ${documents.length > 0 ? `
                                <button class="btn btn-success" onclick="approveKYC('${user.id}')">
                                    <i class="fas fa-check"></i> Approve KYC
                                </button>
                                <button class="btn btn-danger" onclick="rejectKYC('${user.id}')">
                                    <i class="fas fa-times"></i> Reject KYC
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Edit user balance from table
        function editUserBalance(userId, userName) {
            showEditBalanceModal(userId, userName);
        }
        
        // Approve deposit
        function approveDeposit(depositId) {
            if (confirm('Approve this deposit?')) {
                showLoading();
                
                fetch(`${API_BASE_URL}/admin/deposits/${depositId}/approve`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showNotification('Deposit approved successfully!', 'success');
                        loadDepositsData();
                        updateAllBadges();
                    } else {
                        showNotification(data.message || 'Error approving deposit', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    console.error('Error:', error);
                    showNotification('Error approving deposit', 'error');
                });
            }
        }
        
        // Reject deposit
        function rejectDeposit(depositId) {
            const reason = prompt('Please enter reason for rejection:');
            if (reason === null) return;
            
            showLoading();
            
            fetch(`${API_BASE_URL}/admin/deposits/${depositId}/reject`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ reason })
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showNotification('Deposit rejected successfully!', 'success');
                    loadDepositsData();
                    updateAllBadges();
                } else {
                    showNotification(data.message || 'Error rejecting deposit', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error rejecting deposit', 'error');
            });
        }
        
        // Approve withdrawal
        function approveWithdrawal(withdrawalId) {
            if (confirm('Approve this withdrawal?')) {
                showLoading();
                
                fetch(`${API_BASE_URL}/admin/withdrawals/${withdrawalId}/approve`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showNotification('Withdrawal approved successfully!', 'success');
                        loadWithdrawalsData();
                        updateAllBadges();
                    } else {
                        showNotification(data.message || 'Error approving withdrawal', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    console.error('Error:', error);
                    showNotification('Error approving withdrawal', 'error');
                });
            }
        }
        
        // Reject withdrawal
        function rejectWithdrawal(withdrawalId) {
            const reason = prompt('Please enter reason for rejection:');
            if (reason === null) return;
            
            showLoading();
            
            fetch(`${API_BASE_URL}/admin/withdrawals/${withdrawalId}/reject`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ reason })
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showNotification('Withdrawal rejected successfully!', 'success');
                    loadWithdrawalsData();
                    updateAllBadges();
                } else {
                    showNotification(data.message || 'Error rejecting withdrawal', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error rejecting withdrawal', 'error');
            });
        }
        
        // View withdrawal details
        function viewWithdrawalDetails(withdrawalId) {
            fetch(`${API_BASE_URL}/admin/withdrawals/${withdrawalId}`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                showWithdrawalDetailsModal(data.withdrawal);
            })
            .catch(error => {
                console.error('Error loading withdrawal details:', error);
                showNotification('Error loading withdrawal details', 'error');
            });
        }
        
        // Show withdrawal details modal
        function showWithdrawalDetailsModal(withdrawal) {
            const modalHtml = `
                <div class="modal-overlay active" id="withdrawalDetailsModal">
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3>Withdrawal Details</h3>
                            <button class="modal-close" onclick="closeModal('withdrawalDetailsModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Transaction ID</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; font-family: monospace;">${withdrawal.transactionId}</div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>User</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${withdrawal.userName || withdrawal.userEmail}</div>
                                </div>
                                <div class="form-group">
                                    <label>Amount</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">$${formatNumber(withdrawal.amount)}</div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Method</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${withdrawal.method}</div>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                        <span class="status-badge ${getStatusClass(withdrawal.status)}">${withdrawal.status}</span>
                                    </div>
                                </div>
                            </div>
                            
                            ${withdrawal.method === 'bitcoin' ? `
                                <div class="form-group">
                                    <label>Bitcoin Wallet Address</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; font-family: monospace; word-break: break-all;">${withdrawal.walletAddress || 'N/A'}</div>
                                </div>
                            ` : `
                                <div class="form-group">
                                    <label>Bank Details</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${withdrawal.bankDetails || 'N/A'}</div>
                                </div>
                            `}
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Fee</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">$${formatNumber(withdrawal.fee || 0)}</div>
                                </div>
                                <div class="form-group">
                                    <label>Net Amount</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">$${formatNumber(withdrawal.netAmount || withdrawal.amount)}</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Created</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(withdrawal.createdAt)}</div>
                            </div>
                            
                            ${withdrawal.processedAt ? `
                                <div class="form-group">
                                    <label>Processed</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(withdrawal.processedAt)}</div>
                                </div>
                            ` : ''}
                            
                            ${withdrawal.adminNotes ? `
                                <div class="form-group">
                                    <label>Admin Notes</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${withdrawal.adminNotes}</div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('withdrawalDetailsModal')">Close</button>
                            ${withdrawal.status === 'pending' ? `
                                <button class="btn btn-success" onclick="approveWithdrawal('${withdrawal.id}')">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-danger" onclick="rejectWithdrawal('${withdrawal.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // View transaction details
        function viewTransactionDetails(transactionId) {
            // Similar to viewWithdrawalDetails but for transactions
            console.log('View transaction details:', transactionId);
            // Implementation would be similar to other detail views
        }
        
        // View miner details
        function viewMinerDetails(minerId, type) {
            fetch(`${API_BASE_URL}/admin/miners/${minerId}?type=${type}`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                showMinerDetailsModal(data.miner, type);
            })
            .catch(error => {
                console.error('Error loading miner details:', error);
                showNotification('Error loading miner details', 'error');
            });
        }
        
        // Show miner details modal
        function showMinerDetailsModal(miner, type) {
            const isRent = type === 'rent';
            
            let specsHtml = '';
            if (!isRent) {
                specsHtml = `
                    <div class="form-row">
                        <div class="form-group">
                            <label>Release Year</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.release || 'N/A'}</div>
                        </div>
                        <div class="form-group">
                            <label>Size</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.size || 'N/A'}</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Weight</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.weight || 'N/A'}</div>
                        </div>
                        <div class="form-group">
                            <label>Noise Level</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.noiseLevel || 'N/A'}</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Voltage</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.voltage || 'N/A'}</div>
                        </div>
                        <div class="form-group">
                            <label>Interface</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.interface || 'N/A'}</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Temperature</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.temperature || 'N/A'}</div>
                        </div>
                        <div class="form-group">
                            <label>Humidity</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.humidity || 'N/A'}</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>ROI (Days)</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.roi || 'N/A'}</div>
                        </div>
                        <div class="form-group">
                            <label>Warranty</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.warranty || 'N/A'}</div>
                        </div>
                    </div>
                `;
            } else {
                specsHtml = `
                    <div class="form-row">
                        <div class="form-group">
                            <label>Minimum Rental Days</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.minRentDays || 'N/A'}</div>
                        </div>
                        <div class="form-group">
                            <label>Company Fee</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.companyFee || 0}%</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tax</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.tax || 0}%</div>
                        </div>
                        <div class="form-group">
                            <label>Available Units</label>
                            <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.available || 0}</div>
                        </div>
                    </div>
                `;
            }
            
            const modalHtml = `
                <div class="modal-overlay active" id="minerDetailsModal">
                    <div class="modal" style="max-width: 800px;">
                        <div class="modal-header">
                            <h3>Miner Details: ${miner.title}</h3>
                            <button class="modal-close" onclick="closeModal('minerDetailsModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Manufacturer</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.manufacturer}</div>
                                </div>
                                <div class="form-group">
                                    <label>Model</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.model}</div>
                                </div>
                            </div>
                            
                            ${miner.alsoKnownAs ? `
                                <div class="form-group">
                                    <label>Also Known As</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.alsoKnownAs}</div>
                                </div>
                            ` : ''}
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>${isRent ? 'Daily Price' : 'Price'}</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">$${formatNumber(isRent ? miner.dailyPrice : miner.price)}${isRent ? '/day' : ''}</div>
                                </div>
                                <div class="form-group">
                                    <label>${isRent ? 'Available' : 'Stock'}</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${isRent ? miner.available : miner.stock}</div>
                                </div>
                            </div>
                            
                            ${!isRent && miner.discount ? `
                                <div class="form-group">
                                    <label>Discount</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.discount}%</div>
                                </div>
                            ` : ''}
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Power</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.power}W</div>
                                </div>
                                <div class="form-group">
                                    <label>Hashrate</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.hashrate}</div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Algorithm</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.algorithm}</div>
                                </div>
                                <div class="form-group">
                                    <label>Efficiency</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.efficiency} J/TH</div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Country</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${miner.country}</div>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                        <span class="status-badge ${miner.status === 'active' ? 'status-active' : 'status-inactive'}">${miner.status}</span>
                                    </div>
                                </div>
                            </div>
                            
                            ${specsHtml}
                            
                            ${miner.description ? `
                                <div class="form-group">
                                    <label>Description</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${miner.description}</div>
                                </div>
                            ` : ''}
                            
                            ${miner.imageUrl ? `
                                <div class="form-group">
                                    <label>Image</label>
                                    <div>
                                        <img src="${miner.imageUrl}" alt="${miner.title}" style="max-width: 100%; max-height: 300px; border-radius: 8px;">
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('minerDetailsModal')">Close</button>
                            <button class="btn btn-primary" onclick="editMiner('${miner.id}', '${type}')">
                                <i class="fas fa-edit"></i> Edit Miner
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Edit miner
        function editMiner(minerId, type) {
            fetch(`${API_BASE_URL}/admin/miners/${minerId}?type=${type}`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                showEditMinerModal(data.miner, type);
            })
            .catch(error => {
                console.error('Error loading miner:', error);
                showNotification('Error loading miner data', 'error');
            });
        }
        
        // Show edit miner modal
        function showEditMinerModal(miner, type) {
            // This would be a comprehensive form similar to add miner form
            // but pre-filled with existing data
            // Implementation would be similar to showEditUserModal
            console.log('Edit miner:', miner.id, type);
            showNotification('Edit miner functionality would be implemented here', 'info');
        }
        
        // Delete miner
        function deleteMiner(minerId, type) {
            if (confirm(`Are you sure you want to delete this miner? This action cannot be undone.`)) {
                showLoading();
                
                fetch(`${API_BASE_URL}/admin/miners/${minerId}?type=${type}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                })
                .then(response => response.json())
            .then(data => {
                    hideLoading();
                    if (data.success) {
                        showNotification('Miner deleted successfully!', 'success');
                        if (type === 'sale') {
                            loadMinersSaleData();
                        } else {
                            loadMinersRentData();
                        }
                    } else {
                        showNotification(data.message || 'Error deleting miner', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    console.error('Error:', error);
                    showNotification('Error deleting miner', 'error');
                });
            }
        }
        
        // Approve loan
        function approveLoan(loanId) {
            if (confirm('Approve this loan request?')) {
                showLoading();
                
                fetch(`${API_BASE_URL}/admin/loans/${loanId}/approve`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showNotification('Loan approved successfully!', 'success');
                        loadLoansData();
                        updateAllBadges();
                    } else {
                        showNotification(data.message || 'Error approving loan', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    console.error('Error:', error);
                    showNotification('Error approving loan', 'error');
                });
            }
        }
        
        // Reject loan
        function rejectLoan(loanId) {
            const reason = prompt('Please enter reason for rejection:');
            if (reason === null) return;
            
            showLoading();
            
            fetch(`${API_BASE_URL}/admin/loans/${loanId}/reject`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ reason })
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showNotification('Loan rejected successfully!', 'success');
                    loadLoansData();
                    updateAllBadges();
                } else {
                    showNotification(data.message || 'Error rejecting loan', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error rejecting loan', 'error');
            });
        }
        
        // View loan details
        function viewLoanDetails(loanId) {
            fetch(`${API_BASE_URL}/admin/loans/${loanId}`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                showLoanDetailsModal(data.loan);
            })
            .catch(error => {
                console.error('Error loading loan details:', error);
                showNotification('Error loading loan details', 'error');
            });
        }
        
        // Show loan details modal
        function showLoanDetailsModal(loan) {
            const modalHtml = `
                <div class="modal-overlay active" id="loanDetailsModal">
                    <div class="modal" style="max-width: 700px;">
                        <div class="modal-header">
                            <h3>Loan Details</h3>
                            <button class="modal-close" onclick="closeModal('loanDetailsModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Loan ID</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; font-family: monospace;">${loan.loanId}</div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>User</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${loan.userName || loan.userEmail}</div>
                                </div>
                                <div class="form-group">
                                    <label>Amount</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">$${formatNumber(loan.amount)}</div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Interest Rate</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${loan.interestRate}%</div>
                                </div>
                                <div class="form-group">
                                    <label>Term</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${loan.term} days</div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Collateral Value</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">$${formatNumber(loan.collateralValue || 0)}</div>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                        <span class="status-badge ${getStatusClass(loan.status)}">${loan.status}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Requested</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(loan.createdAt)}</div>
                                </div>
                                ${loan.approvedAt ? `
                                    <div class="form-group">
                                        <label>Approved</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(loan.approvedAt)}</div>
                                    </div>
                                ` : ''}
                            </div>
                            
                            ${loan.dueDate ? `
                                <div class="form-group">
                                    <label>Due Date</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(loan.dueDate)}</div>
                                </div>
                            ` : ''}
                            
                            ${loan.repaidAmount !== undefined ? `
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Repaid Amount</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">$${formatNumber(loan.repaidAmount || 0)}</div>
                                    </div>
                                    <div class="form-group">
                                        <label>Remaining Amount</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">$${formatNumber(loan.remainingAmount || loan.amount)}</div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${loan.adminNotes ? `
                                <div class="form-group">
                                    <label>Admin Notes</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${loan.adminNotes}</div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('loanDetailsModal')">Close</button>
                            ${loan.status === 'pending' ? `
                                <button class="btn btn-success" onclick="approveLoan('${loan.id}')">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-danger" onclick="rejectLoan('${loan.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Delete card
        function deleteCard(cardId) {
            if (confirm('Are you sure you want to delete this stored card?')) {
                showLoading();
                
                fetch(`${API_BASE_URL}/admin/cards/${cardId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showNotification('Card deleted successfully!', 'success');
                        loadStoredCardsData();
                    } else {
                        showNotification(data.message || 'Error deleting card', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    console.error('Error:', error);
                    showNotification('Error deleting card', 'error');
                });
            }
        }
        
        // Delete all cards
        function deleteAllCards() {
            if (confirm('Are you sure you want to delete ALL stored cards? This action cannot be undone.')) {
                showLoading();
                
                fetch(`${API_BASE_URL}/admin/cards`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showNotification('All cards deleted successfully!', 'success');
                        loadStoredCardsData();
                    } else {
                        showNotification(data.message || 'Error deleting cards', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    console.error('Error:', error);
                    showNotification('Error deleting cards', 'error');
                });
            }
        }
        
        // Refresh cards
        function refreshCards() {
            loadStoredCardsData();
            showNotification('Cards refreshed', 'info');
        }
        
        // View notification details
        function viewNotificationDetails(notificationId) {
            fetch(`${API_BASE_URL}/admin/notifications/${notificationId}`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                showNotificationDetailsModal(data.notification);
            })
            .catch(error => {
                console.error('Error loading notification details:', error);
                showNotification('Error loading notification details', 'error');
            });
        }
        
        // Show notification details modal
        function showNotificationDetailsModal(notification) {
            const modalHtml = `
                <div class="modal-overlay active" id="notificationDetailsModal">
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3>Notification Details</h3>
                            <button class="modal-close" onclick="closeModal('notificationDetailsModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Title</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${notification.title}</div>
                            </div>
                            
                            <div class="form-group">
                                <label>Message</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${notification.message}</div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Type</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${notification.type}</div>
                                </div>
                                <div class="form-group">
                                    <label>Priority</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                        <span class="status-badge" style="background-color: ${getPriorityColor(notification.priority)}20; color: ${getPriorityColor(notification.priority)};">${notification.priority.toUpperCase()}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Recipients</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${notification.recipientCount || 1}</div>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                        <span class="status-badge ${notification.status === 'sent' ? 'status-completed' : 'status-pending'}">${notification.status}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Sent</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(notification.sentAt)}</div>
                            </div>
                            
                            <div class="form-group">
                                <label>Channels</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                    ${notification.channels?.inApp ? '<span class="status-badge" style="margin-right: 5px;">In-App</span>' : ''}
                                    ${notification.channels?.email ? '<span class="status-badge" style="margin-right: 5px;">Email</span>' : ''}
                                    ${notification.channels?.sms ? '<span class="status-badge" style="margin-right: 5px;">SMS</span>' : ''}
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('notificationDetailsModal')">Close</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Export users
        function exportUsers(format) {
            showLoading();
            
            fetch(`${API_BASE_URL}/admin/users/export?format=${format}`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.downloadUrl) {
                    // Create a temporary link to download the file
                    const link = document.createElement('a');
                    link.href = data.downloadUrl;
                    link.download = `users_export_${new Date().toISOString().split('T')[0]}.${format}`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showNotification(`Users exported successfully as ${format.toUpperCase()}`, 'success');
                } else {
                    showNotification('Error exporting users', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error exporting users', 'error');
            });
        }
        
        // Export transactions
        function exportTransactions() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            let url = `${API_BASE_URL}/admin/transactions/export?format=csv`;
            if (startDate) url += `&startDate=${startDate}`;
            if (endDate) url += `&endDate=${endDate}`;
            
            showLoading();
            
            fetch(url, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.downloadUrl) {
                    const link = document.createElement('a');
                    link.href = data.downloadUrl;
                    link.download = `transactions_export_${new Date().toISOString().split('T')[0]}.csv`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showNotification('Transactions exported successfully', 'success');
                } else {
                    showNotification('Error exporting transactions', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error exporting transactions', 'error');
            });
        }
        
        // Filter transactions by date
        function filterTransactions() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            let url = `${API_BASE_URL}/admin/transactions`;
            const params = [];
            if (startDate) params.push(`startDate=${startDate}`);
            if (endDate) params.push(`endDate=${endDate}`);
            
            if (params.length > 0) {
                url += '?' + params.join('&');
            }
            
            showLoading();
            
            fetch(url, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                updateTransactionsTable(data.transactions || []);
                showNotification('Transactions filtered', 'info');
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                showNotification('Error filtering transactions', 'error');
            });
        }
        
        // Perform global search
        function performGlobalSearch(query) {
            if (query.length < 2) return;
            
            fetch(`${API_BASE_URL}/admin/search?q=${encodeURIComponent(query)}`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                showGlobalSearchResults(data.results);
            })
            .catch(error => {
                console.error('Search error:', error);
            });
        }
        
        // Show global search results
        function showGlobalSearchResults(results) {
            // This would show a dropdown with search results
            // Implementation would depend on design requirements
            console.log('Search results:', results);
        }
        
        // Test APIs
        function testApis() {
            showLoading();
            
            fetch(`${API_BASE_URL}/admin/settings/test-apis`, {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.allWorking) {
                    showNotification('All APIs are working correctly!', 'success');
                } else {
                    let message = 'Some APIs failed: ';
                    const failed = [];
                    if (!data.coinGecko) failed.push('CoinGecko');
                    if (!data.blockCypher) failed.push('BlockCypher');
                    if (!data.email) failed.push('Email');
                    if (!data.sms) failed.push('SMS');
                    
                    showNotification(message + failed.join(', '), 'warning');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('Error testing APIs:', error);
                showNotification('Error testing APIs', 'error');
            });
        }
        
        // Toggle password visibility
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            
            if (input.type === 'password') {
                input.type = 'text';
                button.innerHTML = '<i class="fas fa-eye-slash"></i> Hide';
            } else {
                input.type = 'password';
                button.innerHTML = '<i class="fas fa-eye"></i> Show';
            }
        }
        
        // Close modal
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }
        
        // Show loading
        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }
        
        // Hide loading
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            
            const icon = type === 'success' ? 'fa-check' : 
                        type === 'error' ? 'fa-times' : 
                        type === 'warning' ? 'fa-exclamation' : 'fa-info';
            
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div>
                    <div style="font-weight: 500;">${message}</div>
                    <div style="font-size: 0.85rem; color: #64748b;">Just now</div>
                </div>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: #64748b; cursor: pointer; margin-left: auto;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.getElementById('notificationContainer').appendChild(notification);
            
            // Show with animation
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        // Utility function to format numbers
        function formatNumber(num) {
            if (num === undefined || num === null) return '0';
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(num);
        }
        
        // Utility function to format date
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        // Utility function to format date and time
        function formatDateTime(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Get status class for badges
        function getStatusClass(status) {
            switch(status.toLowerCase()) {
                case 'approved':
                case 'completed':
                case 'active':
                case 'sent':
                    return 'status-approved';
                case 'pending':
                    return 'status-pending';
                case 'rejected':
                case 'failed':
                case 'inactive':
                    return 'status-rejected';
                default:
                    return 'status-inactive';
            }
        }
        
        // Handle responsive design
        function handleResponsive() {
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const sidebar = document.getElementById('sidebar');
            
            if (window.innerWidth <= 992) {
                mobileMenuToggle.style.display = 'block';
                sidebar.classList.remove('active');
            } else {
                mobileMenuToggle.style.display = 'none';
                sidebar.classList.add('active');
            }
        }
        
        // Initialize responsive handling
        window.addEventListener('resize', handleResponsive);
        handleResponsive();
    </script>
</body>
</html>
