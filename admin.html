<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Hashvex Technologies</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.dataTables.min.css">
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --dark-color: #1e293b;
            --light-color: #f8fafc;
            --sidebar-width: 280px;
            --header-height: 70px;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            color: #334155;
            overflow-x: hidden;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Login Modal */
        .login-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .login-modal {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 450px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(-20px);
            animation: slideIn 0.5s ease forwards;
        }

        @keyframes slideIn {
            to { transform: translateY(0); }
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h2 {
            font-size: 1.8rem;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .login-header p {
            color: var(--secondary-color);
            font-size: 0.9rem;
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .login-form input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .login-form input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .login-btn:hover {
            background-color: var(--primary-dark);
        }

        .login-error {
            background-color: #fee2e2;
            color: #991b1b;
            padding: 12px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: none;
        }

        /* Layout */
        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: white;
            box-shadow: var(--shadow);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: var(--transition);
            z-index: 1000;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h2 {
            font-size: 1.5rem;
            color: var(--dark-color);
            font-weight: 700;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--secondary-color);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .menu-item:hover, .menu-item.active {
            background-color: #f1f5f9;
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .menu-item i {
            width: 24px;
            margin-right: 12px;
            font-size: 1.1rem;
        }

        .menu-item span {
            font-weight: 500;
        }

        .menu-section {
            padding: 20px 20px 10px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #94a3b8;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
        }

        /* Top Header */
        .top-header {
            height: var(--header-height);
            background-color: white;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 10px 15px 10px 40px;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            width: 300px;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .admin-profile:hover {
            background-color: #f1f5f9;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Content Area */
        .content-wrapper {
            padding: 30px;
        }

        /* Dashboard Stats */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .stat-info h3 {
            font-size: 0.9rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-info .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark-color);
        }

        .stat-info .stat-change {
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .stat-change.positive {
            color: var(--success-color);
        }

        .stat-change.negative {
            color: var(--danger-color);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .stat-icon.blue { background-color: #dbeafe; color: var(--primary-color); }
        .stat-icon.green { background-color: #d1fae5; color: var(--success-color); }
        .stat-icon.purple { background-color: #e9d5ff; color: #8b5cf6; }
        .stat-icon.orange { background-color: #fed7aa; color: #f97316; }
        .stat-icon.red { background-color: #fecaca; color: var(--danger-color); }
        .stat-icon.yellow { background-color: #fef3c7; color: var(--warning-color); }

        /* Charts */
        .charts-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Data Tables */
        .data-table-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid #e2e8f0;
            color: var(--secondary-color);
        }

        .btn-outline:hover {
            background-color: #f8fafc;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        /* Status Badges */
        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-approved { background-color: #d1fae5; color: #065f46; }
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-rejected { background-color: #fee2e2; color: #991b1b; }
        .status-active { background-color: #dbeafe; color: #1e40af; }
        .status-inactive { background-color: #f1f5f9; color: #475569; }
        .status-completed { background-color: #d1fae5; color: #065f46; }
        .status-failed { background-color: #fee2e2; color: #991b1b; }
        .status-negative { background-color: #fee2e2; color: #991b1b; }
        .status-penalized { background-color: #fef3c7; color: #92400e; }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: #64748b;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .form-help {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 5px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            background-color: white;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 3000;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .notification-success {
            border-left: 4px solid var(--success-color);
        }

        .notification-success .notification-icon {
            background-color: #d1fae5;
            color: var(--success-color);
        }

        .notification-error {
            border-left: 4px solid var(--danger-color);
        }

        .notification-error .notification-icon {
            background-color: #fee2e2;
            color: var(--danger-color);
        }

        .notification-warning {
            border-left: 4px solid var(--warning-color);
        }

        .notification-warning .notification-icon {
            background-color: #fef3c7;
            color: var(--warning-color);
        }

        .notification-info {
            border-left: 4px solid var(--info-color);
        }

        .notification-info .notification-icon {
            background-color: #dbeafe;
            color: var(--info-color);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            color: var(--secondary-color);
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
        }

        .tab:hover {
            color: var(--primary-color);
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Penalty Section Specific */
        .penalty-form-container {
            background-color: #f8fafc;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
        }

        .penalty-history {
            margin-top: 30px;
        }

        .negative-balance {
            color: #ef4444;
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .charts-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .search-box input {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            .content-wrapper {
                padding: 20px;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            .search-box input {
                width: 150px;
            }
            
            .header-right {
                gap: 10px;
            }
        }

        @media (max-width: 576px) {
            .top-header {
                padding: 0 15px;
            }
            
            .search-box {
                display: none;
            }
            
            .modal {
                width: 95%;
            }
        }

        /* Action buttons in tables */
        .action-buttons {
            display: flex;
            gap: 5px;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
        }

        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius);
            border: 1px solid #e2e8f0;
            background: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .page-btn:hover {
            background-color: #f1f5f9;
        }

        .page-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Export buttons */
        .export-buttons {
            display: flex;
            gap: 10px;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
        }

        .empty-state i {
            font-size: 3rem;
            color: #cbd5e1;
            margin-bottom: 15px;
        }

        .empty-state h4 {
            font-size: 1.2rem;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .empty-state p {
            color: var(--secondary-color);
            max-width: 400px;
            margin: 0 auto 20px;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="login-modal-overlay" id="loginModal">
        <div class="login-modal">
            <div class="login-header">
                <div class="logo" style="justify-content: center; margin-bottom: 15px;">
                    <i class="fas fa-shield-alt" style="color: #2563eb; font-size: 2rem;"></i>
                    <h2 style="font-size: 1.8rem;">Hashvex Admin</h2>
                </div>
                <h2>Admin Login</h2>
                <p>Enter your credentials to access the dashboard</p>
            </div>
            
            <div class="login-error" id="loginError">
                <i class="fas fa-exclamation-circle"></i> Invalid credentials
            </div>
            
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="adminEmail">Email Address</label>
                    <input type="email" id="adminEmail" required placeholder="admin@hashvex.com">
                </div>
                
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" required placeholder="••••••••">
                </div>
                
                <button type="submit" class="login-btn" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="loader"></div>
        <p style="color: white; font-size: 1.1rem;">Loading Admin Dashboard...</p>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Modals Container -->
    <div id="modalsContainer"></div>

    <!-- Main Admin Container (Hidden until login) -->
    <div class="admin-container" id="adminContainer" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-shield-alt" style="color: #2563eb; font-size: 1.8rem;"></i>
                    <h2>Hashvex Admin</h2>
                </div>
                <button class="menu-toggle" id="menuToggle" style="background: none; border: none; font-size: 1.2rem; color: #64748b; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-section">Dashboard</div>
                <a href="#dashboard" class="menu-item active" data-tab="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                
                <div class="menu-section">User Management</div>
                <a href="#users" class="menu-item" data-tab="users">
                    <i class="fas fa-users"></i>
                    <span>All Users</span>
                </a>
                <a href="#penalties" class="menu-item" data-tab="penalties">
                    <i class="fas fa-gavel"></i>
                    <span>Penalties</span>
                </a>
                <a href="#kyc" class="menu-item" data-tab="kyc">
                    <i class="fas fa-id-card"></i>
                    <span>KYC Verification</span>
                    <span class="badge" id="kycBadge" style="margin-left: auto; background-color: #ef4444; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;">0</span>
                </a>
                <a href="#balances" class="menu-item" data-tab="balances">
                    <i class="fas fa-wallet"></i>
                    <span>User Balances</span>
                </a>
                
                <div class="menu-section">Transaction Management</div>
                <a href="#deposits" class="menu-item" data-tab="deposits">
                    <i class="fas fa-arrow-down"></i>
                    <span>Deposits</span>
                    <span class="badge" id="depositsBadge" style="margin-left: auto; background-color: #ef4444; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;">0</span>
                </a>
                <a href="#withdrawals" class="menu-item" data-tab="withdrawals">
                    <i class="fas fa-arrow-up"></i>
                    <span>Withdrawals</span>
                    <span class="badge" id="withdrawalsBadge" style="margin-left: auto; background-color: #ef4444; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;">0</span>
                </a>
                <a href="#transactions" class="menu-item" data-tab="transactions">
                    <i class="fas fa-exchange-alt"></i>
                    <span>All Transactions</span>
                </a>
                
                <div class="menu-section">Activity Tracking</div>
                <a href="#activity-log" class="menu-item" data-tab="activity-log">
                    <i class="fas fa-history"></i>
                    <span>Activity Log</span>
                </a>
                <a href="#login-history" class="menu-item" data-tab="login-history">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Login History</span>
                </a>
                
                <div class="menu-section">System</div>
                <a href="#notifications" class="menu-item" data-tab="notifications">
                    <i class="fas fa-bell"></i>
                    <span>Send Notifications</span>
                </a>
                <a href="#settings" class="menu-item" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    <span>Admin Settings</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Top Header -->
            <header class="top-header">
                <div class="header-left">
                    <button class="menu-toggle" id="mobileMenuToggle" style="background: none; border: none; font-size: 1.2rem; color: #64748b; cursor: pointer; margin-right: 15px; display: none;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="pageTitle">Admin Dashboard</h1>
                </div>
                
                <div class="header-right">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="globalSearch" placeholder="Search users, transactions...">
                    </div>
                    
                    <div class="admin-profile" id="adminProfile">
                        <div class="admin-avatar" id="adminAvatar">A</div>
                        <div class="admin-info">
                            <div style="font-weight: 600; font-size: 0.9rem;" id="adminName">Admin User</div>
                            <div style="font-size: 0.8rem; color: #64748b;">Super Admin</div>
                        </div>
                        <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
                    </div>
                </div>
            </header>

            <!-- Content Wrapper -->
            <div class="content-wrapper">
                <!-- Dashboard Tab -->
                <div class="tab-content active" id="dashboard">
                    <!-- Stats Row -->
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>Total Revenue</h3>
                                <div class="stat-value" id="totalRevenue">$0</div>
                                <div class="stat-change positive" id="revenueChange">+0% from last month</div>
                            </div>
                            <div class="stat-icon blue">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>Total Users</h3>
                                <div class="stat-value" id="totalUsers">0</div>
                                <div class="stat-change positive" id="usersChange">+0 today</div>
                            </div>
                            <div class="stat-icon green">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>Pending Actions</h3>
                                <div class="stat-value" id="pendingActions">0</div>
                                <div class="stat-change warning" id="actionsChange">Requires attention</div>
                            </div>
                            <div class="stat-icon orange">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>Penalties Issued</h3>
                                <div class="stat-value" id="totalPenalties">0</div>
                                <div class="stat-change" id="penaltiesChange">This month</div>
                            </div>
                            <div class="stat-icon red">
                                <i class="fas fa-gavel"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="charts-row">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>User Activity (Last 7 Days)</h3>
                                <select id="activityPeriod" class="form-control" style="width: auto; padding: 8px 15px;">
                                    <option value="7days">Last 7 Days</option>
                                    <option value="30days">Last 30 Days</option>
                                    <option value="90days">Last 90 Days</option>
                                </select>
                            </div>
                            <div class="chart-container">
                                <canvas id="activityChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Penalty Distribution</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="penaltyChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>Recent User Activity</h3>
                            <button class="btn btn-outline" onclick="loadActivity('recent')">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="activityTable">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>User</th>
                                        <th>Action</th>
                                        <th>Details</th>
                                        <th>IP Address</th>
                                        <th>Device</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Activity data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Users Tab -->
                <div class="tab-content" id="users">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>All Users</h3>
                            <div class="table-actions">
                                <button class="btn btn-outline" onclick="exportUsers('csv')">
                                    <i class="fas fa-file-csv"></i> CSV
                                </button>
                                <button class="btn btn-primary" onclick="showAddUserModal()">
                                    <i class="fas fa-plus"></i> Add User
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="usersTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Joined</th>
                                        <th>Status</th>
                                        <th>Last Login</th>
                                        <th>Balance</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- User data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Penalties Tab -->
                <div class="tab-content" id="penalties">
                    <div class="penalty-form-container">
                        <h3 style="margin-bottom: 20px;">Apply Penalty to User</h3>
                        <form id="penaltyForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="penaltyUser">Select User *</label>
                                    <select id="penaltyUser" class="form-control" required>
                                        <option value="">Select User</option>
                                        <!-- Users will be loaded dynamically -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="penaltyType">Penalty Type *</label>
                                    <select id="penaltyType" class="form-control" required>
                                        <option value="">Select Type</option>
                                        <option value="violation_terms">Terms Violation</option>
                                        <option value="fraudulent_activity">Fraudulent Activity</option>
                                        <option value="payment_issue">Payment Issue</option>
                                        <option value="suspicious_behavior">Suspicious Behavior</option>
                                        <option value="system_abuse">System Abuse</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="penaltyAmount">Penalty Amount (USD) *</label>
                                    <input type="number" id="penaltyAmount" class="form-control" required min="0" step="0.01" placeholder="e.g., 50.00">
                                    <p class="form-help">Amount will be deducted from user's balance. Can make balance negative.</p>
                                </div>
                                <div class="form-group">
                                    <label for="penaltyDuration">Penalty Duration (Days)</label>
                                    <input type="number" id="penaltyDuration" class="form-control" min="0" placeholder="e.g., 7">
                                    <p class="form-help">0 = Permanent penalty</p>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="penaltyReason">Reason for Penalty *</label>
                                <textarea id="penaltyReason" class="form-control" required rows="4" placeholder="Detailed explanation of why this penalty is being applied..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="sendNotification">
                                    <input type="checkbox" id="sendNotification" checked> Send Notification to User
                                </label>
                            </div>
                            
                            <div class="form-group" style="margin-top: 30px;">
                                <button type="submit" class="btn btn-danger" style="padding: 12px 30px;">
                                    <i class="fas fa-gavel"></i> Apply Penalty
                                </button>
                                <button type="button" class="btn btn-outline" onclick="resetPenaltyForm()">
                                    <i class="fas fa-redo"></i> Reset Form
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="penalty-history">
                        <div class="data-table-card">
                            <div class="table-header">
                                <h3>Penalty History</h3>
                                <div class="table-actions">
                                    <input type="date" id="penaltyStartDate" class="form-control" style="width: 150px;">
                                    <input type="date" id="penaltyEndDate" class="form-control" style="width: 150px;">
                                    <button class="btn btn-outline" onclick="filterPenalties()">
                                        <i class="fas fa-filter"></i> Filter
                                    </button>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="data-table" id="penaltiesTable">
                                    <thead>
                                        <tr>
                                            <th>Penalty ID</th>
                                            <th>User</th>
                                            <th>Type</th>
                                            <th>Amount</th>
                                            <th>Reason</th>
                                            <th>Applied By</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Penalty data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KYC Tab -->
                <div class="tab-content" id="kyc">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>KYC Verification Requests</h3>
                            <div class="view-toggle" style="display: flex; border: 1px solid #e2e8f0; border-radius: var(--border-radius); overflow: hidden;">
                                <button class="view-btn active" data-status="pending" style="padding: 8px 15px; background: none; border: none; cursor: pointer; color: var(--secondary-color); transition: var(--transition);">Pending</button>
                                <button class="view-btn" data-status="approved" style="padding: 8px 15px; background: none; border: none; cursor: pointer; color: var(--secondary-color); transition: var(--transition);">Approved</button>
                                <button class="view-btn" data-status="rejected" style="padding: 8px 15px; background: none; border: none; cursor: pointer; color: var(--secondary-color); transition: var(--transition);">Rejected</button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="kycTable">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Submitted</th>
                                        <th>Document Type</th>
                                        <th>Documents</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- KYC data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Balances Tab -->
                <div class="tab-content" id="balances">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>User Balances</h3>
                            <div class="table-actions">
                                <input type="text" id="balanceSearch" placeholder="Search user..." class="form-control" style="width: 200px;">
                                <button class="btn btn-primary" onclick="showEditBalanceModal()">
                                    <i class="fas fa-edit"></i> Edit Balance
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="balancesTable">
                                <thead>
                                    <tr>
                                        <th>User ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Main Balance</th>
                                        <th>Penalty Balance</th>
                                        <th>Net Balance</th>
                                        <th>Last Updated</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Balance data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Deposits Tab -->
                <div class="tab-content" id="deposits">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>Deposit Requests</h3>
                            <div class="view-toggle" style="display: flex; border: 1px solid #e2e8f0; border-radius: var(--border-radius); overflow: hidden;">
                                <button class="view-btn active" data-status="pending" style="padding: 8px 15px; background: none; border: none; cursor: pointer; color: var(--secondary-color); transition: var(--transition);">Pending</button>
                                <button class="view-btn" data-status="completed" style="padding: 8px 15px; background: none; border: none; cursor: pointer; color: var(--secondary-color); transition: var(--transition);">Completed</button>
                                <button class="view-btn" data-status="failed" style="padding: 8px 15px; background: none; border: none; cursor: pointer; color: var(--secondary-color); transition: var(--transition);">Failed</button>
                                <button class="view-btn" data-status="all" style="padding: 8px 15px; background: none; border: none; cursor: pointer; color: var(--secondary-color); transition: var(--transition);">All</button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="depositsTable">
                                <thead>
                                    <tr>
                                        <th>Transaction ID</th>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Deposit data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Withdrawals Tab -->
                <div class="tab-content" id="withdrawals">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>Withdrawal Requests</h3>
                            <div class="view-toggle" style="display: flex; border: 1px solid #e2e8f0; border-radius: var(--border-radius); overflow: hidden;">
                                <button class="view-btn active" data-status="pending" style="padding: 8px 15px; background: none; border: none; cursor: pointer; color: var(--secondary-color); transition: var(--transition);">Pending</button>
                                <button class="view-btn" data-status="approved" style="padding: 8px 15px; background: none; border: none; cursor: pointer; color: var(--secondary-color); transition: var(--transition);">Approved</button>
                                <button class="view-btn" data-status="rejected" style="padding: 8px 15px; background: none; border: none; cursor: pointer; color: var(--secondary-color); transition: var(--transition);">Rejected</button>
                                <button class="view-btn" data-status="all" style="padding: 8px 15px; background: none; border: none; cursor: pointer; color: var(--secondary-color); transition: var(--transition);">All</button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="withdrawalsTable">
                                <thead>
                                    <tr>
                                        <th>Transaction ID</th>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Wallet/Bank Details</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Withdrawal data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Transactions Tab -->
                <div class="tab-content" id="transactions">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>All Transactions</h3>
                            <div class="table-actions">
                                <input type="date" id="startDate" class="form-control" style="width: 150px;">
                                <input type="date" id="endDate" class="form-control" style="width: 150px;">
                                <button class="btn btn-outline" onclick="filterTransactions()">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                                <button class="btn btn-outline" onclick="exportTransactions()">
                                    <i class="fas fa-download"></i> Export
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="transactionsTable">
                                <thead>
                                    <tr>
                                        <th>Transaction ID</th>
                                        <th>User</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Fee</th>
                                        <th>Net Amount</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Details</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Transaction data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Activity Log Tab -->
                <div class="tab-content" id="activity-log">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>User Activity Log</h3>
                            <div class="table-actions">
                                <input type="date" id="activityStartDate" class="form-control" style="width: 150px;">
                                <input type="date" id="activityEndDate" class="form-control" style="width: 150px;">
                                <select id="activityType" class="form-control" style="width: 200px;">
                                    <option value="">All Activities</option>
                                    <option value="login">Login</option>
                                    <option value="logout">Logout</option>
                                    <option value="deposit">Deposit</option>
                                    <option value="withdrawal">Withdrawal</option>
                                    <option value="penalty">Penalty</option>
                                    <option value="kyc">KYC</option>
                                </select>
                                <button class="btn btn-outline" onclick="filterActivities()">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="activityLogTable">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>User</th>
                                        <th>Action</th>
                                        <th>Details</th>
                                        <th>IP Address</th>
                                        <th>Device</th>
                                        <th>Location</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Activity log data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Login History Tab -->
                <div class="tab-content" id="login-history">
                    <div class="data-table-card">
                        <div class="table-header">
                            <h3>User Login History</h3>
                            <div class="table-actions">
                                <input type="text" id="loginSearch" placeholder="Search user..." class="form-control" style="width: 200px;">
                                <button class="btn btn-outline" onclick="filterLoginHistory()">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="loginHistoryTable">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>User</th>
                                        <th>IP Address</th>
                                        <th>Device</th>
                                        <th>Browser</th>
                                        <th>Location</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Login history data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Notifications Tab -->
                <div class="tab-content" id="notifications">
                    <div class="data-table-card">
                        <div class="tabs">
                            <button class="tab active" data-notification-type="send">Send Notification</button>
                            <button class="tab" data-notification-type="history">Notification History</button>
                        </div>
                        
                        <!-- Send Notification -->
                        <div class="tab-content active" id="sendNotification">
                            <form id="sendNotificationForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="notificationType">Notification Type *</label>
                                        <select id="notificationType" class="form-control" required>
                                            <option value="">Select Type</option>
                                            <option value="all">All Users</option>
                                            <option value="specific">Specific User</option>
                                            <option value="penalized">Penalized Users</option>
                                            <option value="kyc">KYC Users</option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="specificUserGroup" style="display: none;">
                                        <label for="specificUser">User Email</label>
                                        <input type="email" id="specificUser" class="form-control" placeholder="user@example.com">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="notificationTitle">Title *</label>
                                    <input type="text" id="notificationTitle" class="form-control" required placeholder="Notification title">
                                </div>
                                
                                <div class="form-group">
                                    <label for="notificationMessage">Message *</label>
                                    <textarea id="notificationMessage" class="form-control" required rows="5" placeholder="Notification message..."></textarea>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="notificationPriority">Priority</label>
                                        <select id="notificationPriority" class="form-control">
                                            <option value="low">Low</option>
                                            <option value="normal" selected>Normal</option>
                                            <option value="high">High</option>
                                            <option value="urgent">Urgent</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="notificationChannel">Channels</label>
                                        <div style="margin-top: 8px;">
                                            <label style="display: inline-flex; align-items: center; margin-right: 20px;">
                                                <input type="checkbox" id="channelInApp" checked> In-App
                                            </label>
                                            <label style="display: inline-flex; align-items: center; margin-right: 20px;">
                                                <input type="checkbox" id="channelEmail"> Email
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group" style="margin-top: 30px;">
                                    <button type="submit" class="btn btn-primary" style="padding: 12px 30px;">
                                        <i class="fas fa-paper-plane"></i> Send Notification
                                    </button>
                                    <button type="button" class="btn btn-outline" onclick="previewNotification()">
                                        <i class="fas fa-eye"></i> Preview
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Notification History -->
                        <div class="tab-content" id="notificationHistory">
                            <div class="table-responsive">
                                <table class="data-table" id="notificationsTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Title</th>
                                            <th>Type</th>
                                            <th>Recipients</th>
                                            <th>Sent Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Notification history will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-content" id="settings">
                    <div class="data-table-card">
                        <div class="tabs">
                            <button class="tab active" data-settings="general">General Settings</button>
                            <button class="tab" data-settings="penalty">Penalty Settings</button>
                            <button class="tab" data-settings="security">Security</button>
                        </div>
                        
                        <!-- General Settings -->
                        <div class="tab-content active" id="generalSettings">
                            <form id="generalSettingsForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="siteName">Site Name</label>
                                        <input type="text" id="siteName" class="form-control" value="Hashvex Technologies">
                                    </div>
                                    <div class="form-group">
                                        <label for="siteUrl">Site URL</label>
                                        <input type="url" id="siteUrl" class="form-control" value="https://hashvex.com">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="adminEmail">Admin Email</label>
                                        <input type="email" id="adminEmail" class="form-control" value="admin@hashvex.com">
                                    </div>
                                    <div class="form-group">
                                        <label for="supportEmail">Support Email</label>
                                        <input type="email" id="supportEmail" class="form-control" value="support@hashvex.com">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="siteDescription">Site Description</label>
                                    <textarea id="siteDescription" class="form-control" rows="3">Leading Bitcoin mining platform offering mining hardware sales and rentals.</textarea>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="maintenanceMode">
                                            <input type="checkbox" id="maintenanceMode"> Maintenance Mode
                                        </label>
                                        <p class="form-help">When enabled, only admins can access the site</p>
                                    </div>
                                    <div class="form-group">
                                        <label for="registrationEnabled">
                                            <input type="checkbox" id="registrationEnabled" checked> New Registrations Enabled
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group" style="margin-top: 30px;">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Save Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Penalty Settings -->
                        <div class="tab-content" id="penaltySettings">
                            <form id="penaltySettingsForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="maxNegativeBalance">Maximum Negative Balance (USD)</label>
                                        <input type="number" id="maxNegativeBalance" class="form-control" min="0" step="0.01" value="1000">
                                        <p class="form-help">Maximum amount a user's balance can go negative</p>
                                    </div>
                                    <div class="form-group">
                                        <label for="penaltyNotificationDelay">Notification Delay (Hours)</label>
                                        <input type="number" id="penaltyNotificationDelay" class="form-control" min="0" value="24">
                                        <p class="form-help">Hours before notifying user of penalty</p>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="autoPenaltySystem">
                                            <input type="checkbox" id="autoPenaltySystem"> Enable Auto-Penalty System
                                        </label>
                                        <p class="form-help">Automatically apply penalties for certain violations</p>
                                    </div>
                                    <div class="form-group">
                                        <label for="requireApproval">
                                            <input type="checkbox" id="requireApproval"> Require Admin Approval for Large Penalties
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="largePenaltyThreshold">Large Penalty Threshold (USD)</label>
                                        <input type="number" id="largePenaltyThreshold" class="form-control" min="0" step="0.01" value="500">
                                    </div>
                                    <div class="form-group">
                                        <label for="penaltyGracePeriod">Grace Period (Days)</label>
                                        <input type="number" id="penaltyGracePeriod" class="form-control" min="0" value="3">
                                        <p class="form-help">Days before penalty takes full effect</p>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="penaltyReasons">Default Penalty Reasons</label>
                                    <textarea id="penaltyReasons" class="form-control" rows="4" placeholder="Enter default penalty reasons, one per line"></textarea>
                                    <p class="form-help">These will appear as suggestions when applying penalties</p>
                                </div>
                                
                                <div class="form-group" style="margin-top: 30px;">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Save Penalty Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Security Settings -->
                        <div class="tab-content" id="securitySettings">
                            <form id="securitySettingsForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="sessionTimeout">Session Timeout (minutes)</label>
                                        <input type="number" id="sessionTimeout" class="form-control" min="5" value="30">
                                    </div>
                                    <div class="form-group">
                                        <label for="maxLoginAttempts">Max Login Attempts</label>
                                        <input type="number" id="maxLoginAttempts" class="form-control" min="1" value="5">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="require2FA">
                                            <input type="checkbox" id="require2FA"> Require 2FA for Admins
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label for="requireKYC">
                                            <input type="checkbox" id="requireKYC" checked> Require KYC for Withdrawals
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="ipWhitelist">IP Whitelist (comma separated)</label>
                                        <textarea id="ipWhitelist" class="form-control" rows="3" placeholder="192.168.1.1, 10.0.0.1"></textarea>
                                        <p class="form-help">Leave empty to allow all IPs</p>
                                    </div>
                                </div>
                                
                                <div class="form-group" style="margin-top: 30px;">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Save Security Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
    
    <!-- Admin JavaScript -->
    <script>
        // Base URL for API calls
        const API_BASE_URL = 'https://hashvex-technologies-backend.onrender.com/api';
        let currentAdmin = null;
        let authToken = null;
        let activityChart = null;
        let penaltyChart = null;
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if already logged in
            authToken = localStorage.getItem('hashvex_admin_token');
            
            if (authToken) {
                // Verify token
                verifyToken();
            } else {
                // Show login modal
                showLoginModal();
            }
            
            // Setup login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Setup penalty form
            document.getElementById('penaltyForm').addEventListener('submit', handlePenaltySubmit);
        });
        
        // Show login modal
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('adminContainer').style.display = 'none';
        }
        
        // Hide login modal
        function hideLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'flex';
        }
        
        // Handle login
        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const loginBtn = document.getElementById('loginBtn');
            const loginError = document.getElementById('loginError');
            
            // Show loading
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
            loginBtn.disabled = true;
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    // Store token and admin data
                    authToken = data.token;
                    currentAdmin = data.admin;
                    localStorage.setItem('hashvex_admin_token', authToken);
                    localStorage.setItem('hashvex_admin_data', JSON.stringify(currentAdmin));
                    
                    // Hide login modal
                    hideLoginModal();
                    
                    // Initialize dashboard
                    initializeDashboard();
                    
                    showNotification('Login successful!', 'success');
                } else {
                    loginError.textContent = data.message || 'Invalid credentials';
                    loginError.style.display = 'block';
                    setTimeout(() => {
                        loginError.style.display = 'none';
                    }, 3000);
                }
            } catch (error) {
                console.error('Login error:', error);
                loginError.textContent = 'Network error. Please try again.';
                loginError.style.display = 'block';
            } finally {
                loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
                loginBtn.disabled = false;
            }
        }
        
        // Verify token
        async function verifyToken() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/verify`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    currentAdmin = data.admin;
                    
                    // Hide login modal and show dashboard
                    hideLoginModal();
                    initializeDashboard();
                } else {
                    localStorage.removeItem('hashvex_admin_token');
                    localStorage.removeItem('hashvex_admin_data');
                    showLoginModal();
                }
            } catch (error) {
                console.error('Token verification error:', error);
                showLoginModal();
            }
        }
        
        // Initialize dashboard
        function initializeDashboard() {
            // Update admin UI
            updateAdminUI();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load initial data
            loadDashboardData();
            
            // Load users for penalty form
            loadUsersForPenaltyForm();
            
            // Load penalty history
            loadPenalties();
        }
        
        // Update admin UI with user info
        function updateAdminUI() {
            if (currentAdmin) {
                document.getElementById('adminName').textContent = currentAdmin.name || 'Admin User';
                document.getElementById('adminAvatar').textContent = currentAdmin.name ? currentAdmin.name.charAt(0).toUpperCase() : 'A';
                
                // Setup logout
                document.getElementById('adminProfile').addEventListener('click', function() {
                    showLogoutModal();
                });
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Sidebar menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // Mobile menu toggle
            document.getElementById('mobileMenuToggle').addEventListener('click', function() {
                document.getElementById('sidebar').classList.add('active');
            });
            
            document.getElementById('menuToggle').addEventListener('click', function() {
                document.getElementById('sidebar').classList.remove('active');
            });
            
            // Global search
            document.getElementById('globalSearch').addEventListener('input', function(e) {
                performGlobalSearch(e.target.value);
            });
            
            // Notification type change
            document.getElementById('notificationType').addEventListener('change', function() {
                const specificGroup = document.getElementById('specificUserGroup');
                if (this.value === 'specific') {
                    specificGroup.style.display = 'block';
                } else {
                    specificGroup.style.display = 'none';
                }
            });
            
            // Settings tabs
            document.querySelectorAll('#settings .tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const settingsType = this.getAttribute('data-settings');
                    switchSettingsTab(settingsType);
                });
            });
            
            // Notification tabs
            document.querySelectorAll('#notifications .tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const type = this.getAttribute('data-notification-type');
                    switchNotificationTab(type);
                });
            });
            
            // View toggles
            document.querySelectorAll('.view-toggle .view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const parent = this.closest('.view-toggle');
                    parent.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const status = this.getAttribute('data-status');
                    const tableId = getTableIdFromParent(this);
                    if (tableId && status) {
                        filterTableByStatus(tableId, status);
                    }
                });
            });
            
            // Form submissions
            document.getElementById('sendNotificationForm')?.addEventListener('submit', handleSendNotification);
            document.getElementById('generalSettingsForm')?.addEventListener('submit', handleSaveGeneralSettings);
            document.getElementById('penaltySettingsForm')?.addEventListener('submit', handleSavePenaltySettings);
            document.getElementById('securitySettingsForm')?.addEventListener('submit', handleSaveSecuritySettings);
            
            // Handle responsive design
            window.addEventListener('resize', handleResponsive);
            handleResponsive();
        }
        
        // Switch between tabs
        function switchTab(tabId) {
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-tab') === tabId) {
                    item.classList.add('active');
                }
            });
            
            // Update active tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                if (content.id === tabId) {
                    content.classList.add('active');
                }
            });
            
            // Update page title
            const pageTitle = document.getElementById('pageTitle');
            const activeItem = document.querySelector(`.menu-item[data-tab="${tabId}"]`);
            if (activeItem) {
                const itemText = activeItem.querySelector('span').textContent;
                pageTitle.textContent = itemText;
            }
            
            // Load tab data if needed
            loadTabData(tabId);
            
            // Close mobile sidebar
            document.getElementById('sidebar').classList.remove('active');
        }
        
        // Load data for specific tab
        function loadTabData(tabId) {
            switch(tabId) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'users':
                    loadUsersData();
                    break;
                case 'penalties':
                    loadPenalties();
                    break;
                case 'kyc':
                    loadKYCData();
                    break;
                case 'balances':
                    loadBalancesData();
                    break;
                case 'deposits':
                    loadDepositsData();
                    break;
                case 'withdrawals':
                    loadWithdrawalsData();
                    break;
                case 'transactions':
                    loadTransactionsData();
                    break;
                case 'activity-log':
                    loadActivityLog();
                    break;
                case 'login-history':
                    loadLoginHistory();
                    break;
                case 'notifications':
                    loadNotificationsHistory();
                    break;
            }
        }
        
        // Load dashboard data
        async function loadDashboardData() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/dashboard/stats`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateDashboardStats(data);
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                showNotification('Error loading dashboard data', 'error');
            }
            
            // Load recent activity
            loadRecentActivity();
        }
        
        // Update dashboard stats
        function updateDashboardStats(stats) {
            document.getElementById('totalRevenue').textContent = `$${formatNumber(stats.totalRevenue || 0)}`;
            document.getElementById('totalUsers').textContent = formatNumber(stats.totalUsers || 0);
            document.getElementById('pendingActions').textContent = formatNumber(stats.pendingActions || 0);
            document.getElementById('totalPenalties').textContent = formatNumber(stats.totalPenalties || 0);
            
            // Update charts
            updateCharts(stats);
        }
        
        // Update charts
        function updateCharts(stats) {
            // Activity chart
            const activityCtx = document.getElementById('activityChart').getContext('2d');
            if (activityChart) {
                activityChart.destroy();
            }
            
            activityChart = new Chart(activityCtx, {
                type: 'line',
                data: {
                    labels: stats.activityLabels || ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [
                        {
                            label: 'Logins',
                            data: stats.loginData || [0, 0, 0, 0, 0, 0, 0],
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Transactions',
                            data: stats.transactionData || [0, 0, 0, 0, 0, 0, 0],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Penalties',
                            data: stats.penaltyData || [0, 0, 0, 0, 0, 0, 0],
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
            
            // Penalty chart
            const penaltyCtx = document.getElementById('penaltyChart').getContext('2d');
            if (penaltyChart) {
                penaltyChart.destroy();
            }
            
            penaltyChart = new Chart(penaltyCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Terms Violation', 'Fraudulent Activity', 'Payment Issue', 'Suspicious Behavior', 'System Abuse', 'Other'],
                    datasets: [{
                        data: stats.penaltyDistribution || [25, 15, 20, 10, 20, 10],
                        backgroundColor: [
                            '#ef4444',
                            '#f97316',
                            '#f59e0b',
                            '#3b82f6',
                            '#8b5cf6',
                            '#64748b'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // Load recent activity
        async function loadRecentActivity() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/activity/recent`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateActivityTable(data.activities || []);
            } catch (error) {
                console.error('Error loading activity:', error);
            }
        }
        
        // Update activity table
        function updateActivityTable(activities) {
            const tbody = document.querySelector('#activityTable tbody');
            tbody.innerHTML = '';
            
            activities.forEach(activity => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDateTime(activity.timestamp)}</td>
                    <td>${activity.userName || 'System'}</td>
                    <td>${activity.action}</td>
                    <td>${activity.details || ''}</td>
                    <td>${activity.ipAddress || 'N/A'}</td>
                    <td>${activity.device || 'N/A'}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Load users data
        async function loadUsersData() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/users`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateUsersTable(data.users || []);
            } catch (error) {
                console.error('Error loading users:', error);
                showNotification('Error loading users data', 'error');
            }
        }
        
        // Update users table
        function updateUsersTable(users) {
            const tbody = document.querySelector('#usersTable tbody');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.name || 'N/A'}</td>
                    <td>${user.email}</td>
                    <td>${formatDate(user.createdAt)}</td>
                    <td><span class="status-badge ${user.active ? 'status-active' : 'status-inactive'}">${user.active ? 'Active' : 'Inactive'}</span></td>
                    <td>${user.lastLogin ? formatDateTime(user.lastLogin) : 'Never'}</td>
                    <td class="${user.balance < 0 ? 'negative-balance' : ''}">$${formatNumber(user.balance || 0)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-outline btn-sm" onclick="viewUserDetails('${user.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="editUser('${user.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="toggleUserStatus('${user.id}', ${user.active})">
                                <i class="fas ${user.active ? 'fa-ban' : 'fa-check'}"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Initialize/refresh DataTable
            if ($.fn.DataTable.isDataTable('#usersTable')) {
                $('#usersTable').DataTable().destroy();
            }
            $('#usersTable').DataTable({
                responsive: true,
                pageLength: 25,
                order: [[3, 'desc']]
            });
        }
        
        // Load users for penalty form
        async function loadUsersForPenaltyForm() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/users/simple`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                const select = document.getElementById('penaltyUser');
                select.innerHTML = '<option value="">Select User</option>';
                
                data.users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = `${user.name} (${user.email}) - Balance: $${formatNumber(user.balance || 0)}`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading users for penalty form:', error);
            }
        }
        
        // Handle penalty submission
        async function handlePenaltySubmit(e) {
            e.preventDefault();
            
            const userId = document.getElementById('penaltyUser').value;
            const penaltyType = document.getElementById('penaltyType').value;
            const penaltyAmount = parseFloat(document.getElementById('penaltyAmount').value);
            const penaltyDuration = parseInt(document.getElementById('penaltyDuration').value) || 0;
            const penaltyReason = document.getElementById('penaltyReason').value;
            const sendNotification = document.getElementById('sendNotification').checked;
            
            if (!userId || !penaltyType || !penaltyAmount || !penaltyReason) {
                showNotification('Please fill all required fields', 'error');
                return;
            }
            
            if (penaltyAmount <= 0) {
                showNotification('Penalty amount must be greater than 0', 'error');
                return;
            }
            
            const penaltyData = {
                userId,
                type: penaltyType,
                amount: penaltyAmount,
                duration: penaltyDuration,
                reason: penaltyReason,
                sendNotification,
                adminId: currentAdmin.id
            };
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/penalties/apply`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(penaltyData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showNotification('Penalty applied successfully!', 'success');
                    resetPenaltyForm();
                    loadPenalties();
                    loadDashboardData();
                    
                    // Show penalty details modal
                    showPenaltyDetailsModal(data.penalty);
                } else {
                    showNotification(data.message || 'Error applying penalty', 'error');
                }
            } catch (error) {
                console.error('Error applying penalty:', error);
                showNotification('Error applying penalty', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Load penalties
        async function loadPenalties() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/penalties`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updatePenaltiesTable(data.penalties || []);
            } catch (error) {
                console.error('Error loading penalties:', error);
                showNotification('Error loading penalties data', 'error');
            }
        }
        
        // Update penalties table
        function updatePenaltiesTable(penalties) {
            const tbody = document.querySelector('#penaltiesTable tbody');
            tbody.innerHTML = '';
            
            penalties.forEach(penalty => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${penalty.id}</td>
                    <td>
                        <div>${penalty.userName || 'N/A'}</div>
                        <small>${penalty.userEmail}</small>
                    </td>
                    <td>${formatPenaltyType(penalty.type)}</td>
                    <td class="negative-balance">-$${formatNumber(penalty.amount)}</td>
                    <td>${penalty.reason.substring(0, 50)}${penalty.reason.length > 50 ? '...' : ''}</td>
                    <td>${penalty.adminName || 'System'}</td>
                    <td>${formatDateTime(penalty.createdAt)}</td>
                    <td><span class="status-badge ${penalty.status === 'active' ? 'status-penalized' : 'status-inactive'}">${penalty.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-outline btn-sm" onclick="viewPenaltyDetails('${penalty.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="reversePenalty('${penalty.id}')">
                                <i class="fas fa-undo"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Initialize/refresh DataTable
            if ($.fn.DataTable.isDataTable('#penaltiesTable')) {
                $('#penaltiesTable').DataTable().destroy();
            }
            $('#penaltiesTable').DataTable({
                responsive: true,
                pageLength: 25,
                order: [[6, 'desc']]
            });
        }
        
        // Show penalty details modal
        function showPenaltyDetailsModal(penalty) {
            const modalHtml = `
                <div class="modal-overlay active" id="penaltyDetailsModal">
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3>Penalty Applied Successfully</h3>
                            <button class="modal-close" onclick="closeModal('penaltyDetailsModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Penalty ID</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; font-family: monospace;">${penalty.id}</div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>User</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${penalty.userName} (${penalty.userEmail})</div>
                                </div>
                                <div class="form-group">
                                    <label>Amount</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;" class="negative-balance">-$${formatNumber(penalty.amount)}</div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Type</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatPenaltyType(penalty.type)}</div>
                                </div>
                                <div class="form-group">
                                    <label>Duration</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${penalty.duration === 0 ? 'Permanent' : `${penalty.duration} days`}</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Reason</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${penalty.reason}</div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Applied By</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${penalty.adminName}</div>
                                </div>
                                <div class="form-group">
                                    <label>Applied At</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(penalty.createdAt)}</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>New User Balance</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;" class="${penalty.newBalance < 0 ? 'negative-balance' : ''}">$${formatNumber(penalty.newBalance)}</div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('penaltyDetailsModal')">Close</button>
                            <button class="btn btn-primary" onclick="printPenalty('${penalty.id}')">
                                <i class="fas fa-print"></i> Print Receipt
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // View penalty details
        async function viewPenaltyDetails(penaltyId) {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/penalties/${penaltyId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showPenaltyDetailsViewModal(data.penalty);
                } else {
                    showNotification('Error loading penalty details', 'error');
                }
            } catch (error) {
                console.error('Error loading penalty details:', error);
                showNotification('Error loading penalty details', 'error');
            }
        }
        
        // Show penalty details view modal
        function showPenaltyDetailsViewModal(penalty) {
            const modalHtml = `
                <div class="modal-overlay active" id="penaltyViewModal">
                    <div class="modal" style="max-width: 700px;">
                        <div class="modal-header">
                            <h3>Penalty Details</h3>
                            <button class="modal-close" onclick="closeModal('penaltyViewModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Penalty ID</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; font-family: monospace;">${penalty.id}</div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>User</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                        <div>${penalty.userName}</div>
                                        <small>${penalty.userEmail}</small>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Amount</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;" class="negative-balance">-$${formatNumber(penalty.amount)}</div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Type</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatPenaltyType(penalty.type)}</div>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                        <span class="status-badge ${penalty.status === 'active' ? 'status-penalized' : 'status-inactive'}">${penalty.status}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Duration</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${penalty.duration === 0 ? 'Permanent' : `${penalty.duration} days`}</div>
                                </div>
                                <div class="form-group">
                                    <label>Expires</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${penalty.expiresAt ? formatDateTime(penalty.expiresAt) : 'Never'}</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Reason</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${penalty.reason}</div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Applied By</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${penalty.adminName}</div>
                                </div>
                                <div class="form-group">
                                    <label>Applied At</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(penalty.createdAt)}</div>
                                </div>
                            </div>
                            
                            ${penalty.notes ? `
                                <div class="form-group">
                                    <label>Admin Notes</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${penalty.notes}</div>
                                </div>
                            ` : ''}
                            
                            <div class="form-group">
                                <label>Impact on User Balance</label>
                                <div style="padding: 15px; background-color: #fef3c7; border-radius: 6px;">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <div>Previous Balance</div>
                                            <div style="font-weight: 600;">$${formatNumber(penalty.previousBalance)}</div>
                                        </div>
                                        <div class="form-group">
                                            <div>Penalty Amount</div>
                                            <div style="font-weight: 600;" class="negative-balance">-$${formatNumber(penalty.amount)}</div>
                                        </div>
                                        <div class="form-group">
                                            <div>New Balance</div>
                                            <div style="font-weight: 600;" class="${penalty.newBalance < 0 ? 'negative-balance' : ''}">$${formatNumber(penalty.newBalance)}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('penaltyViewModal')">Close</button>
                            ${penalty.status === 'active' ? `
                                <button class="btn btn-success" onclick="reversePenalty('${penalty.id}')">
                                    <i class="fas fa-undo"></i> Reverse Penalty
                                </button>
                            ` : ''}
                            <button class="btn btn-primary" onclick="printPenalty('${penalty.id}')">
                                <i class="fas fa-print"></i> Print
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Reverse a penalty
        async function reversePenalty(penaltyId) {
            if (!confirm('Are you sure you want to reverse this penalty? This will restore the amount to the user\'s balance.')) {
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/penalties/${penaltyId}/reverse`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        adminId: currentAdmin.id,
                        reason: 'Penalty reversed by admin'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showNotification('Penalty reversed successfully!', 'success');
                    closeModal('penaltyViewModal');
                    loadPenalties();
                    loadDashboardData();
                } else {
                    showNotification(data.message || 'Error reversing penalty', 'error');
                }
            } catch (error) {
                console.error('Error reversing penalty:', error);
                showNotification('Error reversing penalty', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Print penalty receipt
        function printPenalty(penaltyId) {
            // In a real implementation, this would generate a printable receipt
            // For now, just show a notification
            showNotification('Print functionality would generate a penalty receipt', 'info');
        }
        
        // Reset penalty form
        function resetPenaltyForm() {
            document.getElementById('penaltyForm').reset();
        }
        
        // Filter penalties by date
        async function filterPenalties() {
            const startDate = document.getElementById('penaltyStartDate').value;
            const endDate = document.getElementById('penaltyEndDate').value;
            
            let url = `${API_BASE_URL}/admin/penalties`;
            const params = [];
            if (startDate) params.push(`startDate=${startDate}`);
            if (endDate) params.push(`endDate=${endDate}`);
            
            if (params.length > 0) {
                url += '?' + params.join('&');
            }
            
            showLoading();
            
            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updatePenaltiesTable(data.penalties || []);
                showNotification('Penalties filtered', 'info');
            } catch (error) {
                console.error('Error filtering penalties:', error);
                showNotification('Error filtering penalties', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Load KYC data
        async function loadKYCData() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/kyc/pending`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateKYCTable(data.kycRequests || []);
                document.getElementById('kycBadge').textContent = data.count || 0;
            } catch (error) {
                console.error('Error loading KYC data:', error);
                showNotification('Error loading KYC data', 'error');
            }
        }
        
        // Update KYC table
        function updateKYCTable(requests) {
            const tbody = document.querySelector('#kycTable tbody');
            tbody.innerHTML = '';
            
            requests.forEach(request => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div>${request.userName}</div>
                        <small>${request.userEmail}</small>
                    </td>
                    <td>${formatDateTime(request.submittedAt)}</td>
                    <td>${request.documentType}</td>
                    <td>
                        <button class="btn btn-outline btn-sm" onclick="viewKYCDocuments('${request.userId}')">
                            <i class="fas fa-file"></i> View Docs
                        </button>
                    </td>
                    <td><span class="status-badge status-pending">Pending</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-success btn-sm" onclick="approveKYC('${request.userId}')">
                                <i class="fas fa-check"></i> Approve
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="rejectKYC('${request.userId}')">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Load balances data
        async function loadBalancesData() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/balances`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateBalancesTable(data.balances || []);
            } catch (error) {
                console.error('Error loading balances:', error);
                showNotification('Error loading balances data', 'error');
            }
        }
        
        // Update balances table
        function updateBalancesTable(balances) {
            const tbody = document.querySelector('#balancesTable tbody');
            tbody.innerHTML = '';
            
            balances.forEach(balance => {
                const penaltyBalance = balance.penaltyBalance || 0;
                const netBalance = (balance.mainBalance || 0) - penaltyBalance;
                const isNegative = netBalance < 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${balance.userId}</td>
                    <td>${balance.userName || 'N/A'}</td>
                    <td>${balance.userEmail}</td>
                    <td>$${formatNumber(balance.mainBalance || 0)}</td>
                    <td class="negative-balance">-$${formatNumber(penaltyBalance)}</td>
                    <td class="${isNegative ? 'negative-balance' : ''}">$${formatNumber(netBalance)}</td>
                    <td>${formatDateTime(balance.updatedAt)}</td>
                    <td>
                        <button class="btn btn-outline btn-sm" onclick="editUserBalance('${balance.userId}', '${balance.userName}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        ${isNegative ? `<button class="btn btn-warning btn-sm" onclick="viewUserPenalties('${balance.userId}')">
                            <i class="fas fa-gavel"></i> Penalties
                        </button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Load deposits data
        async function loadDepositsData() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/deposits`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateDepositsTable(data.deposits || []);
                document.getElementById('depositsBadge').textContent = data.pendingCount || 0;
            } catch (error) {
                console.error('Error loading deposits:', error);
                showNotification('Error loading deposits data', 'error');
            }
        }
        
        // Update deposits table
        function updateDepositsTable(deposits) {
            const tbody = document.querySelector('#depositsTable tbody');
            tbody.innerHTML = '';
            
            deposits.forEach(deposit => {
                const statusClass = getStatusClass(deposit.status);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${deposit.transactionId}</td>
                    <td>${deposit.userName || deposit.userEmail}</td>
                    <td>$${formatNumber(deposit.amount)}</td>
                    <td>${deposit.method}</td>
                    <td>${formatDateTime(deposit.createdAt)}</td>
                    <td><span class="status-badge ${statusClass}">${deposit.status}</span></td>
                    <td>
                        ${deposit.status === 'pending' ? `
                            <div class="action-buttons">
                                <button class="btn btn-success btn-sm" onclick="approveDeposit('${deposit.id}')">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="rejectDeposit('${deposit.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            </div>
                        ` : 'N/A'}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Load withdrawals data
        async function loadWithdrawalsData() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/withdrawals`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateWithdrawalsTable(data.withdrawals || []);
                document.getElementById('withdrawalsBadge').textContent = data.pendingCount || 0;
            } catch (error) {
                console.error('Error loading withdrawals:', error);
                showNotification('Error loading withdrawals data', 'error');
            }
        }
        
        // Update withdrawals table
        function updateWithdrawalsTable(withdrawals) {
            const tbody = document.querySelector('#withdrawalsTable tbody');
            tbody.innerHTML = '';
            
            withdrawals.forEach(withdrawal => {
                const statusClass = getStatusClass(withdrawal.status);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${withdrawal.transactionId}</td>
                    <td>${withdrawal.userName || withdrawal.userEmail}</td>
                    <td>$${formatNumber(withdrawal.amount)}</td>
                    <td>${withdrawal.method}</td>
                    <td>${formatDateTime(withdrawal.createdAt)}</td>
                    <td><span class="status-badge ${statusClass}">${withdrawal.status}</span></td>
                    <td>
                        ${withdrawal.method === 'bitcoin' ? 
                            `<small>${withdrawal.walletAddress || 'N/A'}</small>` : 
                            `<small>${withdrawal.bankDetails || 'N/A'}</small>`}
                    </td>
                    <td>
                        ${withdrawal.status === 'pending' ? `
                            <div class="action-buttons">
                                <button class="btn btn-success btn-sm" onclick="approveWithdrawal('${withdrawal.id}')">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="rejectWithdrawal('${withdrawal.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="viewWithdrawalDetails('${withdrawal.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        ` : `
                            <button class="btn btn-outline btn-sm" onclick="viewWithdrawalDetails('${withdrawal.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        `}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Load transactions data
        async function loadTransactionsData() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/transactions`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateTransactionsTable(data.transactions || []);
            } catch (error) {
                console.error('Error loading transactions:', error);
                showNotification('Error loading transactions data', 'error');
            }
        }
        
        // Update transactions table
        function updateTransactionsTable(transactions) {
            const tbody = document.querySelector('#transactionsTable tbody');
            tbody.innerHTML = '';
            
            transactions.forEach(transaction => {
                const statusClass = getStatusClass(transaction.status);
                const isPenalty = transaction.type === 'penalty';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${transaction.transactionId}</td>
                    <td>${transaction.userName || transaction.userEmail}</td>
                    <td>${transaction.type}</td>
                    <td class="${isPenalty ? 'negative-balance' : ''}">${isPenalty ? '-' : ''}$${formatNumber(transaction.amount)}</td>
                    <td>$${formatNumber(transaction.fee || 0)}</td>
                    <td>${isPenalty ? '-' : ''}$${formatNumber(transaction.netAmount || transaction.amount)}</td>
                    <td>${formatDateTime(transaction.createdAt)}</td>
                    <td><span class="status-badge ${statusClass}">${transaction.status}</span></td>
                    <td>
                        <button class="btn btn-outline btn-sm" onclick="viewTransactionDetails('${transaction.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Initialize/refresh DataTable
            if ($.fn.DataTable.isDataTable('#transactionsTable')) {
                $('#transactionsTable').DataTable().destroy();
            }
            $('#transactionsTable').DataTable({
                responsive: true,
                pageLength: 25,
                order: [[6, 'desc']]
            });
        }
        
        // Load activity log
        async function loadActivityLog() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/activity/log`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateActivityLogTable(data.activities || []);
            } catch (error) {
                console.error('Error loading activity log:', error);
                showNotification('Error loading activity log', 'error');
            }
        }
        
        // Update activity log table
        function updateActivityLogTable(activities) {
            const tbody = document.querySelector('#activityLogTable tbody');
            tbody.innerHTML = '';
            
            activities.forEach(activity => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDateTime(activity.timestamp)}</td>
                    <td>${activity.userName || 'System'}</td>
                    <td>${activity.action}</td>
                    <td>${activity.details || ''}</td>
                    <td>${activity.ipAddress || 'N/A'}</td>
                    <td>${activity.device || 'N/A'}</td>
                    <td>${activity.location || 'N/A'}</td>
                `;
                tbody.appendChild(row);
            });
            
            // Initialize/refresh DataTable
            if ($.fn.DataTable.isDataTable('#activityLogTable')) {
                $('#activityLogTable').DataTable().destroy();
            }
            $('#activityLogTable').DataTable({
                responsive: true,
                pageLength: 25,
                order: [[0, 'desc']]
            });
        }
        
        // Load login history
        async function loadLoginHistory() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/activity/logins`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateLoginHistoryTable(data.logins || []);
            } catch (error) {
                console.error('Error loading login history:', error);
                showNotification('Error loading login history', 'error');
            }
        }
        
        // Update login history table
        function updateLoginHistoryTable(logins) {
            const tbody = document.querySelector('#loginHistoryTable tbody');
            tbody.innerHTML = '';
            
            logins.forEach(login => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDateTime(login.timestamp)}</td>
                    <td>${login.userName || login.userEmail}</td>
                    <td>${login.ipAddress || 'N/A'}</td>
                    <td>${login.device || 'N/A'}</td>
                    <td>${login.browser || 'N/A'}</td>
                    <td>${login.location || 'N/A'}</td>
                    <td><span class="status-badge ${login.success ? 'status-success' : 'status-failed'}">${login.success ? 'Success' : 'Failed'}</span></td>
                `;
                tbody.appendChild(row);
            });
            
            // Initialize/refresh DataTable
            if ($.fn.DataTable.isDataTable('#loginHistoryTable')) {
                $('#loginHistoryTable').DataTable().destroy();
            }
            $('#loginHistoryTable').DataTable({
                responsive: true,
                pageLength: 25,
                order: [[0, 'desc']]
            });
        }
        
        // Load notifications history
        async function loadNotificationsHistory() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/notifications`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateNotificationsTable(data.notifications || []);
            } catch (error) {
                console.error('Error loading notifications:', error);
            }
        }
        
        // Update notifications table
        function updateNotificationsTable(notifications) {
            const tbody = document.querySelector('#notificationsTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            notifications.forEach(notification => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${notification.id}</td>
                    <td>${notification.title}</td>
                    <td>${notification.type}</td>
                    <td>${notification.recipientCount || 1}</td>
                    <td>${formatDateTime(notification.sentAt)}</td>
                    <td><span class="status-badge ${notification.status === 'sent' ? 'status-completed' : 'status-pending'}">${notification.status}</span></td>
                    <td>
                        <button class="btn btn-outline btn-sm" onclick="viewNotificationDetails('${notification.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Handle send notification
        async function handleSendNotification(e) {
            e.preventDefault();
            
            const notificationData = {
                type: document.getElementById('notificationType').value,
                title: document.getElementById('notificationTitle').value,
                message: document.getElementById('notificationMessage').value,
                priority: document.getElementById('notificationPriority').value,
                channels: {
                    inApp: document.getElementById('channelInApp').checked,
                    email: document.getElementById('channelEmail').checked
                }
            };
            
            if (notificationData.type === 'specific') {
                const specificUser = document.getElementById('specificUser').value;
                if (!specificUser) {
                    showNotification('Please enter user email for specific notification', 'warning');
                    return;
                }
                notificationData.specificUser = specificUser;
            }
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/notifications/send`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(notificationData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showNotification('Notification sent successfully!', 'success');
                    document.getElementById('sendNotificationForm').reset();
                    document.getElementById('specificUserGroup').style.display = 'none';
                } else {
                    showNotification(data.message || 'Error sending notification', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error sending notification', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Handle save general settings
        async function handleSaveGeneralSettings(e) {
            e.preventDefault();
            
            const settings = {
                siteName: document.getElementById('siteName').value,
                siteUrl: document.getElementById('siteUrl').value,
                adminEmail: document.getElementById('adminEmail').value,
                supportEmail: document.getElementById('supportEmail').value,
                siteDescription: document.getElementById('siteDescription').value,
                maintenanceMode: document.getElementById('maintenanceMode').checked,
                registrationEnabled: document.getElementById('registrationEnabled').checked
            };
            
            await saveSettings('general', settings);
        }
        
        // Handle save penalty settings
        async function handleSavePenaltySettings(e) {
            e.preventDefault();
            
            const settings = {
                maxNegativeBalance: parseFloat(document.getElementById('maxNegativeBalance').value),
                penaltyNotificationDelay: parseInt(document.getElementById('penaltyNotificationDelay').value),
                autoPenaltySystem: document.getElementById('autoPenaltySystem').checked,
                requireApproval: document.getElementById('requireApproval').checked,
                largePenaltyThreshold: parseFloat(document.getElementById('largePenaltyThreshold').value),
                penaltyGracePeriod: parseInt(document.getElementById('penaltyGracePeriod').value),
                penaltyReasons: document.getElementById('penaltyReasons').value
            };
            
            await saveSettings('penalty', settings);
        }
        
        // Handle save security settings
        async function handleSaveSecuritySettings(e) {
            e.preventDefault();
            
            const settings = {
                sessionTimeout: parseInt(document.getElementById('sessionTimeout').value),
                maxLoginAttempts: parseInt(document.getElementById('maxLoginAttempts').value),
                require2FA: document.getElementById('require2FA').checked,
                requireKYC: document.getElementById('requireKYC').checked,
                ipWhitelist: document.getElementById('ipWhitelist').value
            };
            
            await saveSettings('security', settings);
        }
        
        // Save settings to backend
        async function saveSettings(type, settings) {
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/settings/${type}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showNotification('Settings saved successfully!', 'success');
                } else {
                    showNotification(data.message || 'Error saving settings', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error saving settings', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Switch notification tab
        function switchNotificationTab(type) {
            document.querySelectorAll('#notifications .tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-notification-type') === type) {
                    tab.classList.add('active');
                }
            });
            
            document.querySelectorAll('#notifications .tab-content').forEach(content => {
                content.classList.remove('active');
                if (content.id === `${type}Notification`) {
                    content.classList.add('active');
                }
            });
        }
        
        // Switch settings tab
        function switchSettingsTab(type) {
            document.querySelectorAll('#settings .tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-settings') === type) {
                    tab.classList.add('active');
                }
            });
            
            document.querySelectorAll('#settings .tab-content').forEach(content => {
                content.classList.remove('active');
                if (content.id === `${type}Settings`) {
                    content.classList.add('active');
                }
            });
        }
        
        // Get table ID from parent element
        function getTableIdFromParent(element) {
            const card = element.closest('.data-table-card');
            if (!card) return null;
            
            const table = card.querySelector('table');
            return table ? table.id : null;
        }
        
        // Filter table by status
        async function filterTableByStatus(tableId, status) {
            showLoading();
            
            try {
                let url = '';
                let dataKey = '';
                
                switch(tableId) {
                    case 'kycTable':
                        url = `${API_BASE_URL}/admin/kyc?status=${status}`;
                        dataKey = 'kycRequests';
                        break;
                    case 'depositsTable':
                        url = `${API_BASE_URL}/admin/deposits?status=${status}`;
                        dataKey = 'deposits';
                        break;
                    case 'withdrawalsTable':
                        url = `${API_BASE_URL}/admin/withdrawals?status=${status}`;
                        dataKey = 'withdrawals';
                        break;
                    default:
                        return;
                }
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (tableId === 'kycTable') {
                    updateKYCTable(data[dataKey] || []);
                } else if (tableId === 'depositsTable') {
                    updateDepositsTable(data[dataKey] || []);
                } else if (tableId === 'withdrawalsTable') {
                    updateWithdrawalsTable(data[dataKey] || []);
                }
                
                showNotification(`Filtered by ${status}`, 'info');
            } catch (error) {
                console.error(`Error filtering ${tableId}:`, error);
                showNotification('Error filtering data', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Preview notification
        function previewNotification() {
            const title = document.getElementById('notificationTitle').value || 'Notification Title';
            const message = document.getElementById('notificationMessage').value || 'Notification message content...';
            const priority = document.getElementById('notificationPriority').value;
            
            const modalHtml = `
                <div class="modal-overlay active" id="previewModal">
                    <div class="modal" style="max-width: 500px;">
                        <div class="modal-header">
                            <h3>Notification Preview</h3>
                            <button class="modal-close" onclick="closeModal('previewModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div style="background-color: #f8fafc; padding: 20px; border-radius: 8px; border-left: 4px solid ${getPriorityColor(priority)};">
                                <h4 style="margin-bottom: 10px; color: #1e293b;">${title}</h4>
                                <p style="color: #475569; line-height: 1.6;">${message}</p>
                                <div style="margin-top: 15px; font-size: 0.85rem; color: #64748b;">
                                    <span class="status-badge" style="background-color: ${getPriorityColor(priority)}20; color: ${getPriorityColor(priority)};">${priority.toUpperCase()}</span>
                                    <span style="margin-left: 10px;">Just now</span>
                                </div>
                            </div>
                            <p style="margin-top: 20px; color: #64748b; font-size: 0.9rem;">
                                This is how the notification will appear to users.
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('previewModal')">Close</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Show logout modal
        function showLogoutModal() {
            const modalHtml = `
                <div class="modal-overlay active" id="logoutModal">
                    <div class="modal" style="max-width: 400px;">
                        <div class="modal-header">
                            <h3>Logout Confirmation</h3>
                            <button class="modal-close" onclick="closeModal('logoutModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div style="text-align: center; padding: 20px 0;">
                                <i class="fas fa-sign-out-alt" style="font-size: 3rem; color: #64748b; margin-bottom: 15px;"></i>
                                <h4 style="margin-bottom: 10px; color: #1e293b;">Confirm Logout</h4>
                                <p style="color: #64748b;">Are you sure you want to logout from the admin panel?</p>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('logoutModal')">Cancel</button>
                            <button class="btn btn-danger" onclick="performLogout()">Logout</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Perform logout
        async function performLogout() {
            try {
                await fetch(`${API_BASE_URL}/admin/logout`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
            } catch (error) {
                console.error('Logout error:', error);
            } finally {
                localStorage.removeItem('hashvex_admin_token');
                localStorage.removeItem('hashvex_admin_data');
                showLoginModal();
            }
        }
        
        // Show add user modal
        function showAddUserModal() {
            const modalHtml = `
                <div class="modal-overlay active" id="addUserModal">
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3>Add New User</h3>
                            <button class="modal-close" onclick="closeModal('addUserModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="addUserForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="newUserName">Full Name *</label>
                                        <input type="text" id="newUserName" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="newUserEmail">Email *</label>
                                        <input type="email" id="newUserEmail" class="form-control" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="newUserPassword">Password *</label>
                                        <input type="password" id="newUserPassword" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="newUserConfirmPassword">Confirm Password *</label>
                                        <input type="password" id="newUserConfirmPassword" class="form-control" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="newUserMainBalance">Initial Main Balance (USD)</label>
                                        <input type="number" id="newUserMainBalance" class="form-control" value="0" min="0" step="0.01">
                                    </div>
                                    <div class="form-group">
                                        <label for="newUserPenaltyBalance">Initial Penalty Balance (USD)</label>
                                        <input type="number" id="newUserPenaltyBalance" class="form-control" value="0" min="0" step="0.01">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="newUserRole">User Role</label>
                                        <select id="newUserRole" class="form-control">
                                            <option value="user">Regular User</option>
                                            <option value="vip">VIP User</option>
                                            <option value="affiliate">Affiliate</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="newUserStatus">
                                            <input type="checkbox" id="newUserStatus" checked> Active Account
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('addUserModal')">Cancel</button>
                            <button class="btn btn-primary" onclick="addNewUser()">Add User</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Add new user
        async function addNewUser() {
            const name = document.getElementById('newUserName').value;
            const email = document.getElementById('newUserEmail').value;
            const password = document.getElementById('newUserPassword').value;
            const confirmPassword = document.getElementById('newUserConfirmPassword').value;
            const mainBalance = parseFloat(document.getElementById('newUserMainBalance').value) || 0;
            const penaltyBalance = parseFloat(document.getElementById('newUserPenaltyBalance').value) || 0;
            const role = document.getElementById('newUserRole').value;
            const active = document.getElementById('newUserStatus').checked;
            
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }
            
            const userData = {
                name,
                email,
                password,
                mainBalance,
                penaltyBalance,
                role,
                active
            };
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/users`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showNotification('User added successfully!', 'success');
                    closeModal('addUserModal');
                    loadUsersData();
                } else {
                    showNotification(data.message || 'Error adding user', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error adding user', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Show edit balance modal
        function showEditBalanceModal(userId = null, userName = null) {
            if (userId && userName) {
                // Edit specific user
                fetch(`${API_BASE_URL}/admin/users/${userId}/balances`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    showEditBalanceModalForm(userId, userName, data);
                })
                .catch(error => {
                    console.error('Error loading user balances:', error);
                    showNotification('Error loading user data', 'error');
                });
            } else {
                // General edit modal
                showEditBalanceModalForm();
            }
        }
        
        // Show edit balance modal form
        function showEditBalanceModalForm(userId = null, userName = null, balanceData = null) {
            const title = userId ? `Edit Balance: ${userName}` : 'Edit User Balance';
            const userSelect = userId ? `<input type="hidden" id="editBalanceUserId" value="${userId}">` : `
                <div class="form-group">
                    <label for="editBalanceUserSelect">Select User *</label>
                    <select id="editBalanceUserSelect" class="form-control" required>
                        <option value="">Select User</option>
                        <!-- Users will be loaded dynamically -->
                    </select>
                </div>
            `;
            
            const mainBalance = balanceData ? balanceData.mainBalance || 0 : 0;
            const penaltyBalance = balanceData ? balanceData.penaltyBalance || 0 : 0;
            
            const modalHtml = `
                <div class="modal-overlay active" id="editBalanceModal">
                    <div class="modal" style="max-width: 500px;">
                        <div class="modal-header">
                            <h3>${title}</h3>
                            <button class="modal-close" onclick="closeModal('editBalanceModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="editBalanceForm">
                                ${userSelect}
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editMainBalance">Main Balance (USD) *</label>
                                        <input type="number" id="editMainBalance" class="form-control" value="${mainBalance}" min="-10000" step="0.01" required>
                                        <p class="form-help">Can be negative for penalties</p>
                                    </div>
                                    <div class="form-group">
                                        <label for="editPenaltyBalance">Penalty Balance (USD) *</label>
                                        <input type="number" id="editPenaltyBalance" class="form-control" value="${penaltyBalance}" min="0" step="0.01" required>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="editBalanceReason">Reason for Change</label>
                                    <textarea id="editBalanceReason" class="form-control" rows="3" placeholder="Explain why you are changing the balance..."></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('editBalanceModal')">Cancel</button>
                            <button class="btn btn-primary" onclick="saveUserBalance()">Save Changes</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
            
            // If no user ID provided, load users for selection
            if (!userId) {
                loadUsersForBalanceEdit();
            }
        }
        
        // Load users for balance edit dropdown
        async function loadUsersForBalanceEdit() {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/users/simple`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                const select = document.getElementById('editBalanceUserSelect');
                select.innerHTML = '<option value="">Select User</option>';
                
                data.users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = `${user.name} (${user.email}) - Balance: $${formatNumber(user.balance || 0)}`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }
        
        // Save user balance
        async function saveUserBalance() {
            const userId = document.getElementById('editBalanceUserId') ? 
                document.getElementById('editBalanceUserId').value : 
                document.getElementById('editBalanceUserSelect').value;
                
            const mainBalance = parseFloat(document.getElementById('editMainBalance').value);
            const penaltyBalance = parseFloat(document.getElementById('editPenaltyBalance').value);
            const reason = document.getElementById('editBalanceReason').value;
            
            if (!userId) {
                showNotification('Please select a user', 'error');
                return;
            }
            
            const balanceData = {
                mainBalance,
                penaltyBalance,
                reason
            };
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/users/${userId}/balances`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(balanceData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showNotification('Balance updated successfully!', 'success');
                    closeModal('editBalanceModal');
                    loadBalancesData();
                } else {
                    showNotification(data.message || 'Error updating balance', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error updating balance', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // View user penalties
        async function viewUserPenalties(userId) {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/users/${userId}/penalties`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showUserPenaltiesModal(data.user, data.penalties);
                } else {
                    showNotification('Error loading user penalties', 'error');
                }
            } catch (error) {
                console.error('Error loading user penalties:', error);
                showNotification('Error loading user penalties', 'error');
            }
        }
        
        // Show user penalties modal
        function showUserPenaltiesModal(user, penalties) {
            let penaltiesHtml = '';
            
            if (penalties.length > 0) {
                penalties.forEach(penalty => {
                    penaltiesHtml += `
                        <tr>
                            <td>${penalty.id}</td>
                            <td>${formatPenaltyType(penalty.type)}</td>
                            <td class="negative-balance">-$${formatNumber(penalty.amount)}</td>
                            <td>${penalty.reason.substring(0, 50)}${penalty.reason.length > 50 ? '...' : ''}</td>
                            <td>${formatDateTime(penalty.createdAt)}</td>
                            <td><span class="status-badge ${penalty.status === 'active' ? 'status-penalized' : 'status-inactive'}">${penalty.status}</span></td>
                        </tr>
                    `;
                });
            } else {
                penaltiesHtml = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;">
                            No penalties found for this user.
                        </td>
                    </tr>
                `;
            }
            
            const totalPenalties = penalties.reduce((sum, penalty) => sum + penalty.amount, 0);
            const netBalance = (user.mainBalance || 0) - totalPenalties;
            
            const modalHtml = `
                <div class="modal-overlay active" id="userPenaltiesModal">
                    <div class="modal" style="max-width: 900px;">
                        <div class="modal-header">
                            <h3>Penalties for ${user.name}</h3>
                            <button class="modal-close" onclick="closeModal('userPenaltiesModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div style="background-color: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <div>Main Balance</div>
                                        <div style="font-weight: 600; font-size: 1.2rem;">$${formatNumber(user.mainBalance || 0)}</div>
                                    </div>
                                    <div class="form-group">
                                        <div>Total Penalties</div>
                                        <div style="font-weight: 600; font-size: 1.2rem;" class="negative-balance">-$${formatNumber(totalPenalties)}</div>
                                    </div>
                                    <div class="form-group">
                                        <div>Net Balance</div>
                                        <div style="font-weight: 600; font-size: 1.2rem;" class="${netBalance < 0 ? 'negative-balance' : ''}">$${formatNumber(netBalance)}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <h4 style="margin-bottom: 15px;">Penalty History</h4>
                            <div class="table-responsive">
                                <table class="data-table" style="width: 100%;">
                                    <thead>
                                        <tr>
                                            <th>Penalty ID</th>
                                            <th>Type</th>
                                            <th>Amount</th>
                                            <th>Reason</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${penaltiesHtml}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <button class="btn btn-outline" onclick="applyNewPenalty('${user.id}', '${user.name}')">
                                        <i class="fas fa-gavel"></i> Apply New Penalty
                                    </button>
                                </div>
                                <div>
                                    <button class="btn btn-primary" onclick="exportUserPenalties('${user.id}')">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('userPenaltiesModal')">Close</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Apply new penalty from user penalties modal
        function applyNewPenalty(userId, userName) {
            closeModal('userPenaltiesModal');
            
            // Switch to penalties tab
            switchTab('penalties');
            
            // Set the user in the penalty form
            setTimeout(() => {
                const userSelect = document.getElementById('penaltyUser');
                const options = userSelect.options;
                
                for (let i = 0; i < options.length; i++) {
                    if (options[i].value === userId) {
                        userSelect.selectedIndex = i;
                        break;
                    }
                }
                
                // Scroll to the form
                document.querySelector('.penalty-form-container').scrollIntoView({ behavior: 'smooth' });
            }, 500);
        }
        
        // Export user penalties
        function exportUserPenalties(userId) {
            // In a real implementation, this would export penalties to CSV/PDF
            showNotification('Export functionality would generate a penalties report', 'info');
        }
        
        // Edit user
        async function editUser(userId) {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/users/${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showEditUserModal(data.user);
                } else {
                    showNotification('Error loading user data', 'error');
                }
            } catch (error) {
                console.error('Error loading user:', error);
                showNotification('Error loading user data', 'error');
            }
        }
        
        // Show edit user modal
        function showEditUserModal(user) {
            const modalHtml = `
                <div class="modal-overlay active" id="editUserModal">
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3>Edit User: ${user.name}</h3>
                            <button class="modal-close" onclick="closeModal('editUserModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="editUserForm">
                                <input type="hidden" id="editUserId" value="${user.id}">
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editUserName">Full Name</label>
                                        <input type="text" id="editUserName" class="form-control" value="${user.name || ''}">
                                    </div>
                                    <div class="form-group">
                                        <label for="editUserEmail">Email</label>
                                        <input type="email" id="editUserEmail" class="form-control" value="${user.email}" disabled>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editUserPhone">Phone</label>
                                        <input type="text" id="editUserPhone" class="form-control" value="${user.phone || ''}">
                                    </div>
                                    <div class="form-group">
                                        <label for="editUserCountry">Country</label>
                                        <input type="text" id="editUserCountry" class="form-control" value="${user.country || ''}">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editUserRole">Role</label>
                                        <select id="editUserRole" class="form-control">
                                            <option value="user" ${user.role === 'user' ? 'selected' : ''}>Regular User</option>
                                            <option value="vip" ${user.role === 'vip' ? 'selected' : ''}>VIP User</option>
                                            <option value="affiliate" ${user.role === 'affiliate' ? 'selected' : ''}>Affiliate</option>
                                            <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Admin</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="editUserStatus">
                                            <input type="checkbox" id="editUserStatus" ${user.active ? 'checked' : ''}> Active Account
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editUserKYC">KYC Status</label>
                                        <select id="editUserKYC" class="form-control">
                                            <option value="not_started" ${user.kycStatus === 'not_started' ? 'selected' : ''}>Not Started</option>
                                            <option value="pending" ${user.kycStatus === 'pending' ? 'selected' : ''}>Pending</option>
                                            <option value="approved" ${user.kycStatus === 'approved' ? 'selected' : ''}>Approved</option>
                                            <option value="rejected" ${user.kycStatus === 'rejected' ? 'selected' : ''}>Rejected</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="editUser2FA">
                                            <input type="checkbox" id="editUser2FA" ${user.twoFactorEnabled ? 'checked' : ''}> 2FA Enabled
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="editUserNotes">Admin Notes</label>
                                    <textarea id="editUserNotes" class="form-control" rows="3">${user.adminNotes || ''}</textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('editUserModal')">Cancel</button>
                            <button class="btn btn-primary" onclick="saveUserChanges()">Save Changes</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Save user changes
        async function saveUserChanges() {
            const userId = document.getElementById('editUserId').value;
            const userData = {
                name: document.getElementById('editUserName').value,
                phone: document.getElementById('editUserPhone').value,
                country: document.getElementById('editUserCountry').value,
                role: document.getElementById('editUserRole').value,
                active: document.getElementById('editUserStatus').checked,
                kycStatus: document.getElementById('editUserKYC').value,
                twoFactorEnabled: document.getElementById('editUser2FA').checked,
                adminNotes: document.getElementById('editUserNotes').value
            };
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/users/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showNotification('User updated successfully!', 'success');
                    closeModal('editUserModal');
                    loadUsersData();
                } else {
                    showNotification(data.message || 'Error updating user', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error updating user', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Toggle user status
        async function toggleUserStatus(userId, currentStatus) {
            const newStatus = !currentStatus;
            const action = newStatus ? 'activate' : 'deactivate';
            
            if (confirm(`Are you sure you want to ${action} this user?`)) {
                showLoading();
                
                try {
                    const response = await fetch(`${API_BASE_URL}/admin/users/${userId}/status`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ active: newStatus })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        showNotification(`User ${action}d successfully!`, 'success');
                        loadUsersData();
                    } else {
                        showNotification(data.message || `Error ${action}ing user`, 'error');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showNotification(`Error ${action}ing user`, 'error');
                } finally {
                    hideLoading();
                }
            }
        }
        
        // View user details
        async function viewUserDetails(userId) {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/users/${userId}/details`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showUserDetailsModal(data.user);
                } else {
                    showNotification('Error loading user details', 'error');
                }
            } catch (error) {
                console.error('Error loading user details:', error);
                showNotification('Error loading user details', 'error');
            }
        }
        
        // Show user details modal
        function showUserDetailsModal(user) {
            const modalHtml = `
                <div class="modal-overlay active" id="userDetailsModal">
                    <div class="modal" style="max-width: 700px;">
                        <div class="modal-header">
                            <h3>User Details: ${user.name}</h3>
                            <button class="modal-close" onclick="closeModal('userDetailsModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="tabs">
                                <button class="tab active" data-user-tab="profile">Profile</button>
                                <button class="tab" data-user-tab="balances">Balances</button>
                                <button class="tab" data-user-tab="activity">Activity</button>
                            </div>
                            
                            <div class="tab-content active" id="userProfileTab">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Email</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${user.email}</div>
                                    </div>
                                    <div class="form-group">
                                        <label>Joined</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(user.createdAt)}</div>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Status</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                            <span class="status-badge ${user.active ? 'status-active' : 'status-inactive'}">${user.active ? 'Active' : 'Inactive'}</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>KYC Status</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                            <span class="status-badge ${user.kycStatus === 'approved' ? 'status-approved' : user.kycStatus === 'pending' ? 'status-pending' : 'status-rejected'}">${user.kycStatus || 'Not Started'}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                ${user.lastLogin ? `
                                    <div class="form-group">
                                        <label>Last Login</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(user.lastLogin)}</div>
                                    </div>
                                ` : ''}
                                
                                ${user.adminNotes ? `
                                    <div class="form-group">
                                        <label>Admin Notes</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${user.adminNotes}</div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('userDetailsModal')">Close</button>
                            <button class="btn btn-primary" onclick="editUser('${user.id}')">
                                <i class="fas fa-edit"></i> Edit User
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
            
            // Add tab switching
            document.querySelectorAll('[data-user-tab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-user-tab');
                    
                    // Update active tab
                    document.querySelectorAll('[data-user-tab]').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding content
                    document.querySelectorAll('#userDetailsModal .tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    if (tabId === 'balances') {
                        loadUserBalancesForModal(user.id);
                    } else if (tabId === 'activity') {
                        loadUserActivityForModal(user.id);
                    }
                });
            });
        }
        
        // Load user balances for modal
        async function loadUserBalancesForModal(userId) {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/users/${userId}/balances`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                const balancesHtml = `
                    <div id="userBalancesTab">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Main Balance</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">$${formatNumber(data.mainBalance || 0)}</div>
                            </div>
                            <div class="form-group">
                                <label>Penalty Balance</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;" class="negative-balance">-$${formatNumber(data.penaltyBalance || 0)}</div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Net Balance</label>
                            <div style="padding: 15px; background-color: ${(data.mainBalance - (data.penaltyBalance || 0)) < 0 ? '#fee2e2' : '#d1fae5'}; border-radius: 6px; font-size: 1.2rem; font-weight: 600;" class="${(data.mainBalance - (data.penaltyBalance || 0)) < 0 ? 'negative-balance' : ''}">
                                $${formatNumber(data.mainBalance - (data.penaltyBalance || 0))}
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="editUserBalance('${userId}')">
                                <i class="fas fa-edit"></i> Edit Balances
                            </button>
                            <button class="btn btn-warning" onclick="viewUserPenalties('${userId}')">
                                <i class="fas fa-gavel"></i> View Penalties
                            </button>
                        </div>
                    </div>
                `;
                
                const modalBody = document.querySelector('#userDetailsModal .modal-body');
                const existingTab = document.getElementById('userBalancesTab');
                
                if (existingTab) {
                    existingTab.outerHTML = balancesHtml;
                } else {
                    const tabContent = document.createElement('div');
                    tabContent.id = 'userBalancesTab';
                    tabContent.className = 'tab-content';
                    tabContent.innerHTML = balancesHtml;
                    
                    modalBody.appendChild(tabContent);
                }
                
                document.getElementById('userBalancesTab').classList.add('active');
            } catch (error) {
                console.error('Error loading user balances:', error);
            }
        }
        
        // Load user activity for modal
        async function loadUserActivityForModal(userId) {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/users/${userId}/activity`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                let activityHtml = '<div id="userActivityTab"><h4>Recent Activity</h4>';
                
                if (data.activities && data.activities.length > 0) {
                    activityHtml += '<div style="max-height: 300px; overflow-y: auto;">';
                    
                    data.activities.forEach(activity => {
                        activityHtml += `
                            <div style="padding: 10px; border-bottom: 1px solid #e2e8f0;">
                                <div style="display: flex; justify-content: space-between;">
                                    <div style="font-weight: 500;">${activity.action}</div>
                                    <div style="font-size: 0.85rem; color: #64748b;">${formatDateTime(activity.timestamp)}</div>
                                </div>
                                <div style="font-size: 0.9rem; color: #475569; margin-top: 5px;">${activity.details || ''}</div>
                                <div style="font-size: 0.8rem; color: #94a3b8; margin-top: 5px;">
                                    ${activity.ipAddress ? `IP: ${activity.ipAddress}` : ''}
                                    ${activity.device ? ` • Device: ${activity.device}` : ''}
                                </div>
                            </div>
                        `;
                    });
                    
                    activityHtml += '</div>';
                } else {
                    activityHtml += '<p>No recent activity found.</p>';
                }
                
                activityHtml += '</div>';
                
                const modalBody = document.querySelector('#userDetailsModal .modal-body');
                const existingTab = document.getElementById('userActivityTab');
                
                if (existingTab) {
                    existingTab.outerHTML = activityHtml;
                } else {
                    const tabContent = document.createElement('div');
                    tabContent.id = 'userActivityTab';
                    tabContent.className = 'tab-content';
                    tabContent.innerHTML = activityHtml;
                    
                    modalBody.appendChild(tabContent);
                }
                
                document.getElementById('userActivityTab').classList.add('active');
            } catch (error) {
                console.error('Error loading user activity:', error);
            }
        }
        
        // Approve KYC
        async function approveKYC(userId) {
            if (confirm('Approve this KYC submission?')) {
                showLoading();
                
                try {
                    const response = await fetch(`${API_BASE_URL}/admin/kyc/${userId}/approve`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        showNotification('KYC approved successfully!', 'success');
                        loadKYCData();
                        loadDashboardData();
                    } else {
                        showNotification(data.message || 'Error approving KYC', 'error');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showNotification('Error approving KYC', 'error');
                } finally {
                    hideLoading();
                }
            }
        }
        
        // Reject KYC
        async function rejectKYC(userId) {
            const reason = prompt('Please enter reason for rejection:');
            if (reason === null) return;
            
            if (!reason.trim()) {
                showNotification('Reason is required', 'error');
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/kyc/${userId}/reject`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ reason })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showNotification('KYC rejected successfully!', 'success');
                    loadKYCData();
                    loadDashboardData();
                } else {
                    showNotification(data.message || 'Error rejecting KYC', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error rejecting KYC', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // View KYC documents
        async function viewKYCDocuments(userId) {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/kyc/${userId}/documents`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showKYCDocumentsModal(data.documents, data.user);
                } else {
                    showNotification('Error loading KYC documents', 'error');
                }
            } catch (error) {
                console.error('Error loading KYC documents:', error);
                showNotification('Error loading KYC documents', 'error');
            }
        }
        
        // Show KYC documents modal
        function showKYCDocumentsModal(documents, user) {
            let documentsHtml = '';
            
            if (documents && documents.length > 0) {
                documents.forEach(doc => {
                    documentsHtml += `
                        <div class="kyc-doc" style="border: 1px solid #e2e8f0; border-radius: var(--border-radius); padding: 15px; margin-bottom: 15px;">
                            <h4 style="margin-bottom: 10px;">${doc.type}</h4>
                            ${doc.imageUrl ? `
                                <div style="margin-bottom: 10px;">
                                    <img src="${doc.imageUrl}" alt="${doc.type}" style="max-width: 100%; max-height: 200px; border-radius: 6px;">
                                </div>
                            ` : ''}
                            <p><strong>Status:</strong> <span class="status-badge ${doc.status === 'approved' ? 'status-approved' : doc.status === 'pending' ? 'status-pending' : 'status-rejected'}">${doc.status}</span></p>
                            ${doc.verifiedAt ? `<p><strong>Verified:</strong> ${formatDateTime(doc.verifiedAt)}</p>` : ''}
                            ${doc.notes ? `<p><strong>Notes:</strong> ${doc.notes}</p>` : ''}
                        </div>
                    `;
                });
            } else {
                documentsHtml = '<p>No documents found.</p>';
            }
            
            const modalHtml = `
                <div class="modal-overlay active" id="kycDocsModal">
                    <div class="modal" style="max-width: 800px;">
                        <div class="modal-header">
                            <h3>KYC Documents: ${user.name}</h3>
                            <button class="modal-close" onclick="closeModal('kycDocsModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            ${documentsHtml}
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('kycDocsModal')">Close</button>
                            ${documents && documents.length > 0 ? `
                                <button class="btn btn-success" onclick="approveKYC('${user.id}')">
                                    <i class="fas fa-check"></i> Approve KYC
                                </button>
                                <button class="btn btn-danger" onclick="rejectKYC('${user.id}')">
                                    <i class="fas fa-times"></i> Reject KYC
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Approve deposit
        async function approveDeposit(depositId) {
            if (confirm('Approve this deposit?')) {
                showLoading();
                
                try {
                    const response = await fetch(`${API_BASE_URL}/admin/deposits/${depositId}/approve`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        showNotification('Deposit approved successfully!', 'success');
                        loadDepositsData();
                        loadDashboardData();
                    } else {
                        showNotification(data.message || 'Error approving deposit', 'error');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showNotification('Error approving deposit', 'error');
                } finally {
                    hideLoading();
                }
            }
        }
        
        // Reject deposit
        async function rejectDeposit(depositId) {
            const reason = prompt('Please enter reason for rejection:');
            if (reason === null) return;
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/deposits/${depositId}/reject`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ reason })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showNotification('Deposit rejected successfully!', 'success');
                    loadDepositsData();
                    loadDashboardData();
                } else {
                    showNotification(data.message || 'Error rejecting deposit', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error rejecting deposit', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Approve withdrawal
        async function approveWithdrawal(withdrawalId) {
            if (confirm('Approve this withdrawal?')) {
                showLoading();
                
                try {
                    const response = await fetch(`${API_BASE_URL}/admin/withdrawals/${withdrawalId}/approve`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        showNotification('Withdrawal approved successfully!', 'success');
                        loadWithdrawalsData();
                        loadDashboardData();
                    } else {
                        showNotification(data.message || 'Error approving withdrawal', 'error');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showNotification('Error approving withdrawal', 'error');
                } finally {
                    hideLoading();
                }
            }
        }
        
        // Reject withdrawal
        async function rejectWithdrawal(withdrawalId) {
            const reason = prompt('Please enter reason for rejection:');
            if (reason === null) return;
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/withdrawals/${withdrawalId}/reject`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ reason })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showNotification('Withdrawal rejected successfully!', 'success');
                    loadWithdrawalsData();
                    loadDashboardData();
                } else {
                    showNotification(data.message || 'Error rejecting withdrawal', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error rejecting withdrawal', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // View withdrawal details
        async function viewWithdrawalDetails(withdrawalId) {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/withdrawals/${withdrawalId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showWithdrawalDetailsModal(data.withdrawal);
                } else {
                    showNotification('Error loading withdrawal details', 'error');
                }
            } catch (error) {
                console.error('Error loading withdrawal details:', error);
                showNotification('Error loading withdrawal details', 'error');
            }
        }
        
        // Show withdrawal details modal
        function showWithdrawalDetailsModal(withdrawal) {
            const modalHtml = `
                <div class="modal-overlay active" id="withdrawalDetailsModal">
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3>Withdrawal Details</h3>
                            <button class="modal-close" onclick="closeModal('withdrawalDetailsModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Transaction ID</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; font-family: monospace;">${withdrawal.transactionId}</div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>User</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${withdrawal.userName || withdrawal.userEmail}</div>
                                </div>
                                <div class="form-group">
                                    <label>Amount</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">$${formatNumber(withdrawal.amount)}</div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Method</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${withdrawal.method}</div>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                        <span class="status-badge ${getStatusClass(withdrawal.status)}">${withdrawal.status}</span>
                                    </div>
                                </div>
                            </div>
                            
                            ${withdrawal.method === 'bitcoin' ? `
                                <div class="form-group">
                                    <label>Bitcoin Wallet Address</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; font-family: monospace; word-break: break-all;">${withdrawal.walletAddress || 'N/A'}</div>
                                </div>
                            ` : `
                                <div class="form-group">
                                    <label>Bank Details</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${withdrawal.bankDetails || 'N/A'}</div>
                                </div>
                            `}
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Fee</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">$${formatNumber(withdrawal.fee || 0)}</div>
                                </div>
                                <div class="form-group">
                                    <label>Net Amount</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">$${formatNumber(withdrawal.netAmount || withdrawal.amount)}</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Created</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(withdrawal.createdAt)}</div>
                            </div>
                            
                            ${withdrawal.processedAt ? `
                                <div class="form-group">
                                    <label>Processed</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(withdrawal.processedAt)}</div>
                                </div>
                            ` : ''}
                            
                            ${withdrawal.adminNotes ? `
                                <div class="form-group">
                                    <label>Admin Notes</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${withdrawal.adminNotes}</div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('withdrawalDetailsModal')">Close</button>
                            ${withdrawal.status === 'pending' ? `
                                <button class="btn btn-success" onclick="approveWithdrawal('${withdrawal.id}')">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-danger" onclick="rejectWithdrawal('${withdrawal.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // View transaction details
        async function viewTransactionDetails(transactionId) {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/transactions/${transactionId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showTransactionDetailsModal(data.transaction);
                } else {
                    showNotification('Error loading transaction details', 'error');
                }
            } catch (error) {
                console.error('Error loading transaction details:', error);
                showNotification('Error loading transaction details', 'error');
            }
        }
        
        // Show transaction details modal
        function showTransactionDetailsModal(transaction) {
            const isPenalty = transaction.type === 'penalty';
            
            const modalHtml = `
                <div class="modal-overlay active" id="transactionDetailsModal">
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3>Transaction Details</h3>
                            <button class="modal-close" onclick="closeModal('transactionDetailsModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Transaction ID</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; font-family: monospace;">${transaction.transactionId}</div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>User</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${transaction.userName || transaction.userEmail}</div>
                                </div>
                                <div class="form-group">
                                    <label>Type</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${transaction.type}</div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Amount</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;" class="${isPenalty ? 'negative-balance' : ''}">${isPenalty ? '-' : ''}$${formatNumber(transaction.amount)}</div>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                        <span class="status-badge ${getStatusClass(transaction.status)}">${transaction.status}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Fee</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">$${formatNumber(transaction.fee || 0)}</div>
                                </div>
                                <div class="form-group">
                                    <label>Net Amount</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${isPenalty ? '-' : ''}$${formatNumber(transaction.netAmount || transaction.amount)}</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Description</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${transaction.description || 'N/A'}</div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Created</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(transaction.createdAt)}</div>
                                </div>
                                ${transaction.completedAt ? `
                                    <div class="form-group">
                                        <label>Completed</label>
                                        <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(transaction.completedAt)}</div>
                                    </div>
                                ` : ''}
                            </div>
                            
                            ${transaction.adminNotes ? `
                                <div class="form-group">
                                    <label>Admin Notes</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${transaction.adminNotes}</div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('transactionDetailsModal')">Close</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // View notification details
        async function viewNotificationDetails(notificationId) {
            try {
                const response = await fetch(`${API_BASE_URL}/admin/notifications/${notificationId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotificationDetailsModal(data.notification);
                } else {
                    showNotification('Error loading notification details', 'error');
                }
            } catch (error) {
                console.error('Error loading notification details:', error);
                showNotification('Error loading notification details', 'error');
            }
        }
        
        // Show notification details modal
        function showNotificationDetailsModal(notification) {
            const modalHtml = `
                <div class="modal-overlay active" id="notificationDetailsModal">
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3>Notification Details</h3>
                            <button class="modal-close" onclick="closeModal('notificationDetailsModal')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Title</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${notification.title}</div>
                            </div>
                            
                            <div class="form-group">
                                <label>Message</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px; white-space: pre-wrap;">${notification.message}</div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Type</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${notification.type}</div>
                                </div>
                                <div class="form-group">
                                    <label>Priority</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                        <span class="status-badge" style="background-color: ${getPriorityColor(notification.priority)}20; color: ${getPriorityColor(notification.priority)};">${notification.priority.toUpperCase()}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Recipients</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${notification.recipientCount || 1}</div>
                                </div>
                                <div class="form-group">
                                    <label>Status</label>
                                    <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                        <span class="status-badge ${notification.status === 'sent' ? 'status-completed' : 'status-pending'}">${notification.status}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Sent</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">${formatDateTime(notification.sentAt)}</div>
                            </div>
                            
                            <div class="form-group">
                                <label>Channels</label>
                                <div style="padding: 10px; background-color: #f8fafc; border-radius: 6px;">
                                    ${notification.channels?.inApp ? '<span class="status-badge" style="margin-right: 5px;">In-App</span>' : ''}
                                    ${notification.channels?.email ? '<span class="status-badge" style="margin-right: 5px;">Email</span>' : ''}
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" onclick="closeModal('notificationDetailsModal')">Close</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHtml;
        }
        
        // Export users
        async function exportUsers(format) {
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/users/export?format=${format}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.downloadUrl) {
                    // Create a temporary link to download the file
                    const link = document.createElement('a');
                    link.href = data.downloadUrl;
                    link.download = `users_export_${new Date().toISOString().split('T')[0]}.${format}`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showNotification(`Users exported successfully as ${format.toUpperCase()}`, 'success');
                } else {
                    showNotification('Error exporting users', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error exporting users', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Export transactions
        async function exportTransactions() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            let url = `${API_BASE_URL}/admin/transactions/export?format=csv`;
            if (startDate) url += `&startDate=${startDate}`;
            if (endDate) url += `&endDate=${endDate}`;
            
            showLoading();
            
            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.downloadUrl) {
                    const link = document.createElement('a');
                    link.href = data.downloadUrl;
                    link.download = `transactions_export_${new Date().toISOString().split('T')[0]}.csv`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showNotification('Transactions exported successfully', 'success');
                } else {
                    showNotification('Error exporting transactions', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error exporting transactions', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Filter transactions by date
        async function filterTransactions() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            let url = `${API_BASE_URL}/admin/transactions`;
            const params = [];
            if (startDate) params.push(`startDate=${startDate}`);
            if (endDate) params.push(`endDate=${endDate}`);
            
            if (params.length > 0) {
                url += '?' + params.join('&');
            }
            
            showLoading();
            
            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateTransactionsTable(data.transactions || []);
                showNotification('Transactions filtered', 'info');
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error filtering transactions', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Filter activities
        async function filterActivities() {
            const startDate = document.getElementById('activityStartDate').value;
            const endDate = document.getElementById('activityEndDate').value;
            const activityType = document.getElementById('activityType').value;
            
            let url = `${API_BASE_URL}/admin/activity/log`;
            const params = [];
            if (startDate) params.push(`startDate=${startDate}`);
            if (endDate) params.push(`endDate=${endDate}`);
            if (activityType) params.push(`type=${activityType}`);
            
            if (params.length > 0) {
                url += '?' + params.join('&');
            }
            
            showLoading();
            
            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateActivityLogTable(data.activities || []);
                showNotification('Activities filtered', 'info');
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error filtering activities', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Filter login history
        async function filterLoginHistory() {
            const search = document.getElementById('loginSearch').value;
            
            let url = `${API_BASE_URL}/admin/activity/logins`;
            if (search) {
                url += `?search=${encodeURIComponent(search)}`;
            }
            
            showLoading();
            
            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                updateLoginHistoryTable(data.logins || []);
                showNotification('Login history filtered', 'info');
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error filtering login history', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Perform global search
        async function performGlobalSearch(query) {
            if (query.length < 2) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/search?q=${encodeURIComponent(query)}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                showGlobalSearchResults(data.results);
            } catch (error) {
                console.error('Search error:', error);
            }
        }
        
        // Show global search results
        function showGlobalSearchResults(results) {
            // Create a dropdown with search results
            const searchBox = document.querySelector('.search-box');
            let dropdown = document.getElementById('searchResultsDropdown');
            
            if (!dropdown) {
                dropdown = document.createElement('div');
                dropdown.id = 'searchResultsDropdown';
                dropdown.style.cssText = `
                    position: absolute;
                    top: 100%;
                    left: 0;
                    right: 0;
                    background: white;
                    border-radius: var(--border-radius);
                    box-shadow: var(--shadow);
                    z-index: 1000;
                    max-height: 400px;
                    overflow-y: auto;
                    display: none;
                `;
                searchBox.appendChild(dropdown);
            }
            
            if (!results || results.length === 0) {
                dropdown.innerHTML = '<div style="padding: 15px; color: #64748b;">No results found</div>';
                dropdown.style.display = 'block';
                return;
            }
            
            let html = '';
            
            // Group results by type
            const users = results.filter(r => r.type === 'user');
            const transactions = results.filter(r => r.type === 'transaction');
            const penalties = results.filter(r => r.type === 'penalty');
            
            if (users.length > 0) {
                html += '<div style="padding: 10px 15px; background: #f8fafc; font-weight: 500; color: #64748b; font-size: 0.85rem;">USERS</div>';
                users.forEach(user => {
                    html += `
                        <div style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; cursor: pointer;" onclick="viewUserDetails('${user.id}')">
                            <div style="font-weight: 500;">${user.name}</div>
                            <div style="font-size: 0.85rem; color: #64748b;">${user.email}</div>
                            <div style="font-size: 0.75rem; color: #94a3b8;">Balance: $${formatNumber(user.balance || 0)}</div>
                        </div>
                    `;
                });
            }
            
            if (transactions.length > 0) {
                html += '<div style="padding: 10px 15px; background: #f8fafc; font-weight: 500; color: #64748b; font-size: 0.85rem;">TRANSACTIONS</div>';
                transactions.forEach(transaction => {
                    html += `
                        <div style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; cursor: pointer;" onclick="viewTransactionDetails('${transaction.id}')">
                            <div style="font-weight: 500;">${transaction.type.toUpperCase()} - $${formatNumber(transaction.amount)}</div>
                            <div style="font-size: 0.85rem; color: #64748b;">${transaction.userName || transaction.userEmail}</div>
                            <div style="font-size: 0.75rem; color: #94a3b8;">${formatDateTime(transaction.createdAt)}</div>
                        </div>
                    `;
                });
            }
            
            if (penalties.length > 0) {
                html += '<div style="padding: 10px 15px; background: #f8fafc; font-weight: 500; color: #64748b; font-size: 0.85rem;">PENALTIES</div>';
                penalties.forEach(penalty => {
                    html += `
                        <div style="padding: 10px 15px; border-bottom: 1px solid #e2e8f0; cursor: pointer;" onclick="viewPenaltyDetails('${penalty.id}')">
                            <div style="font-weight: 500;" class="negative-balance">-$${formatNumber(penalty.amount)} Penalty</div>
                            <div style="font-size: 0.85rem; color: #64748b;">${penalty.userName || penalty.userEmail}</div>
                            <div style="font-size: 0.75rem; color: #94a3b8;">${formatDateTime(penalty.createdAt)}</div>
                        </div>
                    `;
                });
            }
            
            dropdown.innerHTML = html;
            dropdown.style.display = 'block';
            
            // Close dropdown when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeDropdown(e) {
                    if (!searchBox.contains(e.target)) {
                        dropdown.style.display = 'none';
                        document.removeEventListener('click', closeDropdown);
                    }
                });
            }, 100);
        }
        
        // Close modal
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }
        
        // Show loading
        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }
        
        // Hide loading
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            
            const icon = type === 'success' ? 'fa-check' : 
                        type === 'error' ? 'fa-times' : 
                        type === 'warning' ? 'fa-exclamation' : 'fa-info';
            
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div>
                    <div style="font-weight: 500;">${message}</div>
                    <div style="font-size: 0.85rem; color: #64748b;">Just now</div>
                </div>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: #64748b; cursor: pointer; margin-left: auto;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.getElementById('notificationContainer').appendChild(notification);
            
            // Show with animation
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        // Utility function to format numbers
        function formatNumber(num) {
            if (num === undefined || num === null) return '0.00';
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(num);
        }
        
        // Utility function to format date
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        // Utility function to format date and time
        function formatDateTime(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Get status class for badges
        function getStatusClass(status) {
            if (!status) return 'status-inactive';
            
            switch(status.toLowerCase()) {
                case 'approved':
                case 'completed':
                case 'active':
                case 'sent':
                case 'success':
                    return 'status-approved';
                case 'pending':
                    return 'status-pending';
                case 'rejected':
                case 'failed':
                case 'inactive':
                    return 'status-rejected';
                default:
                    return 'status-inactive';
            }
        }
        
        // Format penalty type
        function formatPenaltyType(type) {
            if (!type) return 'Unknown';
            
            const typeMap = {
                'violation_terms': 'Terms Violation',
                'fraudulent_activity': 'Fraudulent Activity',
                'payment_issue': 'Payment Issue',
                'suspicious_behavior': 'Suspicious Behavior',
                'system_abuse': 'System Abuse',
                'other': 'Other'
            };
            
            return typeMap[type] || type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }
        
        // Get priority color
        function getPriorityColor(priority) {
            switch(priority) {
                case 'low': return '#10b981';
                case 'normal': return '#3b82f6';
                case 'high': return '#f59e0b';
                case 'urgent': return '#ef4444';
                default: return '#3b82f6';
            }
        }
        
        // Handle responsive design
        function handleResponsive() {
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const sidebar = document.getElementById('sidebar');
            
            if (window.innerWidth <= 992) {
                mobileMenuToggle.style.display = 'block';
                sidebar.classList.remove('active');
            } else {
                mobileMenuToggle.style.display = 'none';
                sidebar.classList.add('active');
            }
        }
        
        // Real-time updates for dashboard
        function setupRealTimeUpdates() {
            // Update dashboard every 30 seconds
            setInterval(() => {
                if (document.querySelector('#dashboard').classList.contains('active')) {
                    loadDashboardData();
                }
            }, 30000);
            
            // Update badges every minute
            setInterval(() => {
                loadKYCData();
                loadDepositsData();
                loadWithdrawalsData();
            }, 60000);
        }
        
        // Initialize real-time updates after login
        setTimeout(() => {
            setupRealTimeUpdates();
        }, 5000);
    </script>
</body>
</html>
